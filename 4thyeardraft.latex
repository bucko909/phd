\documentclass[a4paper,12pt,oneside]{book}

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{color}
\usepackage{epsfig}
\usepackage{algpseudocode}
\usepackage{cite}

\newtheorem{defn}{Definition}[section]
\newtheorem{lemma}[defn]{Lemma}
\newtheorem{proposition}[defn]{Proposition}
\newtheorem{theorem}[defn]{Theorem}
\newtheorem{example}[defn]{Example}
\newtheorem{notation}[defn]{Notation}
\newtheorem{definition}[defn]{Definition}
\newtheorem{algorithm}[defn]{Algorithm}
\newtheorem{remark}[defn]{Remark}
\newtheorem{corollary}[defn]{Corollary}
\newtheorem{conjecture}[defn]{Conjecture}

\newcommand{\slex}{\pi}
\newcommand{\image}{\mathrm{Im}}
\newcommand{\Cay}{\mathrm{Cay}}
\newcommand{\path}[2]{[#1,#2]}
\newcommand{\edge}[1]{#1}
\newcommand{\vertex}[1]{\hat{#1}}
\newcommand{\wordpath}[2]{\ensuremath{#1\overset{#2}{\rightarrow}}}
\newcommand{\canonicalball}[2]{\ensuremath{\hat{B}_{#1}(#2)}}
\newcommand{\canc}[2]{\Delta(#1,#2)}
\newcommand{\length}[1]{l(#1)}
\newcommand{\floor}[1]{\left\lfloor #1 \right\rfloor}
\newcommand{\ceiling}[1]{\left\lceil #1 \right\rceil}
\newcommand{\ceil}[1]{\left\lceil #1 \right\rceil}

\newcommand{\lcm}{\mathrm{lcm}}

\setlength{\unitlength}{20mm}
\newcommand{\geoword}[6]{
	\put(#1,#2){\vector(#3,#4){#5}}
	\put(#1,#2){\line(#3,#4){#6}}
}

\usepackage{setspace}
\onehalfspacing

\begin{document}

\title{Some Results on Hyperbolic Groups}

\author{David Buckley}

\maketitle

\chapter{Introduction}

The concept of a word-hyperbolic group was explored by Gromov \cite{gromov1987hyperbolic} where he brought much previous work in the area together using some definitions involving groups with left-invariant hyperbolic metrics, a definition of which will be given later. He shows among other things that in some sense ``most'' finite presentations define word-hyperbolic groups and that certain types of small cancellation group are in fact word-hyperbolic.

It turns out that word-hyperbolic groups admit simple solutions to the first two problems outlined by Dehn in \cite{dehn1911unendliche} for finitely presented groups $G = <\!X | R\!>$:

The \textbf{word problem}: Given a word $w \in (X \cup X^{-1})^*$, determine if $w$ represents the identity element of $G$.

The \textbf{conjugacy problem}: Given words $u, v \in (X \cup X^{-1})^*$, determine if $u$ and $v$ are conjugate elements of $G$.

In fact, there is a solution to a problem which generalises both of these in the torsion-free word-hyperbolic case, that of deciding whether a system of equations over elements of such a group admits a solution. This result is due to Sela in \cite{Z.Sela02232009}, although more general statements have since been proved.

An efficient solution to the word problem due to Shapiro is given in Section \ref{section:hyperbolicity}, and a solution to the conjugacy problem is the concern of Chapter \ref{chapter:conjugacy}.

In addition to these solutions, the third problem proposed by Dehn, the \textbf{isomorphism problem} of determining whether two such groups are isomorphic has been shown to be at least solvable for torsion-free hyperbolic groups. Sela first showed in \cite{sela1995isomorphism} that this is solvable for torsion-free word-hyperbolic groups with no essential small action on a real-tree and has an unpublished proof for arbitrary torsion-free hyperbolic groups; Dahmani and Groves proved in \cite{dahmani2008isomorphism} that the problem is solvable in the more general class of torsion free relatively hyperbolic groups with abelian parabolics (a class which in particular includes torsion free hyperbolic groups).

All three of these problems are known to admit no solution in the setting of general finitely presented groups.

The reader may notice that torsion in hyperbolic groups appears to lead to complications which are often hard to work with. The isomorphism problem for arbitrary word-hyperbolic groups remains open at the time of writing, and torsion plays a part in complicating some of the proofs given in this thesis.

Chapter \ref{chapter:conjugacy} gives a solution to the conjugacy problem for finite \textit{lists} of elements of an arbitrary hyperbolic group which will run in time linear in total input word length. This is an improvement upon a quadratic time algorithm for lists which contain an infinite order element given in \cite{bridson2005conjugacy} - and an exponential time algorithm for lists of torsion elements outlined in the same place. The solution will in fact produce a complete description of the set of \textit{all} conjugating elements, and in particular the centraliser of a given list of elements.

In Chapter \ref{chapter:qc_conj} we show that given a quasiconvex subgroup $H$ of a hyperbolic group, there is an algorithm which checks whether an input word represents a conjugate of an element of $H$, and again, this algorithm will run in linear time if both the group and the subgroup are held constant. One can for instance use this method to check whether two quasiconvex subgroups are conjugate.

Chapter \ref{chapter:qc_coset} gives some properties of coset Cayley graphs. Finally, in Chapter \ref{chapter:minimal} we present a proof that there is a upper bound on the \textit{minimum} constant of hyperbolicity of a word-hyperbolic group over all finite generating sets of said group.

The rest of this chapter outlines the definitions upon which will apply during the rest of this thesis.

\section{Metric Spaces and Paths}

We assume the reader has at least a basic understanding of metric spaces.

\begin{definition}
Let $\Gamma$ be a metric space.

A \textbf{path} $\alpha$ in $\Gamma$ is a natural (ie. arc length) parametrization $\alpha : [0, l] \to \Gamma$ of a rectifiable curve in $\Gamma$. We will write $x \in \alpha$ to denote that $x$ lies in the \textit{image} of $\alpha$ and define the length of $\alpha$ to be $l$.

A \textbf{subpath} $\alpha'$ of $\alpha$ is any restriction of $\alpha$ to a subinterval of $[0, l]$, ie.\ $\alpha|_{[a, b]}$, reparametrised so that $\alpha'(0) = \alpha(a)$.

The \textbf{reversal} $\alpha^{-1} : [0, l] \to \Gamma$ of $\alpha$ is the map which sends $t \in [0, l]$ to $\alpha(l-t)$.

For points $x, y \in \Gamma$, we will often pick a specific path $\alpha:[0, l] \to \Gamma$ between $x$ and $y$, ie. with $\alpha(0)=x$ and $\alpha(l)=y$. Where such a path has been explicitly picked, we write $\path{x}{y}$ as a shorthand.

Further, for $0 \le a \le b \le l$, if $c = \alpha(a)$ and $d = \alpha(b)$, we will write $\path{c}{d}$ to refer to the subpath $\alpha|_{[a, b]}$ between $c$ and $d$, and define $d_\alpha(c, d) = b - a$. Often we will simply pick the points $c$ and $d$ to construct such a path. Whenever this is done, we are implicitly picking values $a$ and $b$ in $[0, l]$ so that this operation is well defined even when $\alpha$ is not injective.
\end{definition}

We are now in a position to define a number of concepts relating to shortest paths.

\begin{definition}
Suppose $\alpha$ is a path in some metric space $\Gamma$.

We define $\alpha$ to be a \textbf{$(\lambda, \epsilon)$-quasigeodesic} if given any subpath $\path{a}{b}$ of $\alpha$ we have $d_\alpha(a, b) \le \lambda d(\alpha(a), \alpha(b)) + \epsilon$.

$\alpha$ is a \textbf{geodesic} if it is a $(1, 0)$-quasigeodesic (that is, an isometry). A \textbf{geodesic metric space} is a metric space such that any two points in the space have a geodesic connecting them.

Finally, for $L > 0$ define $\alpha$ to have a property \textbf{$L$-locally} if every length $L$ subpath of $\alpha$ has that property. So for example, $L$-local quasigeodesics are paths for which each length $L$ subpath is a quasigeodesic.
\end{definition}

\section{$X$-graphs}

\label{section:xgraph}

Many of the definitions in this section will be used exclusively in Chapter \ref{chapter:qc_coset}. However, as they relate to Cayley graphs it is convenient to define them now to avoid defining a number of these concepts twice.

The metric spaces which are dealt with in this thesis will all be labelled directed graphs, where the labels obey the criteria below.

\begin{definition}
\label{def:xgraph}
Suppose $\Gamma$ is a directed graph which is connected ignoring edge directions, and has all edges labelled by elements of some finite set $X$. Then $\Gamma$ is an $X$-graph if, for each vertex $\vertex{p} \in \Gamma$ and each $x \in X$, there are unique edges $\edge{e}$ and $\edge{f}$ labelled by $x$, so that $\edge{e}$ starts at $\vertex{p}$ and $\edge{f}$ terminates at $\vertex{p}$. An $X$-graph will always be endowed with a distinguished base vertex.
\end{definition}

Thus, an $X$-graph is a pointed labelled directed graph in which any word whose letters are in $X \cup X^{-1}$ defines an edge path starting from any vertex, formalised as follows:

\begin{definition}
\label{def:xgraphpath}
An \textbf{$X$-word} is an element of $(X \cup X^{-1})^*$. When the set $X$ is clear we will often just refer to such an element as a word.

An $X$-word is \textbf{reduced} if it contains no subword of the form $xx^{-1}$ or $x^{-1}x$ where $x \in X$.

Given a vertex $\vertex{p}$ in an $X$-graph $\Gamma$, and some $x \in X$, let $\vertex{p} \cdot x$ be the terminal vertex of the edge labelled $x$ which starts at $\vertex{p}$, and let $\vertex{p} \cdot x^{-1}$ be the initial vertex of the edge labelled $x$ which ends at $\vertex{p}$.

For any $X$-word $w = a_1 \cdots a_n$ there is thus defined a unique vertex $\vertex{p} \cdot w = (\ldots(w \cdot a_1) \cdot a_2 \ldots) \cdot a_n$, and a unique path $\wordpath{\vertex{p}}{w} : [0, n] \to \Gamma$ which picks each intermediate vertex and edge in the obvious way.
\end{definition}

Given a group $G$ generated by a set $X$, the Cayley graph of $G$ with respect to $X$ has vertex set $G$ and edges connecting $g$ to $gx$ with label $x$ for each $g \in G$ and $x \in X$. This is an $X$-graph, and the base vertex in this case will be taken to be the vertex represeting the identity of $G$.

Similarly, the coset Cayley graph of a subgroup $H \le G$ with respect to $X$ has vertex set $V = \{ Hg : g \in G \}$ (ie.\ the set of right cosets of $H$), and edges connnecting $Hg$ to $Hgx$ for each $Hg \in V$ and $x \in X$. Again, this is an $X$-graph, and we take the base vertex to be the vertex representing the trivial coset $H$.

In fact, any $X$-graph $\Gamma$ is just a coset Cayley graph of a subgroup of the free group on $X$. To see this, let $\vertex{p}$ be the base vertex of $\Gamma$. Let $G$ be the free group generated by $X$ with elements represented by reduced $X$-words, and let $H$ be the set of reduced $X$-words $w$ such that $\vertex{p} \cdot w = \vertex{p}$. Then $H$ is a subgroup of $G$, and its coset Cayley graph with respect to $X$ is $\Gamma$. In this construction, $\vertex{p}$ is the vertex representing the trivial coset $H$. Much of the work in Chapter \ref{chapter:qc_coset} could therefore be equivalently restated in terms of coset Cayley graphs.

The work in Chapter \ref{chapter:qc_coset} often concerns connected subsets of an $X$-graph; we define these here in order to avoid having to make two definitions of a ``geodesic word''.

\begin{definition}
\label{def:connected}
Given a set of vertices $V$ in a graph $G$, the \textbf{subgraph of $G$ induced by $V$} is $V$ together with every edge in $G$ which connects two vertices in $V$.

A set $\Gamma'$ of vertices in a $X$-graph $\Gamma$ is a \textbf{connected vertex subset} or \textbf{CVS} if the subgraph of $\Gamma$ induced by $\Gamma'$ is connected. Where we are not concerned with the full $X$-graph $\Gamma$, we will simply say that $\Gamma'$ is an $X$-CVS.

If $\Gamma'$ is an $X$-CVS, $\vertex{p} \in \Gamma'$ and $w$ is an $X$-word, $w$ is a \textbf{$\Gamma'$-word} at $p$ if $p \cdot w(i) \in \Gamma'$ for each $i \in \{ 1, \ldots, |w| \}$. If additionally $\wordpath{\vertex{p}}{w}$ is a geodesic path in $\Gamma$, we say that $w$ is a $\Gamma'$-geodesic at $\vertex{p}$.

As a shorthand, if $\vertex{p}$ and $\vertex{q}$ are vertices in an $X$-CVS $\Gamma'$ we will say that $w$ is a $\Gamma'$-word (resp. geodesic) connecting $\vertex{p}$ to $\vertex{q}$ if $w$ is a $\Gamma'$-word (resp. geodesic) at $\vertex{p}$ and $\vertex{p} \cdot w = \vertex{q}$.

Where $w$ is a $\Gamma'$-geodesic at all vertices in $\Gamma'$, we simply say $w$ is a $\Gamma'$-geodesic.
\end{definition}

That is, a $\Gamma'$-word at $\vertex{p}$ is a word labelling a path starting at $\vertex{p}$ whose vertices are all inside $\Gamma'$, and a CVS is a set of vertices which are pairwise connected by $\Gamma'$-words. We will also consider finite balls in $X$-graphs to contain only vertices, so that:

\begin{definition}
If $\vertex{p}$ is a vertex in an $X$-graph $\Gamma$ and $k \ge 0$, the \textbf{$k$-ball} around $\vertex{p}$, or $B^{\Gamma}_k(\vertex{p})$, is the set containing all vertices $\vertex{q}$ with $d(\vertex{q}, \vertex{p}) \le k$. The superscript will often be omitted where the $X$-graph is clear from the vertex.
\end{definition}

Later on, we will often use the concept of a mid-vertex of a geodesic path in a graph. We define this now.

\begin{definition}
Suppose $x$ and $y$ are vertices in some graph $\Gamma$, and $\path{x}{y}$ is some geodesic path connecting them. Let $p$ be some vertex on $\path{x}{y}$ such that $|d(p, x) - d(p, y)| \le 1$. Then we say $p$ is a \textbf{mid-vertex} of $\path{x}{y}$.
\end{definition}

Note that if the distance between two vertices is even, there will be one mid-vertex; if it is odd there will be two.

\section{More about $X$-words}

We will often be concerned with various subwords of $X$-words; the following definitions outline some shorthands to define these.

Suppose $G$ is a finitely generated group. We will use the notation $=_G$ to represent equality of elements of $G$, and simply $=$ to represent equality of words. When we wish to represent equality of words allowing cancellation of letters with their inverses (ie.\ under the free group), we will write $=_F$.

\begin{definition}
Suppose $w = a_1 a_2 \ldots a_k$ is some $X$-word.

We denote the length, $k$, of $w$ as $|w|$, and if $G$ is a group generated by $X$ we denote by $|w|_G$ the smallest length of an $X$-word equal in $G$ to $w$.

We let $w(i) := a_1 a_2 \ldots a_i$ for $0 \le i \le |w|$. If $i < 0$ let $w(i)$ be the empty word and if $i > |w|$ let $w(i) := w$.

This definition can be extended logically to the integers by considering $w(i)$ to be a subword of $w^n$ or $w^{-n}$ for large enough $n$. In order to avoid confusion, we use $w^\infty$ to represent this extension in the following notation: if $i \in \mathbb{N}$ and $n = \floor{\frac{i}{|w|}}$ then $w^\infty(i) = w^nw(i - n|w|)$, and if $-i \in \mathbb{N}$, $w^\infty(i) = (w^{-1})^\infty(-i)$.

Given an $X$-graph $\Gamma$, we can regard $w^\infty$ as a two-way infinite path passing through the base vertex by extending the map $w^\infty : \mathbb{Z} \to \Gamma$ to map from $\mathbb{R}$ in the obvious way.

Next, for $0 \le i \le j \le k$ we let $w(i:j) := a_{i+1} \ldots a_j =_F w(i)^{-1}w(j)$. Let $w[i] := a_i$.

If $f = \floor{\frac{|w|}{2}}$, we define $w_L := w(f)$ and $w_R := w(f:|w|)$, then let $w_C := w_Rw_L$.
\end{definition}

Note that if $w$ labels a geodesic path in $\Gamma$ then $w_L$ labels a path to a mid-vertex and $w = w_Lw_R$ always. As an example, let $w = abcde$. Then $w^\infty(11) = abcdeabcdea$, $w^\infty(-3) = w^{-1}(3) = e^{-1}d^{-1}c^{-1}$, $w_L = w(2) = ab$, $w_R = w(2:5) = cde$ and $w_C = cdeab$.

We can now define a ``straight'' word.

\begin{defn}
Given an $X$-graph $\Gamma$ and a vertex $\vertex{p} \in \Gamma$, a word $w$ is \textbf{straight} at $\vertex{p}$ if, for all $i \in \mathbb{N}$, $w^i$ is a $\Gamma$-geodesic at $\vertex{p}$. We say that $w$ is \textbf{straight} if it is straight at all vertices in $\Gamma$.

By fixing some ordering on $X \cup X^{-1}$ we can produce a lexicographic ordering on $X$-words. We say $w$ is a short-lex least word (at $\vertex{p}$) if $w$ is a $\Gamma$-geodesic (at $\vertex{p}$) and no other $\Gamma$-geodesic (at $\vertex{p}$) connecting $\vertex{p}$ to $\vertex{p} \cdot w$ is lexicocgraphically less than $w$.

Such a word is \textbf{short-lex straight} (at $\vertex{p}$) if each $w^i$ is a short-lex least word (at $\vertex{p}$).
\end{defn}

\section{Hyperbolicity}

\label{section:hyperbolicity}

There are a number of equivalent definitions of hyperbolicity of a given space, many of which are for example given in \cite{BriHae99} or \cite{alonso1990notes}. The definition we will be using is that of having thin triangles.

\begin{definition}
Let $\Gamma$ be a geodesic metric space.

For points $x, y, z \in \Gamma$, define the \textbf{hyperbolic inner product} \[ (x, y)_z = \frac{d(x, z) + d(y, z) - d(x, y)}{2}. \]

Given three points $x, y, z \in \Gamma$, we define a triangle to be a choice of paths $\path{x}{y}$, $\path{y}{z}$ and $\path{z}{x}$. We say the triangle is geodesic (resp. quasigeodesic, local geodesic, \ldots) if each of the three paths which make it up are geodesics (resp. quasigeodesic, \ldots).

%Where $\Gamma$ is an $X$-graph, $\vertex{x}$ is a vertex in $\Gamma$ and $u$ and $v$ are $X$-words, we also define the following shorthand: \[ (u, v)_{\vertex{x}} = (\vertex{x} \cdot u, \vertex{x} \cdot v)_{\vertex{x}}. \]

\begin{figure}
\begin{center}
\input thin_triangles.pstex_t
\caption{A thin triangle, and a $3$-correspondance}
\label{figure:thin_triangles}
\end{center}
\end{figure}

On a triangle connecting these three points, define the meeting point on the side $\path{x}{y}$ to be the point $c_z \in \path{x}{y}$ such that $d_{\path{x}{y}}(x, c_z) = \frac{d_{\path{x}{y}}(x, y) + d_{\path{x}{z}}(x, z) - d_{\path{y}{z}}(y, z)}{2}$. Notice that this meeting point may be on an edge when $\Gamma$ is a graph. Define $c_x$ and $c_y$ similarly as in Figure \ref{figure:thin_triangles}. Note that in the case of a geodesic triangle, $d(x, c_z) = (y, z)_x$.

Suppose that $p$ is a point on $\path{x}{c_z}$. We say the point $q \in \path{x}{c_y}$ such that $d_{\path{x}{c_y}}(x, q) = d_{\path{x}{c_z}}(x, p)$ \textbf{corresponds} to $p$ and vice versa. By relabelling the corners, we may find a corresponding point any point on any of the three sides of the triangle. Observe that the meeting points all correspond to each other and hence have 2 corresponding points (except in degenerate cases where the meeting points are equal), and that all other points have 1 corresponding point (except in similar degenerate cases).

The triangle is \textbf{$\delta$-thin} if $d(p, q) \le \delta$ for all such corresponding points $p$ and $q$. It is \textbf{$\delta$-vertex-thin} if $d(\vertex{p}, \vertex{q}) \le \delta$ for all corresponding \textit{vertices} $\vertex{p}$ and $\vertex{q}$.

A geodesic space is \textbf{$\delta$-hyperbolic} if all geodesic triangles in it are $\delta$-thin. A graph is \textbf{$\delta$-vertex-hyperbolic} if any geodesic triangle in the graph whose corners lie on vertices is $\delta$-vertex-thin and $\delta$ is an positive integer.

A finitely generated group $G = <\!X\!>$ is \textbf{$\delta$-hyperbolic} with respect to $X$ if its Cayley graph with respect to $X$ is $\delta$-hyperbolic.
\end{definition}

The property of being $\delta$-hyperbolic for \textit{some} $\delta$ is a property of the group and not just the generating set, although the particular value of $\delta$ will likely change depending on the particular generating set used.

It is perhaps not clear whether or not a vertex-hyperbolic space is hyperbolic (although a hyperbolic space is clearly vertex-hyperbolic). The $\delta$ associated to vertex-hyperbolicity is rather more relevant to a hyperbolic group, as we are mostly concerned with words -- that is, labels of paths which connect vertices. In Section \ref{section:graph_hyp_implies_space_hyp} we show that these properties are indeed equivalent. Most of the literature uses the hyperbolicity rather than vertex-hyperbolicity constant so we will for the most part be using this constant also to simplify results.

In a construction involving many triangles sharing common sides, we will use the phrase $p$ \textbf{$n$-corresponds} to $q$ if there is a sequence $p = r_0, r_1, r_2, \cdots, r_n = q$ of points such that $r_i$ corresponds (via a previously constructed triangle) to $r_{i+1}$ for all $i$. More generally, we will say that points \textbf{chain-correspond} if there exists an $n \in \mathbb{N}$ such that they $n$-correspond. This is illustrated on the right hand side of Figure \ref{figure:thin_triangles}.

Of course, knowing that such a constant $\delta$ exists is not particularly helpful for writing explicit algorithms which will often use the value of $\delta$. In \cite{epstein2001computation} an algorithm is given (and in fact implemented in D.\ F.\ Holt's KBMAG package) which can, given a finite presentation for a word-hyperbolic group, compute such a constant. In fact, the algorithm computes the minimum constant for that presentation.

This algorithm terminates if and only if the presentation defines a hyperbolic group, and has no bound on its running time: It is impossible to predict when the algorithm will complete, only that it will at some point do so. We will therefore assume that for any word-hyperbolic group mentioned in this thesis, the algorithm has \textit{already been executed} and thus the constant $\delta$ is known.

Note that this indeterminate runtime is the best that we can hope for. Given a $\delta$-hyperbolic group, it is rather easy to test if that group is trivial: use the solution of the word problem to show that each generator is equal to the identity. In fact, the trivial group is $1$-hyperbolic for any generating set. If there were an efficient algorithm which determined if a given presentation was hyperbolic, it would therefore be able to determine if a given finite presentation is a presentation of the trivial group or not. This is well known to be impossible.

We noted earlier that the word problem was solvable in the setting of hyperbolic groups. In \cite{epstein2006linearity} a solution to the word problem due to Shapiro is given which runs in linear time, as follows.

\begin{lemma}
\label{lemma:short_lex}
Suppose that $G$ is a $\delta$-hyperbolic group. Then there is an algorithm which, given a word $w$ in the generators of $G$ will return the short-lex least representative of $w$ in time $O(|w|)$.
\end{lemma}

We will denote use of this lemma (ie.\ the act of finding short-lex reduced words) by $\slex$ operating on elements, words and lists of elements or words in the obvious way. Of course, we will also use it implicitly, since it implies that operations like finding the length of an element, or deciding equality of two elements can be done in time linear in the length of the input words.

\section{Automatic groups and DFAs}

Another class of finitely generated groups which is of computational interest is the class of automatic groups, which are defined by certain finite state automata. A lot of detail in these definitions will be omitted; Chapter 13 of \cite{holt2005handbook} gives a rather fuller outline of the theory of automatic groups and regular languages.

\begin{definition}
A \textbf{deterministic finite automaton} $M$ on an alphabet $A$ (or $A$-DFA) is a finite set $S$ of states, a distinguished \textbf{start state} in $s_0 \in S$, a set $Y \subset S$ of \textbf{accepting states} and a \textbf{transition function} $\sigma : S \times A \to A$.

Given a word $w = a_1a_2 \cdots a_n$ whose letters are in $A$, we say that $M$ \textbf{accepts} $w$ if $\tilde{\sigma}(s_0, w) := \sigma(\sigma(\sigma(s_0, a_1), a_2), \ldots a_n) \in Y$ - that is, if one begins with the start state and applies each letter of $w$ in turn through $\sigma$, one arrives in an accepting state. The repeated application of $\sigma$ in this way is called \textbf{reading} $w$.

The set of all words accepted by $M$ is the \textbf{language} of $M$.

A set of words whose letters are in $A$ is a \textbf{regular language} if it is accepted by an $A$-DFA.
\end{definition}

There are many other definitions of a regular language which are equivalent to this, for instance, regular expressions and nondeterministic finite state automata. We will not need these definitions, however, so we omit them.

Some simple examples of regular languages are the set of all words with letters in $A$, ie.\ $A^*$, any finite subset of $A^*$, and any full set of words whose letters are from a subset of $A$, ie.\ $B^*$ where $B \subset X$. Regular languages are closed under union, intersection, concatenation, reversal and complement; most of these facts are most simply proved using the non-deterministic FSA definition.

Automatic groups are a class of groups for which there is a regular language $W$ which maps surjectively onto $G$, and such that, if $x$ is the identity, a generator or the inverse of a generator, there is a two-variable DFA $M_x$ (a multiplier automaton) which reads two words $u, v \in W$ synchronously and accepts if and only if $ux =_G v$. The definition of two-variable automata is made more complicated by the possibility of $u$ and $v$ being of different lengths and will not be used in this thesis, so we omit it.

P.\ Papasoglu proved in \cite{papasoglu1995strongly} that a group is hyperbolic if and only if the set of all geodesic words yields an automatic structure for the group (that is, if the group is strongly geodesically automatic). In fact, the set of short-lex least representatives of elements of a hyperbolic group under any ordering of the generators is also a suitable language $W$ for the above definition.

In particular for a hyperbolic group generated by a set $X$, there is an $(X \cup X^{-1})$-DFA whose language is the set of all short-lex least words, the \textbf{short-lex automaton}, and another $(X \cup X^{-1})$-DFA whose language is the set of words which label geodesics in the group's Cayley graph, the \textbf{geodesic automaton}.

Much like with hyperbolicity, it is impossible to determine whether or not an arbitrary finitely presented group is automatic -- in fact, the problem here is made even more difficult as one must search for a regular set $W$, which might not be something easily described like the set of geodesic words. However, as noted above, the set of short-lex least words forms a suitable set of representatives which somewhat simplifies this check.

There is one particular property that we will use of a DFA, that they obey the pumping lemma (see \cite{hopcraft--ullman}, Lemma 3.1 for example). A quick sketch proof is given here, as a similar technique is used in Section \ref{section:holt}.

\begin{proposition}
\label{prop:pumpinglemma}
Suppose $M$ is an $A$-DFA. Then there is a constant $K$ such that for any word $w$ in the language of $M$ with $|w| > K$ there are words $a, b, c \in A^*$ such $w = abc$, $|b| > 0$ and $ab^nc$ is in the language of $M$ for all $n > 0$.
\end{proposition}

\begin{proof}
Let $K$ be the number of states in $M$, let $s_0$ be its start state and let $\sigma$ be its transition function. If $|w| \ge K$ then when reading $w$, some state is hit twice, ie.\ there is some state $s$ with $s = \tilde{\sigma}(s_0, w(i)) = \tilde{\sigma}(s_0, w(j))$ for some $i < j$. Then $\tilde{\sigma}(s, w(i:j)) = s$, so let $a := w(i)$, $b := w(i:j)$ and $c := w(j:|w|)$ and for any $n > 0$ we have $\tilde{\sigma}(ab^nc) = \tilde{\sigma}(abc) = \tilde{\sigma}(w)$. In particular, $ab^nc$ is also accepted by $M$.
\end{proof}

\section{Other notation}

We close this chapter with some other miscellaneous notation which is used throughout.

Many of the results below relate to conjugacy. We adopt a shorthand to express conjugation.

\begin{defn}
Supposing $g, h \in G$, we will denote conjugation of $g$ by $h$ using superscripts, so that $g^h = h^{-1}gh$.
\end{defn}

Finally, many of the results below attempt to express things as being ``equal plus or minus delta'', so to avoid lots of duplicate inequations, we define a symbol to express this.

\begin{defn}
If $a, b, c \in \mathbb{R}$ satisfy $a + c \ge b \ge a - c$ then we write $a =^c b$.
\end{defn}

\chapter{Conjugacy Problem for Lists of Elements}

\label{chapter:conjugacy}

\section{Introduction}

In \cite{bridson2005conjugacy}, Bridson and Howie give a solution of the conjugacy problem for finite lists $A = (a_1, \ldots, a_m)$ and $B = (b_1, \ldots, b_m)$ of elements in a hyperbolic group -- in fact, they prove that the problem is solvable in time $O(m \mu^2)$ for a torsion free group, where $\mu$ is the total length of elements in both lists.

The aim here is to both improve the bound on running time to $O(m^2\mu)$ or $O(m\mu)$ in the torsion-free case, and to tie up the rather limp conclusion in part 2 of Theorem B of \cite{bridson2005conjugacy}, in which their algorithm simply terminates when the lists contain entirely elements of finite order without giving any results on the conjugacy.

The ideas used here closely relate to the ideas in \cite{epstein2006linearity}, in which Epstein and Holt show that the conjugacy problem for single elements in a hyperbolic group can be solved in linear time if one assumes a RAM model of computing. They do so by showing that infinite order elements tend to be well-behaved when raised to large powers, and finite order elements can be conjugated to elements of short length whose conjugacy can be precomputed. In fact, we use a number of results from that paper which relate to these facts in order to establish the result here.

Of course, as in the aforementioned paper, we are assuming a RAM model of computing -- that is, we are assuming the basic operations such as addition and multiplication of integers takes place in constant time, which is reasonable when one assumes that one is not dealing with integers greater than some large upper bound, say $2^{31}$ -- that is, those integers which would fit within a standard 32-bit word. Since all of the length-related constants are computed explicitly, we can assume the input is short enough to never fill the system RAM. 

We will presume for the duration of this chapter that the ambient finitely generated group $G$ has been fixed along with a finite generating set $X$, and that $G$ is $\delta$-hyperbolic for some $\delta \ge 1$ with respect to this generating set. All words in this chapter are $X$-words, and all geometric constructions occur inside the Cayley graph $\Gamma$ of $G$ with respect to $X$, inside which we will assume that the vertex $\vertex{e}$ represents the identity element of $G$.

We will also assume that an ordering on the generators has been picked, so that the notion of a short-lex least representative word for each element exists and that the short-lex word acceptor for $G$ has been computed.

Finally, we will assume that the lengths of every word in the input lists is at least $1$. This is only important for complexity estimates as we wish for $m \in O(\mu)$ which is not true if the lists contain only empty words! This is a reasonable assumption because the identity is conjugate only to itself so testing conjugacy against the empty word simply reduces to the word problem: If $a_i$ is the identity and $b_i$ is not, the lists are not conjugate. If they are both the identity, simply remove the elements from both lists.

The technicalities behind the proof in the case where one element, say $a_1$, has infinite order are largely covered by solving the conjugacy problem $a_1^h =_G b_1$ for $h$ as in \cite{epstein2006linearity}. In the process of doing so, we can find a useful description of elements of the centraliser $C$ of $a_1$ and then test if for some $c \in C$ we have $A^{ch} =_G B$. Of course $C$ is infinite, so it is important to perform this testing efficiently. Section \ref{section:inf_order} describes a way of doing so.

Unfortunately, since we can only obtain this form of the centraliser for infinite order elements we run up against problems when we consider lists of torsion elements. It is, however, possible to show that provided we bound the number of elements in our lists, we can efficiently either find a pair of lists $A'$ and $B'$ such that $A^h =_G B$ if and only if $A'^h =_G B'$ and such that either $A'$ contains an infinite order element or each element of $A'^g$ is of bounded length for some element $g$. In the latter case, one may simply use the exponential algorithm given in \cite{bridson2005conjugacy} to finish the solution.

The disadvantage of computing in this way is that for lists with more elements, the amount of computation required grows in at least exponential fashion. However, it can be shown that if there are sufficiently many finite order elements in the list then its centraliser is finite. In particular, there are only a finite number of elements which can simultaneously conjugate the initial elements of one list to the initial elements of the other, so we need only test these elements on the remainder of the lists to complete the procedure.

Putting all of these approaches together, we have:

\begin{theorem}
Given integers $\delta \ge 1$ and $l$, there is an algorithm which, given a $\delta$-hyperbolic group $G=<X|R>$ with $|X| \le l$ and lists $A=(a_1, a_2, \ldots, a_m)$ and $B=(b_1, b_2, \ldots, b_m)$ of words in the generators of $G$ can, in time $O(m^2(||A||+||B||))$ find a list of pairs of words $(s_i, z_i)$ such that elements $g$ with $A^g =_G B$ are exactly those elements which can be expressed in the form $s_iz_i^n$ for some $n \in \mathbb{Z}$.
\end{theorem}

Because the methods here express all conjugating elements, they additionally allow computation of the centraliser of a list of elements. 

\section{Preliminaries}

In this section, we provide some results which are used during the remainder of the chapter.

First, recall Lemma \ref{lemma:short_lex}, that we have a function $\slex$ which can find the short-lex least representative in $G$ of any word and can be computed in time linear in word length.

\subsection{Some constants}

\label{section:conj_const}

There are a number of constants which will be used throughout this chapter. These are:

\begin{itemize}
\item $L := 34\delta + 2$
\item $V$, the number of vertices in $B_{2\delta}(\vertex{e})$
\item $Q$, the number of vertices in $B_{4\delta}(\vertex{e})$
\item $M := 10^4\delta^2V^3L^3$
\end{itemize}

\subsection{Simple results}

\begin{lemma}
\label{lemma:triangle}
Suppose $\alpha$ is a geodesic triangle with corners on vertices $\vertex{x}$, $\vertex{y}$ and $\vertex{z}$, and that $\vertex{p}$ is a mid-vertex on the geodesic $\path{\vertex{x}}{\vertex{y}}$. Then \[
d(\vertex{p}, \vertex{z}) \le \frac{2\max\{d(\vertex{x}, \vertex{z}), d(\vertex{y}, \vertex{z})\} - d(\vertex{x}, \vertex{y}) + 1}{2} + \delta.
\]

\begin{figure}
\begin{center}
\begin{picture}(7,2)(-0.2,-0.05)
\put(0,0){\line(1,0){6}}
\put(0,0){\line(2,1){2}}
\put(2,1){\line(4,-1){4}}

\put(0,0){\circle*{0.05}} % x
\put(-0.2,-0.1){\makebox(1,1)[bl]{$\vertex{y}$}}
\put(6,0){\circle*{0.05}} % y
\put(6.1,-0.1){\makebox(1,1)[bl]{$\vertex{x}$}}
\put(2,1){\circle*{0.05}} % z
\put(1.8,1.05){\makebox(0.4,1)[b]{$\vertex{z}$}}

\put(2.5,0.875){\circle*{0.05}} % c_x
\put(2.5,0.925){\makebox(0.3,1)[b]{$c_y$}}
\put(1.5,0.75){\circle*{0.05}} % c_y
\put(1.3,0.8){\makebox(0.3,1)[b]{$c_x$}}
\put(2.1,0){\circle*{0.05}} % c_z
\put(1.8,0.05){\makebox(0.4,1)[b]{$c_z$}}
\put(3,0.){\circle*{0.05}} % p
\put(2.8,0.05){\makebox(0.4,1)[b]{$p$}}
\end{picture}
\caption{A Triangle in Hyperbolic Space}
\label{figure:hyp_tri}
\end{center}
\end{figure}
\end{lemma}

\begin{proof}
Let $\path{\vertex{x}}{\vertex{y}}$, $\path{\vertex{x}}{\vertex{z}}$, and $\path{\vertex{y}}{\vertex{z}}$ be the geodesic sides of the triangle.

Assume that $d(\vertex{x}, \vertex{z}) > d(\vertex{y}, \vertex{z})$, as in Figure \ref{figure:hyp_tri}. Note that \begin{eqnarray*}
        d(\vertex{x}, \vertex{p})
& \le & \frac{d(\vertex{x}, \vertex{y}) + 1}{2} \\
& \le & \frac{d(\vertex{x}, \vertex{y}) + d(\vertex{x}, \vertex{z}) - d(\vertex{y}, \vertex{z})}{2} \\
&  =  & (\vertex{y}, \vertex{z})_{\vertex{x}},
\end{eqnarray*} so $\vertex{p}$ corresponds to a vertex $\vertex{q}$ on $\path{\vertex{x}}{\vertex{z}}$. Notice that \begin{eqnarray*}
        d(\vertex{p}, \vertex{z})
& \le & d(\vertex{p}, \vertex{q}) + d(\vertex{q}, \vertex{z}) \\
& \le & \delta + d(\vertex{x}, \vertex{z}) - d(\vertex{q}, \vertex{x}) \\
&  =  & \delta + d(\vertex{x}, \vertex{z}) - d(\vertex{p}, \vertex{x}) \\
& \le & d(\vertex{x}, \vertex{z}) + \delta - \frac{d(\vertex{x}, \vertex{y}) + 1}{2},
\end{eqnarray*} as required for this case. We proceed similarly if $d(\vertex{x}, \vertex{z}) < d(\vertex{y}, \vertex{z})$.

It remains to consider the case where $d(\vertex{x}, \vertex{z}) = d(\vertex{y}, \vertex{z})$. If $d(\vertex{x}, \vertex{y})$ is even then $\vertex{p}$ must be the meeting point on $\path{\vertex{x}}{\vertex{y}}$. Otherwise, suppose that $d(\vertex{p}, \vertex{x}) = (\vertex{y}, \vertex{z})_{\vertex{x}} - \frac{1}{2}$ so that $\vertex{p}$ corresponds to a vertex on $\path{\vertex{x}}{\vertex{z}}$ which must be within $\frac{1}{2}$ of the meeting point on that side. In either of these cases, \begin{eqnarray*}
        d(\vertex{p}, \vertex{z})
& \le & d(\vertex{p}, \vertex{q}) + d(\vertex{q}, \vertex{z}) \\
& \le & \delta + (\vertex{x}, \vertex{y})_{\vertex{z}} + \frac{1}{2} \\
&  =  & \frac{d(\vertex{x}, \vertex{z}) + d(\vertex{y}, \vertex{z}) - d(\vertex{x}, \vertex{y}) + 1}{2} + \delta \\
&  =  & \frac{2\min\{d(\vertex{x}, \vertex{z}),d(\vertex{y}, \vertex{z})\} - d(\vertex{x}, \vertex{y}) + 1}{2} + \delta
\end{eqnarray*} as required. If $d(\vertex{p}, \vertex{x}) = (\vertex{y}, \vertex{z})_{\vertex{x}} + \frac{1}{2}$ then interchange $\vertex{x}$ and $\vertex{y}$ in the above argument to get the same result.
\end{proof}

\begin{lemma}
\label{lemma:replace}
Suppose $g, a_1, a_2, b_1, b_2 \in G$. Then $(a_1, a_2)^g = (b_1, b_2)$ if and only if $(a_1a_2, a_2)^g = (b_1b_2, b_2)$.
\end{lemma}

\begin{proof}
The proof is elementary; the forward implication can be derived from the identity $(a_1a_2)^g = a_1^ga_2^g$ and the reverse from $a_1^g = (a_1a_2)^g(a_2^{-1})^g$.
\end{proof}

One can extend this to show that we can multiply any elements in a pair of lists together without altering the set of conjugating elements, provided we do the same in both lists.

\subsection{Results from \cite{alonso1990notes}}

The following three results summarise well known properties of hyberbolic spaces. The exact values in the statements are taken from the proofs in \cite{alonso1990notes}. The first is Proposition 3.2 of \cite{alonso1990notes}. 

\begin{proposition}
\label{prop:inf_order_qgeo}
For any infinite order $\Gamma$-geodesic word $w$, the two way infinite path in $\Gamma$ defined by $w^\infty$ is a $(\lambda, \epsilon)$-quasigeodesic, where $\lambda = |w|V$ and $\epsilon = 2|w|^2V^2 + 2|w|V$.
\end{proposition}

The next is Theorem 2.19 of \cite{alonso1990notes}.

\begin{proposition}
\label{prop:hyperbolic_divergence}
The function $e:\mathbb{R}_{\ge0} \to \mathbb{R}_{\ge0}$ with $e(0) = \delta$ and $e(l) = 2^{\frac{l}{\delta} - 2}$ for $l > 0$ is a divergence function for any $\delta$-hyperbolic space (ie. given geodesics $\gamma = \path{x}{y}$ and $\gamma' = \path{x}{z}$, $r, R \in \mathbb{N}$ such that $r + R < \min(|\gamma|, |\gamma'|)$ and $d(\gamma(R), \gamma'(R)) > e(0)$, if $\alpha$ is a path from $\gamma(R + r)$ to $\gamma'(R + r)$ lying outside the ball of radius $R + r$ around $x$, then $|\alpha| > e(r)$).
\end{proposition}

Finally, Proposition 3.3 of \cite{alonso1990notes}.

\begin{proposition}
\label{prop:qgeo_close_to_geo}
In a hyperbolic space with divergence function $e$, given $\lambda \ge 1$ and $\epsilon \ge 0$, there exists $D = D(\lambda, \epsilon, e)$ such that for any $(\lambda,\epsilon)$-quasigeodesic $\alpha$ and geodesic $\gamma$ starting and ending at the same points as $\alpha$, every point on $\gamma$ is within a distance $D$ of a point on $\alpha$. It suffices to take $D$ satisfying $e(\frac{D - e(0)}{2}) \ge 4D + 6\lambda D + \epsilon$.
\end{proposition}

Together, these results will be used to find some power $n$ of an infinite order word $w$ such that $|(w^n)_C|_G$ is large.

\subsection{Results from \cite{epstein2006linearity}}

\label{section:holt}

In \cite{epstein2006linearity} (Section 3), it's proved that the conjugacy problem for single elements is linear in the total input element length. The proof has several steps. The first few will be followed here as well.

The first step is to show that elements that are ``difficult to shorten'' are actually of infinite order, and behave nicely when raised to large powers. This result is Lemma 3.1 of \cite{epstein2006linearity}.

\begin{proposition}
\label{prop:short_conj}
Let $w$ be some short-lex least word. Let $u$ be the short-lex least representative of $w_C$. If $u$ has length strictly greater than $2L$, then all positive powers of $u$ label $L$-local $(1, 2\delta)$-quasigeodesics.
\end{proposition}

In Proposition 2.3 of \cite{epstein2006linearity} it is proved that such a local quasigeodesic lies close to a geodesic.

\begin{proposition}
\label{prop:nice_qgeo}
If $w$ is an $L$-local $(1, 2\delta)$ quasigeodesic in $\Gamma$, and $u$ is a geodesic connecting its endpoints, then every point on $w$ is within $4\delta$ of a point on $u$ and vice versa. Also, if $|w| \ge L$ then $|u| \ge \frac{7|w|}{17}$.
\end{proposition}

In particular, if $|w_C| > 2L$ then $w$ is of infinite order as there is no bound on the length of shortest representatives of its powers.

The next step is to show that such a word $u$ can be equated with some root of a conjugate of a short-lex straight word. The following two results summarise Section 3.2 of \cite{epstein2006linearity}.

\begin{proposition}
\label{prop:long_conj_slex}
Suppose $u$ is some short-lex least word such that all positive powers of $u$ label $L$-local $(1, 2\delta)$-quasigeodesics and $|u| > L$. Then there exists some integer $0 < k \le Q^2$ and some word $a$ whose length is less than or equal to $4\delta$ such that $\slex(a^{-1}u^ka)$ is short-lex straight.
\end{proposition}

\begin{proposition}
\label{prop:test_sls}
Given a short-lex least word $u$, testing if $u$ is short-lex straight takes time at most $O(|u|)$.
\end{proposition}

This proposition can be proved in a similar way to the Pumping Lemma, Proposition \ref{prop:pumpinglemma}. Repeatedly read $u$ through the short-lex word acceptor until some state is hit for the second time after reading a complete copy of $u$. In this case, reading $u$ again will just cycle over previous states so $u$ must be short-lex straight.

The following pseudocode illustrates the procedure of finding a short-lex straight power:

\begin{algorithmic}[1]
\Function{TestSLS}{$u$}
\State $WA\gets$ \Call{ShortLexWordAcceptor}{$G$}
\State $S\gets$ \Call{States}{$WA$}
\State $w\gets u^{|S|}$
\For{$s\in S$}
	\State $visited[s]\gets false$ \Comment{States hit after reading complete copies of $u$}
\EndFor
\State $s\gets$ \Call{StartState}{$WA$}
\State $f\gets$ \Call{TransitionFunction}{$WA$}
\State $visited[s]\gets true$
\For{$i:= 1$ to $|w|$}
	\State $s \gets f(s, w[i])$
	\If{$\neg$ \Call{IsAcceptState}{$WA, S$}}
		\State \textbf{return} false
	\EndIf
	\If{$i=0\mod|u|$}
		\If{$visited[s]$}
			\State \textbf{return} true
		\EndIf
		\State $visited[s]\gets true$
	\EndIf
\EndFor
\EndFunction
\Function{FindSLSPower}{$a$}
\For{$h \in B_{4\delta}(1)$}\Comment{Find straight power using Proposition \ref{prop:long_conj_slex}}
	\For{$i \in \{1, \ldots, Q^2\}$}
		\If{\Call{TestSLS}{$\pi(h^{-1}a^ih)$}}\Comment{Must happen at least once}
			\State \textbf{return} $h, i$
		\EndIf
	\EndFor
\EndFor
\EndFunction
\end{algorithmic}

Once a word is short-lex straight, it is easier to test a conjugacy against it. The next result summarises Section 3.3 of \cite{epstein2006linearity}.

\begin{proposition}
\label{prop:test_conj_sls}
If $u$ is short-lex straight and $v$ is a word such that $v^\infty$ is a $(1, 2\delta)$ $L$-local quasigeodesic with $|v|_G > L$, and $g^{-1}vg =_Gu$ for some $g$, then there exists a word $h$ with $|h| \le 6\delta$ such that $h^{-1}vh$ is a cyclic conjugate of $u$. 
\end{proposition}

Thus the following pseudocode will test conjugacy of such words $u$, $v$:

\begin{algorithmic}[1]
\Function{TestConjugacySLSLong}{$u, v$}
\For{$h \in B_{6\delta}(1)$}\Comment{Test conjugacy using Proposition \ref{prop:test_conj_sls}}
	\State $i \gets$ \Call{FindSubString}{$u^2$, $\pi(h^{-1}vh)$}
	\If{$i$ is not null}
		\State \textbf{return} $h^{-1}u(i)$
	\EndIf
\EndFor
\State \textbf{return} $null$
\EndFunction
\end{algorithmic}

Also, a refinement of the proof of the above statement gives a nice form for elements of the centraliser of a short-lex straight word. This result summarises Section 3.4 of \cite{epstein2006linearity}.

\begin{proposition}
\label{prop:find_centraliser_sls} 
If $z$ is short-lex straight and $y^l=z$ with $l$ maximal, then $g\in C_G(z)$ implies that $g=_Gy^iy_1h$, with $y_1$ a prefix of $y$, $i\in \mathbb{Z}$ and $|h| \le 2\delta$. Further, $y_1$ depends only on $h$.

$l$, $y$ and the set of words $y_1h$ can be computed in time $O(|z|)$.
\end{proposition}

Again, here is the algorithm in pseudocode:

\begin{algorithmic}[1]
\Function{FindSLSCentraliserSuperset}{$z$}
\State $i \gets$ \Call{FindSecondSubString}{$z^2$, $z$}
\State $y \gets z(i)$ 
\State $S \gets []$
\For{$h \in B_{2\delta}(1)$}\Comment{Find centraliser of $a$ using Proposition \ref{prop:find_centraliser_sls}}
	\State $i \gets$ \Call{FindSubString}{$z^2$, $\pi(hzh^{-1})$}
	\If{$i$ is not null}
		\State $u \gets z(i)$
		\State \Call{Push}{$S$, $uh$}
	\EndIf
\EndFor
\State \textbf{return} $y, S$
\EndFunction
\end{algorithmic}

Suppose that $z=\slex(a^{-1}(u_C)^ia)$ is short-lex straight, that $y^l=z$ with $l$ maximal, that $v^\infty$ is an $L$-local $(1,2\delta)$ quasigeodesic, that $b^{-1}zb=_G v^i$ and that $g^{-1}ug=_Gv$. Note that \begin {eqnarray*}
        b^{-1}zb
& =_G & v^i \\
& =_G & g^{-1}u^ig\\
& =_G & g^{-1}u_Lu_C^i(u_L)^{-1}g\\
& =_G & g^{-1}u_Laz a^{-1}(u_L)^{-1}g
\end{eqnarray*} so that $a^{-1}(u_L)^{-1}gb^{-1} \in C_G(z)$, and so is equal in $G$ to $y^ny_1h$ where $n$ is some integer, $h$ is a word of length at most $2\delta$ and $y_1$ is a prefix of $y$ that depends only on $h$. Therefore $g=_Gu_Lay^ny_1hb$.

This fact is used in the following algorithm which returns a word $p$ of length $O(|u|)$, a short-lex straight word $y$ of length $O(|u|)$ and a set $S$ of at most $V$ words each of length $O(|u| + |v|)$ such that if $g^{-1}ug =_Gv$ then $g=_Gpy^ns$ for some $n \in \mathbb{Z}$ and some $s\in S$.

\begin{algorithmic}[1]
\Function{GetConjugationCandidatesHE}{$u, v$}
\State $a, i \gets$ \Call{FindSLSPower}{$u_C$}
\State $z \gets \pi(a^{-1}(u_C)^ia)$
\State $b \gets$ \Call{TestConjugacySLSLong}{$z, \pi((v_C)^i)$}
\If{$b$ is null}
	\State \textbf{return} $1,1,\{\}$
\EndIf
\State $y, S \gets$ \Call{FindSLSCentraliserSuperset}{$z$}
\State \textbf{return} $u_La,y,\{sb(v_L)^{-1}:s\in S \}$
\EndFunction
\end{algorithmic}

\section{Infinite Order Elements}

In this section, we suppose that we are given lists $A = (a_1, \ldots, a_m)$ and $B = (b_1, \ldots, b_m)$, that $a_1$ is of infinite order, and that the lists need to be checked for conjugacy. In order to apply the algorithm \textsc{GetConjugationCandidatesHE}, a sensible first step is to find words $u$ and $v$ related to $a_1$ and $b_1$ which are a valid input, ie.\ such that $|u_C| > 2L$ and $|v_C| > 2L$ so that this algorithm can be applied usefully.

\begin{proposition}
\label{prop:make_long}
Let $w$ be any infinite order $\Gamma$-geodesic word with $|w| \le 2L$. Then $|(\slex(w^M))_C| > 2L$.
\end{proposition}

\begin{proof}
By Proposition \ref{prop:hyperbolic_divergence}, the function $e(0)=\delta$, $e(l)=2^{\frac{l}{\delta}-2}$ for $l > 0$ is a divergence function for $\Gamma$. By Proposition \ref{prop:inf_order_qgeo}, $w^\infty$ is a $(|w|V, 2|w|^2V^2 + 2|w|V)$-quasigeodesic $\gamma$. The first aim is to find a suitable $D$ for Proposition \ref{prop:qgeo_close_to_geo}.

Let $D := 10^4\delta^2LV$. Then \begin{eqnarray*}
        e(\frac{D - \delta}{2})
&  =  & 2^{\frac{D}{2\delta} - \frac{5}{2}} \\
&  =  & \frac{1}{4\sqrt2} \left(e^{\frac{D}{2\delta}}\right)^{\log 2},
\end{eqnarray*} but $e^x > \frac{x^3}{3!} > \left(\frac{x}{3}\right)^3$ for any $x > 1$, so noting that $3\log 2 \ge 2$, we have \begin{eqnarray*}
        e(\frac{D - \delta}{2})
& \ge & \frac{1}{4\sqrt2} \left(\frac{D}{2\times3\delta}\right)^{3\log 2} \\
& \ge & \frac{1}{4\sqrt2} \left(\frac{D}{6\delta}\right)^2
\end{eqnarray*} and by substituting in $D$ \begin{eqnarray*}
        e(\frac{D - \delta}{2})
& \ge & \frac{1}{4\sqrt2} \left(\frac{10^4\delta LV}{6}\right)^2 \\
&  =  & \frac{10^8}{36\times 4\sqrt2} \delta^2L^2V^2 \\
& \ge & 480000\delta^2L^2V^2.
\end{eqnarray*} Recall that $|w| \le 2L$, and $w^\infty$ is a $(\lambda, \epsilon)$-quasigeodesic with $\lambda = |w|V$ and $\epsilon = 2|w|^2V^2+2|w|V$, so \begin{eqnarray*}
        e(\frac{D - \delta}{2})
& \ge & (12+12+12+12)\times10^4\delta^2 L^2 V^2 \\
& \ge & 12\times10^4\delta^2 L^2 V^2 + 12\times10^4\delta^2 L^2 V^2 + 12\times10^4\delta^2 L^2 V^2 + 12\times10^4\delta^2 L^2 V^2 \\
& \ge & 4\times10^4\delta^2 LV + 12LV \times10^4 \delta^2 LV + 8L^2 V^2 + 4LV \\
& \ge & 4\times10^4\delta^2 LV + 6|w|V \times10^4\delta^2LV + 2|w|^2V^2 + 2|w|V \\
&  =  & 4D + 6\lambda D + \epsilon.
\end{eqnarray*}

Thus picking $n \in \mathbb{N}$ and some geodesic path $\path{1}{w^n}$, by Proposition \ref{prop:qgeo_close_to_geo} each point on $\path{1}{w^n}$ lies within $D$ of some point on $\gamma$.

Let $\vertex{x} := \vertex{e}$, $\vertex{y} := \vertex{x} \cdot w^M$ and $\vertex{z} := \vertex{y} \cdot w^M$, recalling that $M =10^4\delta^2 L^3V^3 = L^2V^2D$. Let $\path{\vertex{x}}{\vertex{y}}$ and $\path{\vertex{y}}{\vertex{z}}$ be labelled $u := \slex(w^M)$ and let $\vertex{p} := \vertex{x} \cdot u_L$ and $\vertex{q} := \vertex{y} \cdot u_L$. See figure \ref{figure:make_long}.

\begin{figure}
\begin{center}
\input fig3_make_long.pstex_t
\caption{Cutting across a long quasigeodesic}
\label{figure:make_long}
\end{center}
\end{figure}

There exists a point $\vertex{p'} := \vertex{x} \cdot w^M(i)$ on $\gamma$ where $i \le M|w|$ which is within $D$ of $p$, and letting $\vertex{q'} := \vertex{y} \cdot w^M(i)$ we find that $d(\vertex{q'}, \vertex{q}) \le D$ also. Now \begin{eqnarray*}
        |u_C|
&  =  & d(\vertex{p}, \vertex{q}) \\
& \ge & d(\vertex{p'},\vertex{q'}) - 2D \\
& \ge & \frac{d_\gamma(\vertex{p'}, \vertex{q'})}{\lambda} - \epsilon - 2D \\
&  =  & \frac{|w|M}{\lambda} - \epsilon - 2D \\
& \ge & \frac{M}{\lambda} - \epsilon - 2D \\
&  =  & \frac{L^2V^2D}{\lambda} - \epsilon - 2D \\
& \ge & \frac{|w|V\times LVD}{2\lambda} -2|w|^2V^2 - 2|w|V - 2D \\
& \ge & \frac{\lambda LVD}{2\lambda} - 8L^2V^2 - 4LV - 2D \\
&  =  & LV(5000 \delta^2LV - 8LV-4-20000\delta^2).
\end{eqnarray*} Note that $V \ge 2\delta + 1 \ge 5$ and $L = 34\delta +2 \ge 36$, so  $VL \ge 180$ and \begin{eqnarray*}
        |(\slex (w^M))_C|
&  >  & LV(8\delta^2LV - 8LV + 6\delta^2LV - 4 + (5000 - 14) \delta^2LV - 20000 \delta^2) \\
&  >  & LV(8LV - 8LV + 6 - 4 + 180 \times 4986 \delta^2 - 20000 \delta ^2) \\
&  >  & 2L
\end{eqnarray*} as required.
\end{proof}

\begin{remark}
The value of $M$ used above is of course by no means optimal. The powers of $L$, $V$ and $\delta$ used in $D$ can be reduced at the cost of a potentially larger constant by increasing the degree in the polynomial bound for $e^n$, and in any case for a particular group and presentation, it is likely that a much lower bound can be obtained by solving the problem algorithmically. However, the above bound illustrates that there is a definite computable value.
\end{remark}

By this proposition, short infinite order words can be raised to large powers to get an appropriate input for \textsc{GetConjugationCandidatesHE}. It remains to confirm that words which are already appropriate inputs stay appropriate when raised to the power of $M$.

\begin{lemma}
\label{lemma:long_stays_long}
Suppose that $w$ is a word and $|w_C| > 2L$. If $n \ge L$ then $|(\slex((w_C)^n))_C| > 2L$. In particular, $|(\slex((w_C)^M))_C| > 2L$.
\end{lemma}

\begin{proof}
Let $r:=\slex((w_C)^n)$, and let $\gamma$ be the path starting at $\vertex{x} := \vertex{e}$ labelled by $(w_C)^{2n}$. Let $\vertex{y} := \vertex{y} \cdot r$ and let $\vertex{z} := \vertex{y} \cdot r$. Now let $\vertex{p} := \vertex{x} \cdot r_L$ and let $\vertex{q} := \vertex{y} \cdot r_L$ so that $p$ and $q$ are mid-vertices on the short-lex geodesic paths $\path{\vertex{x}}{\vertex{y}}$ and $\path{\vertex{y}}{\vertex{z}}$ respectively and $r_C$ labels a path from $\vertex{p}$ to $\vertex{q}$.

Note that $\gamma$ is an $L$-local $(1, 2\delta)$-quasigeodesic by Proposition \ref{prop:short_conj}, so Proposition \ref{prop:nice_qgeo} applies. Then there is a vertex $\vertex{p'} = \vertex{x} \cdot (w_C)^n(i)$ for some $i$ with $d(\vertex{p'}, \vertex{p}) \le 4\delta$. Let $\vertex{q'} := \vertex{y} \cdot (w_C)^n(i)$ so that $d(\vertex{q'}, \vertex{q}) \le 4\delta$ also. Since $d_\gamma(\vertex{p'}, \vertex{q'}) = n|w_C| \ge L$, Proposition \ref{prop:nice_qgeo} also gives a lower bound on $d(\vertex{p'}, \vertex{q'})$ as follows: \begin{eqnarray*}
        d(p, q)
& =^{8\delta} & d(p',q') \\
& \ge & \frac{7}{17}d_\gamma(p', q') \\
&  =  & \frac{7}{17}|(w_C)^n| \\
&  =  & \frac{7}{17}n|w_C| \\
&  >  & \frac{14}{17}Ln.
\end{eqnarray*}

But then \begin{eqnarray*}
        |(\slex((w_C)^n))_C|
&  =  & |r_C| \\
&  =  & d(p, q) \\
& \ge & \frac{14}{17}Ln - 8\delta \\
& \ge & 2L
\end{eqnarray*} as required.
\end{proof}

Therefore, by the above 2 results $|(\slex((u_C)^M))_C| > 2L$ for any infinite order word $u$. In particular, \textsc{GetConjugationCandidatesHE} can be applied to $\slex(((a_1)_C)^M)$ and $\slex(((b_1)_C)^M)$ by executing \textsc{GetConjugationCandidates}$(a_1,b_1)$ as defined in the following pseudocode:

\begin{algorithmic}[1]
\Function{GetConjugationCandidates}{$u, v$}
\State $c \gets \slex((u_C)^M)$
\State $d \gets \slex((v_C)^M)$
\State $g, y, S \gets$ \Call{GetConjugationCandidatesHE}{$c, d$}
\State \textbf{return} $u_Lg, y, \{sv_L^{-1}:s\in S \}$
\EndFunction
\end{algorithmic}

For convience in later chapters, we at this point summarise the above results.

\begin{corollary}
\label{cor:find_sls_and_conj_form}
Suppose $u$ and $v$ are $X$-words which are conjugate and infinite order in $G$. Then there exists an integer $k \le KQ^2$ and an $X$-word $w$ of length at most $(M+1)|u| + 4\delta$ such that: \begin{enumerate}
\item $z := \slex((u^k)^w)$ is short-lex straight, and
\item any element $g \in G$ with $u^g =_G v$ has $g =_G u^ih$ where $i$ is an integer and $h$ is an $X$-word of length at most $3MQ^2(|u|+|v|)+12\delta$.
\end{enumerate}
\end{corollary}

\begin{proof}
Let $u_1 := \slex(u)$, let $u_2 := \slex(((u_1)_C)^M)$ and let $u_3 := \slex((u_2)_C)$. By Proposition \ref{prop:make_long} or Lemma \ref{lemma:long_stays_long} we know that $|u_3| > 2L$. By Proposition \ref{prop:short_conj}, all positive powers of $u_3$ label $L$-local $(1, 2\delta)$-quasigeodesics and then by Proposition \ref{prop:long_conj_slex} we know that $u_4 := k^{-1}u_3^lk$ is short-lex straight for some $l \le Q^2$ and some $X$-word $k$ or length at most $4\delta$. Notice that $u_4 =_G (u^{lM})^{w_u}$ where $w_u := k(u_2)_L(u_1)_L$ so that $|w_u| \le \frac{(M+1)|u|}{2}+4\delta$. This proves the first part.

Suppose $u_4 = u_5^l$ for some integer $l$ (which we assume is maximal for this property). By Proposition \ref{prop:find_centraliser_sls} there is a set $S$ containing elements of the form $yp$, where $p$ is an $X$-word of length at most $2\delta$ and $y$ is a prefix of $u_5$ which depends only on $p$, such that every element of the centraliser of $u_4$ is of the form $u_5^iyp$. This is equal to $u_4^iu_5^jyp$ for some integers $i$ and $j$ with $0 \le j < l$ and some $yp \in S$. Notice that $|u_5^jyp| \le |u_4| + 2\delta \le MQ^2|u| + 2\delta$.

Construct $v_1$, $v_2$ and $v_3$ in the same way as $u_1$ through $u_3$, setting $w_v := (v_2)_L(u_1)_L$. Since $u$ and $v$ are conjugate, so are $u_4$ and $v_3^l$, so by Proposition \ref{prop:test_conj_sls} there is an $X$-word $h$ with $|h| \le 6\delta$ such that $u_4^h =_G v_3^l$. Now any element of $G$ conjugating $u_4$ to $v_3^l$ is of the form $u_5^iyph$ for some integer $i$ and some $yp \in S$. Then $g$ must be equal to $w_uu_4^iu_5^jyphw_v^{-1} =_G u^{lM}w_uu_5^jyphw_v^{-1}$ and $|w_uu_5^jyphw_v^{-1}| \le \frac{(M+1)((2Q^2+1)|u| + |v|)}{2} + 12\delta \le 3MQ^2(|u|+|v|)+12\delta$.
\end{proof}

Given these return values, the situation is now that there is a set $S$ of at most $V$ elements, each of which are of length $O(|a_1|+|b_1|)$, a short-lex straight word $y$ of length $O(|a_1|)$ and a word $p$ of length $O(|a_1|+|b_1|)$ such that any element $g$ with $A^g=_GB$ (and hence $a_1^g =_G b_1$) has $g=_Gpy^ns$ for some $s \in S$ and $n \in \mathbb{Z}$.

Since there are at most $V$ elements in $S$, they can be walked over in time depending only on the group. Testing conjugacy between the two lists can therefore be reduced to filtering the list of possible values of $n$ for each element of $S$. Assume, therefore, that some $s \in S$ has been picked. Replace $A$ with $\pi(A^p)$ and $B$ with $\pi(B^{s^{-1}})$ so that all candidates to be checked are now of the form $y^n$.

\subsection{Filtering the List of Candidates}

For this section, it is assumed that $A = (a_1, \ldots, a_m)$ and $B = (b_1, \ldots, b_m)$ are short-lex reduced, $y$ is a short-lex straight word, and we wish to find which, if any, $n \in \mathbb{Z}$ have $A^{y^n}=_GB$.

The method for finding these $n$ will be for each $i \in \{1, \ldots, m\}$ to find all $j \in \mathbb{Z}$ such that $a_i^{y^j} =_G b_i$, and then intersect the results. We will do this by estimating the lengths of $a_i^{y^j}$ and $b_i^{y^k}$ for large $j$ and $k$ and trying to fit one estimate over the other. These estimates will take different forms depending on whether or not some power of $y$ centralises $a_i$ (resp.\ $b_i$), so our first step is to attempt to test for this. From now on, suppose that $g$ is either $a_i$ or $b_i$ for some $i$. It is useful to know some properties of a ``geodesic trapezium,'' which the next lemma will give us.

\begin{figure}
\begin{center}

\input fig10_quad.pstex_t
\caption{The thin section of a geodesic quadrilateral}
\label{figure:thin_section}
\end{center}
\end{figure}

\begin{figure}
\begin{center}
\input fig11_quad_zoom.pstex_t
\caption{A part of figure \ref{figure:thin_section}}
\label{figure:quad_zoom}
\end{center}
\end{figure}

\begin{lemma}
\label{lemma:trapezium}
Let $\vertex{a}$, $\vertex{b}$, $\vertex{c}$ and $\vertex{d}$ be vertices in $\Gamma$ such that $l:= d(\vertex{a}, \vertex{b}) = d(\vertex{c}, \vertex{d})$. Let $\alpha_1 : [0, l] \to \Gamma$ be a geodesic path from $\vertex{a}$ to $\vertex{b}$ and let $\alpha_2 : [0, l] \to \Gamma$ be a geodesic path from $\vertex{d}$ to $\vertex{c}$. Define the constants \begin{eqnarray*}
K & := & d(\vertex{a}, \vertex{b}) - d(\vertex{b}, \vertex{d})  \\
N_1 & := & (\vertex{a}, \vertex{b})_{\vertex{d}} \\ 
N_2 & := & (\vertex{b}, \vertex{c})_{\vertex{d}}.
\end{eqnarray*}

For $i \in \mathbb{N}$:
\begin{enumerate}
\item If $N_1 \le i \le N_2$ then \[ d(\alpha_2(i), \alpha_1(i+K)) \le 2\delta. \]
\item If $N_1 + K \le i \le N_2 + K$ then \[ d(\alpha_2(i-K), \alpha_1(i)) \le 2\delta. \]
\item If $l \ge i \ge \max\{N_1 + K, N_2, N_2 +K\}$ then \[ d(\alpha_1(i), \alpha_2(i)) =^{3\delta} d(\vertex{b}, \vertex{c}) - 2 (l - i). \]
\end{enumerate}

If $l \ge i \ge d(\vertex{a}, \vertex{d})$ then at least one of these three cases applies.
\end{lemma}

\begin{proof}
Pick a geodesic $\gamma := \path{\vertex{b}}{\vertex{d}}$ so that we have two geodesic triangles, one with corners $\vertex{a}$, $\vertex{b}$, and $\vertex{d}$; the other with corners $\vertex{b}$, $\vertex{d}$ and $\vertex{c}$; both sharing a common side $v$. Also, let $\vertex{p}:= \alpha_2(i)$ and $\vertex{q}:= \alpha_1(i)$.

Suppose that $N_1 \le i \le N_2$. Note that $\vertex{p}$ corresponds to some point $\vertex{q''}$ on $\gamma$ which in turn corresponds to some point $\vertex{q'}$ on $\alpha_1$. Observe that \begin{eqnarray*}
      d(\vertex{a}, \vertex{q'})
& = & d(\vertex{a}, \vertex{b}) - d(\vertex{b}, \vertex{q'}) \\
& = & d(\vertex{a}, \vertex{b}) - d(\vertex{b}, \vertex{q''}) \\
& = & d(\vertex{a}, \vertex{b}) - d(\vertex{b}, \vertex{d}) + d(\vertex{d}, \vertex{q''}) \\
& = & d(\vertex{a}, \vertex{b}) - d(\vertex{b}, \vertex{d}) + d(\vertex{d}, \vertex{p}) \\
& = & K + d(\vertex{d}, \vertex{p}) \\
& = & K + i \\
& = & K + d(\vertex{a}, \vertex{q}),
\end{eqnarray*} so $\vertex{q'} = \alpha_1(i+K)$, and a geodesic path between $\vertex{p}$ and $\vertex{q'}$ has length at most $2\delta$ as required in the first case. 

In the second case, note that \begin{align}
    N_1 + K 
& = \frac{d(\vertex{d}, \vertex{a}) + d(\vertex{d}, \vertex{b}) - d(\vertex{a}, \vertex{b})}{2} + d(\vertex{a}, \vertex{b}) - d(\vertex{b}, \vertex{d}) \notag\\
& = \frac{d(\vertex{a}, \vertex{d}) + d(\vertex{a}, \vertex{b}) - d(\vertex{b}, \vertex{d})}{2} \notag\\
& = (\vertex{b}, \vertex{d})_{\vertex{a}}, \tag{*}
\end{align} the distance from $\vertex{a}$ to the meeting point on $\alpha_1$. Thus, $\vertex{q}$ corresponds to a point $\vertex{p''}$ on $\gamma$, and \begin{eqnarray*}
        d(\vertex{d}, \vertex{p''})
&  =  & d(\vertex{b},\vertex{d})-d(\vertex{b},\vertex{p''}) \\
&  =  & d(\vertex{b},\vertex{d})-d(\vertex{b},\vertex{q}) \\
&  =  & d(\vertex{b},\vertex{d})-d(\vertex{a},\vertex{b})+d(\vertex{a},\vertex{q}) \\
&  =  & i-K \\
& \le & N_2,
\end{eqnarray*} so $\vertex{p''}$ corresponds to a point $\vertex{p'}$ on $\alpha_2$ with $d(\vertex{d}, \vertex{p'}) = d(\vertex{d}, \vertex{p''}) = i - K$. Therefore $\vertex{p'} = \alpha_2(i-K)$ and the distance between $\vertex{p'}$ and $\vertex{q}$ is at most $2\delta$ as required in the second case.

Now suppose that $i \ge \max\{N_1 + K, N_2, N_2 + K\}$. Let $\beta$ be a geodesic from $\vertex{b}$ to $\vertex{c}$. Then $d(\vertex{d}, \vertex{p}) \ge N_2$, so $\vertex{p}$ corresponds to a point $\vertex{p'}$ on $\beta$. Similarly, $d(\vertex{a},\vertex{q}) \ge N_1+K=(\vertex{b},\vertex{d})_{\vertex{a}}$ by (*) so $\vertex{q}$ corresponds to a point $\vertex{q''}$ on $\gamma$ with $d(\vertex{d}, \vertex{q''}) = i - K \ge N_2$, which in turn corresponds to a point $\vertex{q'}$ on $\beta$. Now, \begin{eqnarray*}
      d(\vertex{p'}, \vertex{q'})
& = & d(\vertex{b}, \vertex{p'}) - d(\vertex{b}, \vertex{q'}) \\
& = & d(\vertex{b}, \vertex{c}) - d(\vertex{c}, \vertex{p}) - d(\vertex{b}, \vertex{q'}) \\
& = & d(\vertex{b}, \vertex{c}) - d(\vertex{b}, \vertex{q}) - d(\vertex{b}, \vertex{q}) \\
& = & d(\vertex{b}, \vertex{c}) - 2d(\vertex{b}, \vertex{q}) \\
& = & d(\vertex{b}, \vertex{c}) - 2(d(\vertex{a}, \vertex{b}) - i),
\end{eqnarray*} so $d(\alpha_1(i), \alpha_2(i)) =^{3\delta} d(\vertex{b}, \vertex{c}) - 2(l-i)$ as required.

For the last statement, assume that $i \ge d(\vertex{a}, \vertex{d})$ and that the first two cases do not apply. Since $i \ge d(\vertex{a}, \vertex{d}) \ge (\vertex{a}, \vertex{b})_{\vertex{d}} = N_1$, we have $i > N_2$ or we are in Case $1$. Similarly, (*) gives us $i \ge d(\vertex{a}, \vertex{d}) \ge (\vertex{b}, \vertex{d})_{\vertex{a}} = N_1 + K$, so $i > N_2 + K$ or we are in Case 2. Therefore $i \ge \max\{N_1+K, N_2, N_2 + K\}$ and we are in Case 3; in particular $l \ge i \ge d(\vertex{a}, \vertex{d})$ implies that one of the three cases applies.
\end{proof}

This lemma allows some results about conjugates to be shown. In particular, simply building the construction above in the group for some large power of a conjugating word gives computable estimates on the lengths of all smaller power conjugates, and a constraint on the form of such conjugates which are ``short.''

\begin{lemma}
\label{lemma:long_rectangle}
Suppose that $y$ is a straight word and that $g$ is any $\Gamma$-geodesic. Let $n \in \mathbb{N}$, let $K := |y|n - |gy^n|_G$ and let $0 \le j \le n$.

\begin{enumerate}
\item If $(g, gy^n)_1 \le |y|j \le (gy^n, y^n)_1$ then $y^{-j}gy^j =_G h(y^\infty(K))^{-1}$ for some word $h$ with $|h| \le 2\delta$. 
\item If $(g, gy^n)_1 + K \le |y|j \le (gy^n, y^n)_1 + K$ then $y^{-j}gy^j =_G y^\infty(-K)h$ for some word $h$ with $|h| \le 2\delta$. 
\item If $|y|n \ge |y|j \ge \max \{(gy^n, y^n)_1, (g, gy^n)_1 + K, (gy^n, y^n)_1 + K\}$ then $|y^{-j}gy^j|_G =^{3\delta} |y^{-n}gy^n|_G - 2|y|(n -j)$.
\end{enumerate}

If $|y|j \ge |g|$ then at least one of the three cases applies.
\end{lemma}

\begin{proof}
Let $C:= g$, $D:= gy^n$, $E:= y^n$ and $F:= 1$, and note that the three cases of Lemma \ref{lemma:trapezium} (with $i = |y| j$) correspond exactly to the three cases here.

In the first case, note that $w_1(i+K:i) = y^n (|y|j+K:|y|j) =_G (y^\infty(K))^{-1}$, and we know that $d(w_2(i), w_1(i + K)) \le 2\delta$, so $y^{-j}gy^j =_G w_2(i)^{-1}w_1(i)=_Gh(y^\infty(K))^{-1}$ for some word $h$ of length at most $2\delta$ as required. 

For the second case, $w_2(i:i - K)=_G y^\infty(-K)$ so by a similar argument $y^{-j}gy^j =_G y^\infty (-K) h$ for some word $h$ at length at most $2\delta$ as required.

For the third case, since $d(D, E) = |y^{-j}gy^j|_G$ and $d(C, D) = |y|n$, the third part of this lemma is proved by the third part of Lemma \ref{lemma:trapezium}.

Noting that $|g| = d(C, F)$, the last statement again corresponds to the last statement of Lemma \ref{lemma:trapezium}.
\end{proof}

Recall that we are trying to establish whether or not some power of $y$ centralises a given element $g \in G$. Since the conjugates in the first range above are parametrised by a word of length at most $2\delta$, if a large number of $j$ in this range can be found, some conjugate will repeat and some power of $y$ will indeed be in the centraliser of $g$. The next lemma states this more precisely.

\begin{lemma}
\label{lemma:thinness_extends}
Suppose that $y$ is a straight word, that $g$ is any geodesic word in the generators of $G$, and that $N \in \mathbb{Z}$. If $N - \floor{\frac{|g| + |y^{-N}gy^N|_G}{2|y|}} > V$ then there exist constants $d, e$ with $|g| - 2\delta \le d \le |g|$ and $1 \le e \le V$ such that $|y^{-i}gy^i|_G =^{2\delta} d$ for all $i \in \mathbb{Z}$ and $y^e \in C_G(g)$.
\end{lemma}

\begin{proof}
The number of conjugates $y^{-j}gy^j$ in the first case of Lemma \ref{lemma:long_rectangle} is at least \begin{eqnarray*}
      \ceil{\frac{(gy^N, y^N)_1 - (g, gy^N)_1}{|y|}}
& = & \ceil{\frac{|gy^N|_G + |y|N - |y^{-N}gy^N|_G}{2|y|} - \frac{|g| + |gy^N|_G - |y|N}{2|y|}} \\
& = & \ceil{\frac{2|y|N - |y^{-N}gy^N|_G - |g|}{2|y|}} \\
& = &  N - \floor{\frac{|g| + |y^{-N}gy^N|_G}{2|y|}}.
\end{eqnarray*} Let $p:=\frac{(gy^N,y^N)_1}{|y|}$. Since these conjugates are all of the form $h(y^\infty(K))^{-1}$ for words $h \in B_{2\delta}(1)$, if there are more than $V$ of them there must be at least one duplicate, say, $g^{y^i} =_G g^{y^j}$ for some integers $i$ and $j$ with $p + V + 1 > j > i \ge p$. Let $e:=j-i\le V$, so that $g=_G g^{y^iy^{-j}}=_G g^{y^e}$, and $y^e$ is in the centraliser of $g$ as required.

Since all conjugates $g^{y^k}$ can now be written in the form $g^{y^l}$ for some $p \le l \le p + e \le (gy^N, y^N)_1$, Lemma \ref{lemma:long_rectangle} implies that they are all of the form $hy^\infty(-K)$ with $K = |y|n - |gy^n|_G$ as in that lemma, so in particular $|y^{-i}gy^i|_G =^{2\delta} |K|$. Since $g = y^{-0}gy^0$ we have $|g| \le |K| + 2\delta$, and finally $K = |y|n - |gy^n|_G \le |y|n - |y|n + |g| = |g|$ so we may take $d := |K|$ and we are done.
\end{proof}

The following lemma illustrates that we can test whether some power of $y$ is in the centraliser of $g$ by finding the length of a single group element. 

\begin{lemma}
\label{lemma:test_centraliser}
Suppose that $y$ is a straight word and that $g$ is any geodesic word in the generators of $G$. If $N > V + \floor{\frac{|g| + \delta}{|y|}}$ and $|y^{-N}gy^N|_G \le |g| + 2\delta$ then $N - \floor{\frac{|g| + |y^{-N}gy^N|_G}{2|y|}} > V$.

In particular $|y^{-N}gy^N|_G \le |g| + 2\delta$ if and only if some power of $y$ is in the centraliser of $g$.
\end{lemma}

\begin{proof}
The first part is just straightforward evaluation: \begin{eqnarray*}
        N - \floor{\frac{|g| + |y^{-N}gy^N|_G}{2|y|}}
&  >  & V + \floor{\frac{|g| + \delta}{|y|}} - \floor{\frac{|g| + |y^{-N}gy^N|_G}{2|y|}} \\
& \ge & V + \floor{\frac{|g| + \delta}{|y|}} - \floor{\frac{2|g| + 2\delta}{2|y|}} \\
&  =  & V.
\end{eqnarray*}

For the second part, note that the first part covers the only if case by Lemma \ref{lemma:thinness_extends}, so it remains to prove the if case. Suppose that $y^n$ is in the centraliser of $g$ for some $n > 0$. Let $N_1:=n(V + |g| + 1)$. Clearly $y^{N_1}$ centralises $g$, so in particular $|g^{y^{N_1}}|_G = |g| \le |g| + 2 \delta$. Also \begin{eqnarray*}
        N_1 - \floor{\frac{|g|+|g^{y^{N_1}}|_G}{2|y|}}
&  =  & N_1 - \floor{\frac{2|g|}{2|y|}} \\
& \ge & nV + |g|n + n - |g| \\
&  >  & V,
\end{eqnarray*} so by Lemma \ref{lemma:thinness_extends} we have $|g^{y^N}|_G \le |g| + 2\delta$ as required.
\end{proof}

Since we now know the behaviour of conjugates $g^{y^k}$ in the case where some power of $y$ centralises $g$, it remains to analyse the behaviour of the conjugates where this is not the case.

\begin{lemma}
\label{lemma:unbd_conj_long}
Suppose that $y$ is a straight word and that $g$ is any geodesic word in the generators of $G$. If $N > \frac{|g|}{|y|}$ and $|y^{-N}gy^N|_G > |g| + 2\delta$ then $|y^{-n}gy^n|_G =^{3\delta} |y^{-N}gy^N|_G + 2|y|(n - N)$ for $n \in \mathbb{N}$ satisfying $n \ge N$.
\end{lemma}

\begin{proof}
Apply Lemma \ref{lemma:long_rectangle} with $j = N$. Since $N|y| > |g|$, at least one of the three cases applies. Because $|g^{y^N}|_G > |g| + 2\delta \ge K + 2\delta$, the first two cases cannot apply, so the third case must apply and $|g^{y^N}|_G =^{3\delta} |g^{y^n}|_G - 2|y|(n-N)$, which can easily be rearranged to the required equation.
\end{proof}

The next result is simply a summary of the above results.

\begin{proposition}
\label{proposition:large_power_conjugate}
Let $g \in G$ and let $y$ be some straight word. Let $N > V + \ceil{\frac{|g| + \delta}{|y|}}$. One of the following is true:

\begin{enumerate}
\item \label{case:lpc:central} $|g^{y^N}|_G \le |g| + 2\delta$ and there is some $0 < i \le V$ such that $y^i \in C_G(g)$.
\item \label{case:lpc:noncentral} $|g^{y^N}|_G > |g| + 2\delta$ and $|g^{y^n}|_G =^{3\delta}|g^{y^N}|_G + 2|y|(n-N)$ for any $n \ge N$. 
\end{enumerate}
\end{proposition}

Now we are ready to test for any two elements $a, b \in G$ which $n \in \mathbb{Z}$ satisfy $a^{y^n} =_Gb$.  

\begin{proposition}
\label{prop:predict_length}
Let $a, b \in G$ and let $y$ be some straight word. In time $O(|a|+|b|+|y|)$ it is possible to find $r, t \in \mathbb{Z} \cup \{\infty\}$ such that either 

\begin{enumerate}
\item \label{case:pl:central}  $0\le r<t\le V$ and $y^{-j}ay^j=_Gb$ if and only if $j \equiv r \mod t$,
\item \label{case:pl:conj} $r \in \mathbb{Z}$, $t=\infty$ and $r$ is the unique integer such that $y^{-r}ay^r=_Gb$, or
\item \label{case:pl:not_conj} $r=\infty$, $t=\infty$ and there is no integer $n$ such that $y^{-n}ay^n=_Gb$.
\end{enumerate}
\end{proposition}

\begin{proof} 
First, let $N:= V + 1 + \frac{|a|_G + |b|_G + \delta}{|y|}$ and let $l_g:=|g^{y^N}|_G$, where $g$ is either $a$ or $b$.  If $l_a \le |a|_G + 2\delta$ but $l_b > |b|_G + 2\delta$ then by Proposition \ref{proposition:large_power_conjugate}, the conjugates $a^{y^n}$ have bounded length whereas the conjugates $b^{y^n}$ do not. Thus there can be no $n \in \mathbb{Z}$ such that $a^{y^n}=_Gb$. The same is true if these two inequalities are reversed, so it can be assumed that both $a$ and $b$ lie in the same case of Proposition \ref{proposition:large_power_conjugate}.

Now suppose that $l_a \le |a|_G + 2\delta$. By Proposition \ref{proposition:large_power_conjugate}, some power of $y$ centralises $a$, so in particular Case \ref{case:pl:conj} does not apply. Since $V$ is dependent only on the chosen presentation for $G$, it is possible to check for each $0 \le r' < t' \le V$ if $a^{y^{t'}} =_Ga$ or $a^{y^{r'}} =_Gb$ in time $O(|a|+|b|+|y|)$. If no $r'$ is found, Case 3 holds so let $r = t = \infty$, otherwise Case 1 holds so pick the lowest values found for $r'$ and $t'$ as $r$ and $t$ respectively. 

Finally, suppose that $l_a > |a|_G + 2\delta$. Proposition \ref{proposition:large_power_conjugate} implies that $|a^{y^n}|_G =^{3\delta} l_a + 2|y|(n-N)$ for large $n$, so Case \ref{case:pl:central} cannot apply. In fact, by Proposition  \ref{proposition:large_power_conjugate}, if $y^{-r}ay^r =_Gb$ then \begin{eqnarray*}
l_b +2|y|(n-r-N) 
& =^{3\delta} & |y^{r-n}by^{n-r}|_G \\
& = & |y^{-n}ay^n|_G \\
& =^{3\delta} & l_a + 2|y|(n-N)
\end{eqnarray*} for large $n$. Rearranging, $l_b-l_a=^{6\delta}2|y|r$, so $\frac{l_b-l_a-6\delta}{2|y|}\le r \le \frac{l_b-l_a+6\delta}{2|y|}$. Because no power of $y$ centralises $a$, there can only be one $n$ such that $a^{y^n}=_Gb$ and to find it, we must simply check each $n$ in this range. If some $y^n$ conjugates $a$ to $b$ then Case 2 holds so set $t=\infty$ and $r=n$, otherwise Case 3 holds so set $r=t=\infty$. At most $6\delta$ checks of conjugates $y^{-n}ay^n$ need to made to distinguish between these two cases, and each check takes time $O(|a|+|b|+|y|)$ as required. 
\end{proof}

We are now in a position to test the if there is an element of the form $y^n$ which conjugates the entire list $A$ to $B$.

Apply Proposition \ref{prop:predict_length} to $a_i$ and $b_i$ for each $i \in \{1, \cdots, m\}$ to obtain values $r_i$ and $t_i$.\footnote{As $y$ was originally found as an element of the centraliser of a power of $a_1$, it might seem superfluous to test $i=1$ here, but we only know at this point that a power of $y$ centralises a \textit{power} of $a_1$, and in any case it is not clear what power of $y$ this is the case for.} If $r_i =\infty$ for some $i$ then $a_i$ can't be conjugated to $b_i$ for any power of $y$, so the same is true of $A$ and $B$ and we can stop.

Otherwise, a set of $m$ (possibly modular) equations must be solved simultaneously. If $t_i = \infty$ for some $i$, this is simple; it suffices to check that $r_i = r_j$ for each $j \ne i$ where $t_j = \infty$, and that $r_i \equiv r_j \mod t_j$ for each $j \ne i$ where $t_j \ne \infty$. If all of the equations are satisfied then $A^{y^{r_i}} =_G B$; otherwise there is no power of $y$ which conjugates $A$ to $B$. Clearly these checks can be made in time $O(m)$. % (or allowing for input of unlimited length, $O(m \log \mu)$).

The remaining case is where all $t_i$ and $r_i$ are finite, in which case the set of equations $j \equiv r_i \mod t_i$ must be solved simultaneously. First, note that if $d$ and $e$ are coprime natural numbers then $j \equiv c \mod de$ if and only if $j \equiv c \mod d$ and $j \equiv c \mod e$ both hold, so each congruence $j \equiv r_i \mod t_i$ can be split into a number of congruences modulo prime powers. As $t_i \le V$ for each $i$, and $V$ depends only on $G$, this operation takes constant time for each $i$, so time $O(m)$ overall.

Now for integers $c, d$ and natural numbers $e,f$ the two equations $a \equiv c \mod p^e$ and $a \equiv d \mod p^ep^f$ are equivalent to the second if $c \equiv d \mod p^e$ and have no solution if not. Thus the equations can be either shown to be inconsistent, or reduced to a set of at most $V$ equations modulo prime powers where each prime is distinct and each prime power is at most $V$. By allocating an array with an element corresponding to each prime below $V$, this will take constant time per starting prime power equation, so again time $O(m)$ overall.

Finally, the Chinese Remainder Theorem yields $r'$ and $t'$ such that $j \equiv r' \mod t'$ if and only if $A^{y^j} =_G B$. Since at this point there are at most $V$ congruences modulo pairwise coprime numbers less than or equal to $V$, the running time of this final step is independent of input length. %TODO ref

To summarise, here is the full algorithm in pseudocode. TODO check % TODO

\begin{algorithmic}[1]
\Statex \textbf{Input:} Lists $A = [a_1, \ldots, a_m]$ and $B = [b_1, \ldots, b_m]$ with $a_1$ of infinite order.
\Statex \textbf{Output:} A set of all elements $g \in G$ such that $g^{-1}Ag =_G B$.
\Function{FindConjugatingElementsInf}{$A$, $B$}
\State $p, y, S \gets$ \Call{GetConjugationCandidates}{$a_1, b_1$} % TODO did something break?
\State $O \gets \{\}$
\For{$s \in S$}
	\State $u \gets -\infty$\Comment{Bounds on powers of $y$}
	\State $U \gets \infty$
	\State $E \gets []$\Comment{Any modular equations go here}
	\For{$i \in \{1, \ldots, n\}$} \label{line:conj_inf_main_loop}
		\State $a \gets \pi(p^{-1}a_ip)$
		\State $b \gets \pi(sb_is^{-1})$
		\State $N \gets V + 1 + \ceil{\frac{|a| + |b| + 2\delta}{|y|}}$
		\State $l_a \gets |y^{-N}ay^N|_G$
		\State $l_b \gets |y^{-N}by^N|_G$
		\If{$l_a > |a| + 4\delta$}
			\If{$l_b \le |b| + 4\delta$}
				\State \textbf{next} $s$
			\EndIf
			\State $u \gets \max\{u, \ceil{\frac{l_b-l_a-6\delta}{2|y|}}\}$
			\State $U \gets \min\{U, \floor{\frac{l_b-l_a+6\delta}{2|y|}}\}$
		\Else
			\If{$l_b > |b| + 4\delta$}
				\State \textbf{next} $s$
			\EndIf
			\State $o \gets \infty$
			\State $r \gets \infty$
			\For{$j \in \{1, \ldots, V\}$}
				\If{$\pi(y^{-j}ay^j) = b$}
					\State $o \gets \min\{o, j\}$
				\EndIf
				\If{$\pi(y^{-j}ay^j) = a$}
					\State $r \gets \min\{r, j\}$\Comment{Thus must happen at least once}
				\EndIf
			\EndFor
			\If{$o = \infty$}\Comment{No conjugating element was found}
				\State \textbf{next} $s$
			\EndIf
			\State \Call{Push}{$E$, $x \equiv o \mod r$}
		\EndIf
	\EndFor
	\If{$u \ne -\infty$}\Comment{$t_i = \infty$ at least once}
		\For{$j \in \{u, \ldots, U\}$}
			\For{$i \in \{1, \ldots, m\}$}
				\If{$y^{-j}a_iy^j \ne_G sb_is^{-1}$}
					\State \textbf{next} $j$
				\EndIf
			\EndFor
			\State $O \gets O \cup \{py^js\}$\Comment{This happens at most once for this $s$}
			\State \textbf{next} $s$
		\EndFor
	\Else\Comment{All $t_i$ are finite}
		\State $P \gets$ \Call{SolveSimultaneousModularEquations}{$E$}
		\State $O \gets O \cup \{py^js : j \in P\}$
	\EndIf
\EndFor
\State \textbf{return} $O$
\EndFunction
\end{algorithmic}

Since $|y| \in O(|a_1|)$ and $|s| \in O(|a_1| + |b_1|)$, the loop on line \ref{line:conj_inf_main_loop} takes time $O(|a_i| + |b_i| + |a_1| + |b_1|)$ per iteration, so time $O(m(|a_1| + |b_1|) + \mu)$ in total, where $\mu$ is the total length of all elements in both lists. By the discussion above, tests after this loop run in time $O(m)$, so the overall running time of the algorithm is $O(m(|a_1| + |b_1|) + \mu)$.

We note that the set returned is always a regular language as it is a finite union of finite concatenations of regular languages. TODO explain better.

Note that the centraliser of $A$ is returned by \textsc{FindConjugatingElementsInf}$(A, A)$ in time $O(m|a_1| + \mu)$.

\section{Conjugacy of Short Lists Consisting Only of Finite Order Elements}

\subsection{Bounding element length in short lists}

In this section we show that if the number of elements in a list is bounded, we can find a related list in which every element has bounded length. We will describe in a later section how to use this information to solve the conjugacy problem. The procedure to find such a list is described below.

\begin{proposition}
\label{prop:shorten_list}
There is an algorithm \textsc{ShortenList} which, given a list $A=(a_1,\ldots,a_m)$ of elements of $G$, will either return some $c \in G$ for which $|c^{-1}a_i a_{i+1} \cdots a_mc| \le 3^{m-i}(7L + \delta + \frac{1}{2})$ for any $1 \le i \le m$, or return integers $j$ and $k$ with $j \le k \le m$ such that $a_j a_{j+1} \cdots a_k$ is of infinite order. Further, the algorithm will run in time $O(m^2\mu)$, where $\mu$ is the total length of the elements in the list. If $\{a_i: 1 \le i \le m\}$ is known in advance to generate a finite subgroup, the algorithm can be modified to run in time $O(m \mu)$.
\end{proposition}

\begin{proof}
We first state the algorithm, and then prove that it works as advertised.

\begin{algorithmic}[1]
\label{algorithm:shorten_list}
\Function{ShortenList}{$[a_1, \ldots, a_m]$}
\State $c_0 \gets 1$
\For{$k:=1$ to $m$}
	\For{$j \in \{1, \ldots, k\}$}\Comment{Skip this loop $A$ generates a finite subgroup}
		\If{$|(\pi(c_{k-1}^{-1}a_j \cdots a_kc_{k-1}))_C|_G > 2L$} \label{line:conj_finite_check}
			\State \textbf{return} $null, j, k$ \Comment{$a_j\cdots a_k$ is of infinite order} \label{line:conj_finite_return_infinite}
		\EndIf
	\EndFor
	\State $c_k \gets \pi(c_{k-1}(\pi(c_{k-1}^{-1}a_kc_{k-1}))_L)$ \label{line:conj_finite_extend}
\EndFor
\State \textbf{return} $c_m, null, null$
\EndFunction
\end{algorithmic}

If the algorithm finds and returns integers $j, k$ on line \ref{line:conj_finite_return_infinite}, then a conjugate $g$ of $a_j \cdots a_k$ has $|(\slex(g))_C|$, and so $g$ is of infinite order by Proposition \ref{prop:short_conj}. Then $a_j \cdots a_k$ has infinite order also and the algorithm is correct to return $i, j$.

We may therefore assume that the assertion on line \ref{line:conj_finite_check} always fails. In fact, if $\{a_i: 1 \le i \le m\}$ is known in advance to generate a finite subgroup, these checks are always guaranteed to fail and thus do not need to be executed. It remains to show that after the outer loop has run $k$ times, the length of $c_k^{-1}a_i\cdots a_kc_k$ is less than or equal to $(7L+2\delta)3^{k-i}$ and that the algorithm has taken time $O(k^2 \mu_k)$ where $\mu_k$ is the total length of the first $k$ elements in $A$.

We first aim to show that $|c_k| \le \frac{\mu_k}{2}+k(\delta+1)$. Consider a geodesic triangle with corners $\vertex{e}$, $\vertex{b}:=\vertex{e} \cdot c_{k-1}$ and $\vertex{c}:=\vertex{e} \cdot a_kc_{k-1}$. Label the sides with the short lex geodesicsi $\path{\vertex{e}}{\vertex{b}}$, $\path{\vertex{b}}{\vertex{c}}$ and $\path{\vertex{e}}{\vertex{c}}$. Let $\vertex{p}:=\vertex{b} \cdot (\slex(c_{k-1}^{-1}a_kc_{k-1}))_L$, which is a mid-vertex of $\path{\vertex{b}}{\vertex{c}}$ as illustrated in Figure \ref{figure:extend_c}. Since $c_k$ labels a geodesic from $\vertex{e}$ to $\vertex{p}$, by Lemma \ref{lemma:triangle} we have \begin{eqnarray*}
        |c_k|
& \le & \frac{2\max\{d(\vertex{e}, \vertex{c}), d(\vertex{e}, \vertex{c})\} - d(\vertex{b}, \vertex{c}) + 1}{2}+\delta \\
& \le & \frac{2\max\{|c_{k-1}|,|a_kc_{k-1}|_G\}-|c_{k-1}^{-1}a_kc_{k-1}|_G+1}{2}+\delta.
\end{eqnarray*}

Suppose $|c_{k-1}| \ge |a_kc_{k-1}|_G$. Notice that $|c_{k-1}^{-1}a_kc_{k-1}|_G \ge |c_{k-1}| - |a_kc_{k-1}|_G$ by the triangle inequality, so we find that \begin{eqnarray*}
        |c_k|
& \le & \frac{2|c_{k-1}| - |c_{k-1}| + |a_kc_{k-1}|_G + 1}{2} + \delta \\
& \le & \frac{|c_{k-1}| + |a_kc_{k-1}|_G + 1}{2} + \delta \\
& \le & \frac{2|c_{k-1}| + 1}{2} + \delta \\
& \le & |c_{k-1}| + \frac{|a_k|}{2} + \delta + 1.
\end{eqnarray*} Similarly if $|c_{k-1}| < |a_kc_{k-1}|_G$ then \begin{eqnarray*}
        |c_k|
& \le & \frac{2|a_kc_{k-1}|_G - |a_kc_{k-1}|_G + |c_{k-1}|}{2} + \delta \\
& \le & \frac{|a_kc_{k-1}|_G + |c_{k-1}|}{2} + \delta \\
& \le & \frac{|a_k| + 2|c_{k-1}|}{2} + \delta \\
&  =  & |c_{k-1}| + \frac{|a_k|}{2} + \delta + 1.
\end{eqnarray*} In either case, then, $|c_k| \le |c_{k-1}| + \frac{|a_k|}{2} + \delta + 1$.

By repeating this argument starting at $k=0$ we find that $|c_k| \le \frac{\mu_k}{2} + k(\delta+1)$ as required.

It can now be shown that the algorithm runs in time $O(m^2\mu)$. It is sufficient to show that each of the steps in the outer loop run in time $O(m\mu)$. Note that $|c_{k-1}^{-1}a_j\cdots a_kc_{k-1}| \le \mu_k+2|c_{k-1}| \le 2\mu_k + 2k(\delta+1)$ so the checks on line \ref{line:conj_finite_check} each run in time $O(\mu_k+k)=O(\mu_k)$. There are $k$ such steps per loop and a total of $m$ loops, so the overall running time is in $O(m^2\mu_m)$ for this step. In the case that we are not running these checks, this part can be ignored. Similarly, $|c_{k-1}c_{k-1}^{-1}a_kc_{k-1}| \le 4\mu_k$ so line \ref{line:conj_finite_extend} runs in time $O(\mu_k)$ and the overall time taken in this step is in $O(m\mu_m)$. Therefore the whole algorithm runs in time $O(m^2\mu)$ or $O(m \mu)$ if the checks on line \ref{line:conj_finite_check} are not being run.

It remains to show that the bound on the length of the elements $c_m^{-1}a_i\cdots a_mc_m$ is satisfied. This can be shown by induction on $m$. Let us first, for each $k\in\{1,\ldots,m\}$, define $K_{k,k}:=2L$ and $K_{i, k+1}: = 3K_{i,k} + 10L + 2\delta + 1$ for any $1 < i\le k$, in order to make notation simpler. The aim is to use induction on $k$ to show that $|c_k^{-1}a_j \cdots a_k c_k|_G \le K_{i, k}$ for any $1 \le i \le k$.

In the $k = 1$ case, $c_k = (a_k)_L$ so that $c_k^{-1}a_kc_k =_G(a_k)_C$ which by assumption has length less than or equal to $2L$ as required.

Now suppose that the inequality $|c_k^{-1}a_i\cdots a_k c_k|_G\le K_{i,k}$ is satisfied for all $1 \le i \le k$. It is our aim to bound $|c_{k+1}^{-1} a_i \ldots a_{k+1}c_{k+1}|_G$ for each $i$. Pick some specific $i$, and let $e:= \slex(c_k^{-1}a_i \ldots a_{k+1} c_k)$ and $g:= \slex(c_k^{-1}a_{k+1}c_k)$ so that $c_{k+1} =_G c_kg_L$. Note that \begin{eqnarray*}
        c_{k+1}^{-1}a_i \ldots a_{k+1} c_{k+1}
& =_G & c_{k+1}^{-1} c_ke c_k^{-1} c_{k+1} \\
& =_G & g_L^{-1} eg_L \\
& =_G & g_L^{-1} e_L e_C e_L^{-1} g_L.
\end{eqnarray*} Since by assumption, $|e_C| \le 2L$ we need only bound $|g_L^{-1} e_L|_G$ to get a bound on $|c_{k+1}^{-1}a_i \ldots a_{k+1} c_{k+1}|_G$. Noting that $|g_R g_L|_G = |g_C|_G \le 2L$, we have $|g_L^{-1} e_L|_G = |g_L^{-1}g_R^{-1} g_R e_L |_G \le 2L + |g_R e_L |_G$ so a bound on $|g_R e_L|_G$ is sufficient. 

Consider a geodesic triangle with corners $\vertex{e}$, $\vertex{b}:= \vertex{e} \cdot g$ and $\vertex{c}:=\vertex{e} \cdot ge_L$. Let $f:= \slex(c_k^{-1}a_i\ldots a_k c_k)=_Geg^{-1} $ and recall that $|f|\le K_{i,k}$ by inductive assumption. Note that \begin{eqnarray*}
        d(\vertex{e}, \vertex{c})
&  =  & |ge_L|_G \\
&  =  & |f^{-1} ee_L|_G \\
& \le & |ee_L|_G + K_{i,k}\\ 
&  =  & |e_Le_C|_G + K_{i,k} \\
& \le & |e_L| + K_{i,k} + 2L \\
& \le & \frac{|e|}{2} + K_{i,k} + 2L \\
& \le & \frac{|f| + |g|}{2} + K_{i,k} + 2L.
\end{eqnarray*}

Let $\vertex{p} := \vertex{e} \cdot g_L$. Note that $2|e_L| \le |e| \le |f| + |g|$, so Lemma \ref{lemma:triangle} implies that \begin{eqnarray*}
        |g_R e_L|_G
&  =  & d(p, \vertex{c}) \\
& \le & \frac{2 \max\{d(\vertex{e}, \vertex{c}), d(\vertex{b}, \vertex{c})\} -d(\vertex{e}, \vertex{b}) + 1}{2} + \delta \\
& \le & \frac{2 \max\{|e_L| + 2L + K_{i, k}, |e_L|\} -|g| + 1}{2} + \delta \\
&  =  & \frac{2(|e_L| + 2L + K_{i, k} ) -|g| + 1}{2} + \delta \\
& \le & \frac{2(2L + K_{i, k}) + |f| + 1}{2} + \delta \\
& \le & \frac{3}{2}K_{i, k} + 2L + \delta + \frac{1}{2},
\end{eqnarray*} and $|g_L^{-1}e_L|_G \le 2L + |g_R e_L|_G \le \frac{3}{2} K_{i, k} + 4L + \delta + \frac{1}{2}$. Now \begin{eqnarray*}
        |c_{k+1}^{-1}a_i \cdots a_{k+1}c_{k+1}|_G
& \le & 2|g_L^{-1}e_L|_G + |e_C|_G \\
& \le & 3K_{i, k} + 10L + 2\delta + 1\\
&  =  & K_{i, k+1}
\end{eqnarray*} as required.

Finally, using a simple induction on $j$, \begin{eqnarray*}
        K_{i,j}
&  =  & 3K_{i,j-1} + 10L + 2\delta + 1\\
&  =  & 3^{j-i}K_{i,i} + (10L + 2\delta + 1)\sum_{n=i}^{j-1} 3^{n-i} \\
&  =  & 3^{j-i}K_{i,i} + (10L + 2\delta + 1)\frac{3^{j-i}-1}{3-1} \\
&  =  & 2\times 3^{j-i}L + (5L + \delta + \frac{1}{2})(3^{j-i}-1)\\
& \le & 3^{j-i} (7L + \delta + \frac{1}{2}) 
\end{eqnarray*} as required in the hypothesis.
\end{proof}

\begin{figure}
\begin{center}
\input fig9_minitri.pstex_t
\caption{Extending $c$.}
\label{figure:extend_c}
\end{center}
\end{figure}

\begin{figure}
\begin{center}
\input fig9_fin_order.pstex_t
\caption{The conjugates of the $a_i'$ are all short.}
\label{figure:fin_order}
\end{center}
\end{figure}

By repeated application of Lemma \ref{lemma:replace}, the conjugacy problem remains unchanged between studying the lists $(a_1, \ldots, a_m)$ and $(b_1, \ldots, b_m)$, and the lists $(a_1 \cdots a_m, a_2 \cdots a_m, \ldots, a_m)$ and $(b_1 \cdots b_m, b_2 \cdots b_m, \ldots, b_m)$.

At this point, it is useful to give a statement of Theorem A from \cite{bridson2005conjugacy}.

\begin{proposition}
There exist constants $\alpha$ and $\beta$ which depend only on $G$ such that if $A$ and $B$ are conjugate and $l$ is the maximum length of an element in $A$ or $B$ then $A^x =_G B$ for some word $x$ of length at most $l\alpha + \beta$.
\end{proposition}

In particular, this implies that if $A$ and $B$ have been prepared by \textsc{ShortenList} to produce lists $A'$ and $B'$ in which all elements have length at most $3^m(7L + \delta + \frac{1}{2})$, we can test if $A'$ and $B'$ are conjugate in time independent of $\mu$.

\begin{corollary}
If \textsc{ShortenList} returns conjugating elements $c_A$ and $c_B$ for input lists $A$ and $B$ respectively, it is possible to test if $A$ and $B$ are conjugate, and if so return a word $x$ of such that $A^x =_G B$ in time at $O(\mu_A + \mu_B + (2|X|)^{3^m(7L + \delta + \frac{1}{2})})$.
\end{corollary}
by simply testing for all words $w$ of length $3^{m-i}(7L + \delta + \frac{1}{2})\alpha + \beta$ whether $A'^w =_G B'$, and this operation takes time 

which will find an element $g$ with $A^g =_G B$ should one exist in time exponential in the total word length of $A$ and $B$. Since the total word length is now bounded given a maximum number of elements, this however takes constant time. Thus we can find a conjugating element in time at worst $O(m^2\mu)$ provided we bound the number of elements in the lists.

\subsection{Dealing with lists of bounded length}

This section is a small toolbox of results which solve various problems involving lists in worse than linear time. They are useful as the previous section allows us to bound the lengths of elements in terms of the number of elements. The following result is a restatement of Corollary 3.2 of \cite{bridson2005conjugacy}.

\begin{proposition}
\label{proposition:small_cent}
Let $(a_1, \ldots, a_m)$ be a list of $m$ pairwise distinct finite order elements of $G$. Suppose that $x \in G$ satisfies \[ |x|_G \ge (2k + 5)^{4\delta+2}(l + 2\delta) \] where $l = \max\{|a_1|_G, |a_1^x|_G, \ldots, |a_m|_G, |a_m^x|_G\}$ and $k$ is the number of generators of $G$. Then $m$ is less than or equal to the number of vertices in $B_{8\delta}(\vertex{e})$.\footnote{The statement in \cite{bridson2005conjugacy} says that $m \le (2k)^{8 \delta}$, but the proof is sufficient to prove the statement here.}
\end{proposition}

Noting that $Q^2$ is greater or equal to the number of vertices in $B_{8\delta}(\vertex{e})$, the following is a simple corollary:

\begin{corollary}
\label{cor:short_cent}
For any list $A$ consisting of $n > Q^2$ pairwise distinct finite order elements of $G$, any element of the centraliser of $A$ has length less than $(2k + 5)^{4\delta+2}(l + 2\delta)$ where $l$ is the maximum length of an element in $A$.
\end{corollary}

\begin{proof}
Suppose that $A = (a_1, \ldots, a_n)$ is such a sublist. If $x$ is in the centraliser of $A'$ then $a_i'^x = a_i'$ for all $1 \le i \le n$, so in Proposition \ref{proposition:small_cent} we have that $l$ is just the maximum length of the $a_i$. But then $|x|_G < (2k + 5)^{4\delta+2}(l + 2\delta)$ since $n > Q^2$.
\end{proof}

Thus the centraliser of a list containing many finite order elements is in particular finite.

In \cite{gersten1991rational}, it is shown that the centraliser of any finite list in a biautomatic group is a regular language. The proof is rather simple but involves some awkward constructions including intersections of multiple variable automata. In order to avoid including a large amount of expository material for this one fact, we will simply state a summary of Lemma 4.2 and Proposition 4.3 from \cite{gersten1991rational}.

\begin{proposition}
\label{prop:compute_centraliser}
If $A$ is a list of words, there is a regular language $L$ of short-lex least words which is exactly the centraliser of $A$. Further, there is an algorithm \textsc{ComputeCentraliser} and a constant $M$ depending only on $G$ such that \textsc{ComputeCentraliser} returns an $X$-DFA which accepts $L$ in time $O(M^\mu)$ where $\mu$ is the total length of elements in $A$.
\end{proposition}

The main theorem regarding lists of finite order elements in \cite{bridson2005conjugacy}, Theorem 3.3, is restated below.

\begin{proposition}
Let $A = (a_1, \ldots, a_m)$ and $B = (b_1, \ldots, b_m)$ be sets of torsion elements in $G$. If $A$ and $B$ are conjugate then there exists a word $x$ with \[ |x|_G \le (2k+5)^{4\delta+2}(l+2\delta) + Q^{2Q^2} \] where $l$ is the maximal length of an element in either list and $k$ is the number of generators of $G$.\footnote{Again, \cite{bridson2005conjugacy} uses $m \le (2k)^{8 \delta}$ instead of $Q^2$.}
\end{proposition}

We can now proceed to solve the conjugacy problem.

\subsection{Solving the conjugacy problem}

\label{section:solve_conj}

Suppose $A = (a_1, \ldots, a_m)$ and $B = (b_1, \ldots, b_m)$ with each $a_i$ and $b_i$ a word which represents a finite order element of $G$ and we wish to test if one list is a conjugate of the other and return a regular language which is exactly the set of conjugating elements.

We first replace $A$ and $B$ with $\slex(A)$ and $\slex(B)$. If for some $i$ we now find that $a_i = b_i$, we remove these elements in the lists, replacing them with later elements (this is reasonable since $a_i^g = b_i^g$ for any element $g \in G$). If for some $i$ we find that $a_i$ is the empty word but $b_i$ is not or vice versa, we declare the lists not conjugate (again, this is reasonable as the identity is conjugate only to itself).

We are left with two lists $A$ and $B$, each of \textit{distinct} finite order short-lex least words all of length at least $1$. Let $\mu$ be the total length of all elements in $A$ and $B$.

If these lists contain more than $Q^2$ elements, let $A'$ and $B'$ be the sublists of $A$ and $B$ respectively containing the first $n := Q^2+1$ elements, otherwise lie $A' = A$ and $B' = B$.

Now apply \textsc{ShortenList} to $A'$ and $B'$; this takes time at worst $O(n^2\mu) = O(\mu)$.

If the algorithm returns an infinite order element $a_i \cdots a_j$ or $b_i \cdots b_j$ for some $i \le j$ then add $a_i \cdots a_j$ to the start of $A$ and add $b_i \cdots b_j$ to the start of $B$ to get new lists $\tilde{A}$ and $\tilde{B}$, and test conjugacy of $\tilde{A}$ and $\tilde{B}$ using \textsc{FindConjugatingElementsInf}, noting that the return value is already a regular language. This takes time $O(m\mu)$. Notice that for $g \in G$ we have $\tilde{A}^g =_G \tilde{B}$ if and only if $A^g =_G B$, so we have solved the conjugacy problem for $A$ and $B$, thus the conjugacy problem has been solved in time $O(m\mu)$.

If instead we get conjugating elements $c_A$ and $c_B$ then let $\tilde{A'} := (a_1', \ldots, a_n')$ where $a_i' = \slex((a_i \cdots a_n)^{c_A})$ and define $\tilde{B'}$ in the same way using $c_B$. Computing these lists takes time at worst $O(n\mu) = O(\mu)$.

We must now check that each element $a_i'$ and $b_i'$ is indeed of finite order (we only at this point know that they are \textit{short}). Suppose that $x$ is such an element. Then compute $x' := \slex(\slex(x_C)^M)$. By Proposition \ref{prop:shorten_list} we know that $|\slex(x_C)| \le 2L$, so by Proposition \ref{prop:make_long} we have $\slex(x'_C) > 2L$ if $x$ is of infinite order. On the other hand, $\slex(x'_C) \le 2L$ if $x$ is of finite order. Each check requires reducing 2 words of length at most $3^n(7L+\delta+\frac{1}{2})$ so can perform all of these checks in time which depends only on $G$. If some element $a_i'$ is of infinite order, proceed just as if \textsc{ShortenList} had returned the integers $i$ and $n$.

By Proposition \ref{prop:short_conj}, if $\tilde{A'}$ and $\tilde{B'}$ are conjugate, there exists a word $u$ of length at most $K_2 := (2k + 5)^{4\delta+2}(3^n(7L+\delta+\frac{1}{2}) + 2\delta) + Q^{2Q^2}$ with $\tilde{A'}^u =_G \tilde{B'}$, so test every word up to this length to see if this is the case. Again, the time to do this depends only on $G$. If no such $u$ is found then $\tilde{A'}$ and $\tilde{B'}$ are not conjugate so neither are $A$ and $B$, and we may return. If some $u$ is found we continue.

Suppose $m > n$. By Proposition \ref{prop:shorten_list}, all elements of $\tilde{A'}$ have length at most $3^n(7L+\delta+\frac{1}{2})$ and so by Corollary \ref{cor:small_cent} every element of the centraliser of $\tilde{A'}$ has length at most $K_1 := (2k + 5)^{4\delta+2}(3^n(7L+\delta+\frac{1}{2}) + 2\delta)$. Let $C$ be the set of all words $w$ with $|w| \le K_1$ and $\tilde{A'}^w =_G \tilde{A'}$. Then $C$ is the centraliser of $\tilde{A'}$ and the time taken to compute $C$ depends only on $G$.

Now check if $A^{c_Awu} = B^{c_B}$ for each $w \in C$. Each check takes time $O(\mu)$ and the number of checks depends only on $G$, so this part executs in time $O(\mu)$. Now return the set of all $c_Awuc_B^{-1}$ for which this check succeeds. As this is a finite set, it is a regular language. If it fails for all elements of $C$ then $A$ and $B$ were not conjugate. Either way, we are done.

Finally, suppose that $n = m$. Let $C$ be the centraliser of $A'$ found using \textsc{FindCentraliserRational}. We have that $A^{c_Awuc_B^{-1}} =_G B$ for any $w \in C$, so we need simply return the set $\{c_Awuc_B^{-1} : w \in C\}$. This is a regular language since it is the concatenation of the two finite sets $\{c_A\}$ and $\{uc_B^{-1}\}$ and a regular langauge. Thus all cases are covered and we are done.

Many of the constants in the finite order part of this proof are rather large and it is probable that some improvements can be made here. Consider Theorem III.$\Gamma$.3.2 of \cite{BriHae99}, for instance.

\begin{theorem}
If $G$ is a $\delta$-hyperbolic group and $H$ is a finite subgroup of $G$ then there is an element $g \in G$ with $H^g$ contained entirely within a ball in the Cayley graph of $G$ of radius $4\delta+2$.
\end{theorem}

This implies that we can find a much more efficient set $C$ for the centraliser in the finite case than the one described above.

\section{The Complete Algorithm}

This section contains pseudocode for the main part of the algorithm, given input of two lists $A$ and $B$ of $m$ words. We denote the centraliser and conjugation searching steps from Section \ref{section:solve_conj} by \textsc{FindCentraliserExp} and \textsc{TestConjugacyExp} respectively. The centraliser computing algorithm from \cite{gersten1991rational} is denoted \textsc{FindCentraliserRational}. The call \textsc{RemoveDuplicates} removes duplicate words from the lists.

\begin{algorithmic}[1]
\Function{TestConjugacy}{$A:=[a_1, \ldots, a_m], B:=[b_1, \ldots, b_m]$}
\State $A, B \gets$ \Call{RemoveDuplicates}{$\slex(A), \slex{B}$}
\If{$m > Q^2$}
	\State $n \gets Q^2+1$
\Else
	\State $n \gets m$
\EndIf
\State $A_0 \gets [a_1, \ldots a_n]$
\State $c_a, i, j \gets$ \Call{ShortenList}{$A_0$}
\If{$i \ne null$}
	\State $A'\gets[a_i \cdots a_j, a_1, \ldots, a_{i-1}, a_{i+1}, \ldots, a_m]$
	\State $B'\gets[b_i \cdots b_j, b_1, \ldots, b_{i-1}, b_{i+1}, \ldots, b_m]$
	\State \textbf{return} \Call{TestConjugacyInf}{$A',B'$}
\EndIf	
\State $B_0 \gets [b_1, \ldots b_n]$
\State $c_b, i, j \gets$ \Call{ShortenList}{$B_0$}
\If{$i \ne null$}
	\State $A'\gets[a_i \cdots a_j, a_1, \ldots, a_{i-1}, a_{i+1}, \ldots, a_m]$
	\State $B'\gets[b_i \cdots b_j, b_1, \ldots, b_{i-1}, b_{i+1}, \ldots, b_m]$
	\State \textbf{return} \Call{TestConjugacyInf}{$A',B'$}
\EndIf
\State $A' \gets [c_a^{-1}a_1a_2\cdots a_nc_a, c_a^{-1}a_2a_3\cdots a_nc_a, \ldots, c_a^{-1}a_nc_a]$
\State $B' \gets [c_b^{-1}b_1b_2\cdots b_nc_b, c_b^{-1}b_2b_3\cdots b_nc_b, \ldots, c_b^{-1}b_nc_b]$
\State $g \gets$ \Call{TestConjugacyExp}{$A', B'$}
\If{$g = null$}
	\State \textbf{return} $\{\}$
\EndIf
\If{$m > Q^2$}
	\State $C \gets$ \Call{FindCentraliserExp}{$A', B'$}
	\State $O \gets \{\}$
	\For{$c \in C$}
		\If{$A^{c_acg} =_G B^{c_b}$}
			\State $O \gets O \cup \{c_acgc_b^{-1}\}$
		\EndIf
	\EndFor
	\State \textbf{return} $O$
\Else
	\State $C \gets$ \Call{FindCentraliserRational}{$A, B$}
	\State \textbf{return} $\{ c_awgc_b^{-1} : w \in C \}$
\EndIf
\EndFunction
\end{algorithmic}

This algorithm runs in time $O(m\mu)$ and returns either a single element which conjugates $A$ to $B$, leaving open the question of whether more such elements exist, or returns a set containing every conjugating element. We once again remark that the single element case 

\chapter{Conjugacy and quasiconvex subgroups}

\label{chapter:qc_conj}

\section{Introduction}

In this chapter, we outline some algorithms which will test various conjugacy related properties with respect to a quasiconvex subgroup of a hyperbolic group.

In general, hyperbolic groups may contain subgroups which are somewhat difficult to work with (for example, the generalised word problem of determining if a arbitrary word represents an element of an arbitrary finitely generated subgroup is unsolvable for general hyperbolic groups). It is for this reason that we restrict to quasiconvex subgroups.

\begin{definition}
\label{def:quasiconvex_sg}
A subgroup $H$ of group $G$ is $\epsilon$-quasiconvex if, for each $w \in H$ labelling a geodesic in $\Gamma$, and for each $0 \le i \le |w|$ there exists an $h \in H$ and a $X$-word $a$ with $|a| \le \epsilon$ such that $w(i) =_G ha$.
\end{definition}

In particular, quasiconvexity implies that the subgroup is hyperbolic (and so finitely presented), and has solvable generalised word problem (in fact, there is an $X$-DFA which accepts the set of short-lex least words representing elements of such a subgroup, see \cite{gersten1991rational} for more details). There are few examples of subgroups of hyperbolic groups which are not quasiconvex. One can however use the rather complicated construction by E.\ Rips in \cite{rips1982subgroups} to produce a finitely generated hyperbolic group with finitely generated normal subgroup which has unsolvable generalised word problem and is therefore not quasiconvex. Examples have also been produced under rather stricter conditions, for instance in \cite{kapovich1995non}, I.\ Kapovich gives an example of a finitely presented, freely indecomposable non-quasiconvex subgroup of a torsion free hyperbolic group which coincides with its own virtual normaliser.

Throughout this chapter, we will assume that $G$ is a hyperbolic group generated by some set $X$, that $\Gamma$ is its Cayley graph which is $\delta$-vertex-hyperbolic and that $H$ is an $\epsilon$-quasiconvex subgroup with coset Cayley graph $\Gamma'$ with respect to $X$.

It may seem that quasiconvexity depends on the particular generating set $X$ chosen for $G$. This is not the case, however: while the constant $\epsilon$ may change under change of generating set, the existence of such a constant does not.

\section{Extending geodesics}

A useful tool used throughout this chapter is the following one, which says that if $w$ is a long enough $\Gamma'$ geodesic word at $H$ and $u$ is a $\Gamma$-geodesic word for which $wu$ has little calculation, then $wu$ is close to being a $\Gamma'$-geodesic at $H$ as well. The bounds can be slightly improved in the case where $wu$ has \textit{no} cancellation (that is, it is a $\Gamma$-geodesic), but the factor of $\epsilon$ is unchanged so we will simply prove the more general statement.

\begin{lemma}
\label{lemma:extend_long_coset}
Suppose that $w_1$ and $w_2$ are $\Gamma$-geodesics. Let $k := (w_1^{-1}, w_2)_1$, and let $w_1'$ and $w_2'$ be $\Gamma'$-geodesics connecting $H$ to $Hw_1$ and $Hw_1w_2$ respectively. If $|w_1'| \ge 3\delta + \epsilon + k + 1$ then $|w_2'| \ge |w_1'| + |w_2| - 2k - 3\delta - \epsilon - 1$.
\end{lemma}

\begin{figure}
\begin{center}
\input extend_word.pstex_t
\caption{Extending a long minimal coset representative}
\label{figure:extend_word}
\end{center}
\end{figure}

\begin{proof}
Let $\vertex{a}$ be the vertex in $\Gamma$ representing the identity element. Pick $X$-words $h_1$ and $h_2$ to be $\Gamma$-geodesics connecting $\vertex{a}$ to $\vertex{a} \cdot w_1w_1'^{-1}$ and $\vertex{a} \cdot w_1w_2w_2'^{-1}$ respectively. Let $\vertex{b} := \vertex{a} \cdot w_1$, $\vertex{c} := \vertex{a} \cdot w_1w_2$, $\vertex{d} := \vertex{a} \cdot h_1$ and $\vertex{e} := \vertex{a} \cdot h_2$. Then we have a geodesic pentagon as illustrated in Figure \ref{figure:extend_word}. We let $d_1 := (\vertex{b}, \vertex{a})_{\vertex{d}}$ and $d_2 := (\vertex{c}, \vertex{a})_{\vertex{e}}$, and let $s_i := |h_i| - d_i$ for $i$ equal to $1$ or $2$. These numbers measure in some sense the length of various words which $H$ ``cancels.''

Suppose that $i := \floor{d_1} > \delta + \epsilon$. Let $\vertex{x} := \vertex{d} \cdot w_1'(i)$ so that $\vertex{x}$ corresponds to a vertex on $\path{\vertex{a}}{\vertex{d}}$. Since $H$ is $\epsilon$-quasiconvex, there is a vertex $\vertex{y}$ representing an element of $H$ such that $d(\vertex{x}, \vertex{y}) \le \delta + \epsilon$. Let $u$ be a $\Gamma$-geodesic connecting $\vertex{y}$ to $\vertex{b}$, then $|u| = d(\vertex{y}, \vertex{b}) \le |w_1'| - i + \delta + \epsilon < |w_1'|$ and $Hu = Hw_1'$ so $w_1'$ was not a $\Gamma'$-geodesic at $H$, a contradiction. Thus we may assume that \begin{equation} \label{eqn:d1_short}
d_1 \le \delta + \epsilon + \frac{1}{2}.
\end{equation} Exchanging $\vertex{b}$ and $\vertex{e}$ in this argument shows that \begin{equation} \label{eqn:d2_short}
d_2 \le \delta + \epsilon + \frac{1}{2}
\end{equation} as well.

Since $|w_2'| = |w_1w_2|_G - s_2 + d_2$, we now need only prove that $s_2$ can't be much bigger than $s_1$ and we will have shown that $|w_2'|$ is long.

Notice that $(\vertex{b}, \vertex{c})_{\vertex{a}} = |w_1| - (\vertex{a}, \vertex{c})_{\vertex{b}} = |w_1| - k$. Since $|w_1| = |w_1'| - d_1 + s_1$, using $|w_1'| \ge 3\delta + \epsilon + k + 1$ we see that \begin{equation} \label{eqn:canc_far}
(\vertex{b}, \vertex{c})_{\vertex{a}} \ge s_1 + 3\delta + \epsilon - d_1 + 1.
\end{equation}

Now suppose that $j := s_1 + 3\delta + \epsilon - d_1 + 1 \le s_2$. Notice that $j$ is an integer, so $\vertex{z} := \vertex{a} \cdot h_2(j)$ is a vertex which corresponds to a vertex on $\path{\vertex{a}}{\vertex{c}}$. By (\ref{eqn:canc_far}) we know that $j \le (\vertex{b}, \vertex{c})_{\vertex{a}}$, so this vertex in turn corresponds to a vertex on $\path{\vertex{a}}{\vertex{b}}$. Finally, (\ref{eqn:d1_short}) implies that $j \le s_1$ so $\vertex{z}$ $3$-corresponds to a vertex $\vertex{p}$ on $\path{\vertex{d}}{\vertex{b}}$. Notice that $d(\vertex{d}, \vertex{p}) = j - s_1 + d_1 = 3\delta + \epsilon + 1$.

Since $\vertex{z}$ lies on $\path{\vertex{a}}{\vertex{e}}$, it lies within $\epsilon$ of some other vertex $\vertex{q}$ representing an element of $H$ and we have \begin{eqnarray*}
        d(H, Hw_1')
& \le & d(\vertex{q}, \vertex{b}) \\
& \le & d(\vertex{q}, \vertex{p}) + d(\vertex{p}, \vertex{b}) \\
& \le & (3\delta + \epsilon) + (|w_1'| - 3\delta - \epsilon - 1) \\
&  <  & |w_1'|,
\end{eqnarray*} so $w_1'$ cannot be a $\Gamma'$-geodesic at $H$, a contradiction. Thus $s_2 < s_1 + 3\delta + \epsilon - d_1 + 1$.

To complete the proof, observe that $|w_1w_2|_G = |w_1| + |w_2| - 2k$ and $|w_1'| = |w_1| - s_1 + d_1$, so \begin{eqnarray*}
        |w_2'|
&  =  & |w_1w_2|_G - s_2 + d_2 \\
&  >  & (|w_1| + |w_2| - 2k) - (s_1 + 3\delta + \epsilon - d_1 + 1) + d_2 \\
& \ge & |w_1'| + |w_2| - 2k - 3\delta - \epsilon - 1,
\end{eqnarray*} as required.
\end{proof}

This lemma in particular implies that if a $\Gamma$-geodesic labels a path starting at $H$ which strays too far from $H$, it can never go back. This fact is especially useful in the next section.

\section{An upper bound on minimal powers}

In this section, we demonstrate that there is a upper bound $U$ depending only on $H$ such that for any element $g$ such that $g^n \in H$, if $n>0$ is minimal then $n \le U$. We begin by showing a general property of minimal conjugates.

\begin{lemma}
\label{lemma:min_small_canc}
Suppose that $g \in G$, that $|g^a|_G \ge l$ for all $X$-words $a$, that $w$ is an $X$-word such that $|g^w|_G = l$ and that $w$ has minimal length over all $X$-words with this property. Then $\floor{(g^w, w)_1} \le \delta$.
\end{lemma}

\begin{proof}
Suppose not. Let $u = \slex(g^w)$ and let $\vertex{a}$ be a vertex in $\Gamma$. Pick a geodesic triangle in $\Gamma$ with corners $\vertex{a}$, $\vertex{b} := \vertex{a} \cdot u$ and $\vertex{c} := \vertex{a} \cdot w^{-1}$ and sides labelled $w$, $u$ and $\slex(wu)$. Let $i := \floor{(g^w, w)_1}$ and let $x := \vertex{a} \cdot u(i)$. Then $\vertex{x}$ corresponds to a vertex $\vertex{y}$ on $\path{\vertex{a}}{\vertex{c}}$ and \begin{eqnarray*}
        d(\vertex{c}, \vertex{x})
& \le & d(\vertex{c}, \vertex{y}) + d(\vertex{y}, \vertex{x}) \\
& \le & |w| - i + \delta \\
&  <  & |w|.
\end{eqnarray*}

Let $v$ be a $\Gamma$-geodesic connecting $\vertex{c}$ to $\vertex{x}$ and let $h := u(i)^{-1}w^{-1}(i)$ so that $v =_G w(|w|-i)h^{-1}$. Then \begin{eqnarray*}
        g^v
& =_G & u(i)^{-1}w^{-1}gwu(i) \\
& =_G & u(i)^{-1}uu(i)
\end{eqnarray*} which is a cyclic conjugate of $u$. In particular, $|g^v|_G \le |u| = l$ so $|v^{-1}gv|_G = l$ and $|v| < |w|$, contradicting minimality of $w$ and we are done.
\end{proof}

The following fact is perhaps obvious, but the rather short proof is included for completeness.

\begin{lemma}
\label{lemma:s_min}
A straight word has minimal length under conjugation.
\end{lemma}

\begin{proof}
Suppose not. Then there exists a straight word $w$ and another $X$-word $a$ such that $|w^a|_G \le |w| - 1$. But then $|w^3|_G = |a(a^{-1}wa)a^{-1}|_G \le 1 + 3(|w| - 1) + 1 < |w^3|$ and $w$ was not straight, a contradiction which proves the lemma.
\end{proof}

We now prove the main result for this section. Recall $M$ and $Q$ from Section \ref{conj_const}.

\begin{theorem}
\label{theorem:max_power}
Suppose that $g \in G$ with $g^n \in H$ for some $n \in \mathbb{N}$ and $w \in G$. Then $g^l \in H$ for some $l \le MQ^2R$ where $R$ is the number of vertices in $B^{\Gamma'}_{6\delta + \epsilon}(H)$.
\end{theorem}

\begin{proof}
Note that $g^m$ has a short-lex straight conjugate for some $0 < m \le MQ^2$ by Corollary \ref{cor:find_sls_and_conj_form}. Pick an $X$-word $a$ such that $\slex(ag^ma^{-1})$ is short-lex straight and the length of $a$ is minimal over all words with this property. Let $x := \slex(ag^ma^{-1})$. Notice that $x^k$ has minimal length under conjugation for any $k \ge 1$ by Lemma \ref{lemma:s_min}, and so Lemma \ref{lemma:min_small_canc} implies that $\floor{(x^k, a^{-1})_1} \le \delta$ and $\floor{(x^{-k}, a^{-1})_1} \le \delta$ for any $k \ge 1$.

Suppose that $i \ge 4\delta + 2$, that $j \ge 4\delta + 2$ and that $(ax^i, x^ja^{-1})_1 > \frac{3}{2}\delta + \frac{1}{2}$. Let $\vertex{a}$ be the vertex in $\Gamma$ representing the identity element and let $\vertex{b} := \vertex{a} \cdot x^j$, $\vertex{c} := \vertex{b} \cdot a^{-1}$, $\vertex{e} := \vertex{a} \cdot x^{-i}$ and $\vertex{d} := \vertex{e} \cdot a$. Then we have a geodesic pentagon in $\Gamma$ as illustrated in Figure \ref{figure:big_sls_powers_canc}.

Let $\vertex{x} := \vertex{a} \cdot x^i(l)$ and $\vertex{y} := \vertex{a} \cdot x^{-i}(l)$ where $l := \floor{\frac{3}{2}\delta} + 1$. Then $(x^j, x^ja^{-1})_1 = |x^j| - (x^j, a^{-1})_1 \ge j|x| - \delta - 1 \ge 3\delta + 1$, so $i \le (x^j, x^ja^{-1})_1$ and $\vertex{x}$ corresponds to a vertex $\vertex{x'}$ on $\path{\vertex{a}}{\vertex{b}}$. A similar argument shows that $\vertex{y}$ corresponds to a vertex $\vertex{y'}$ on $\path{\vertex{a}}{\vertex{d}}$. Since $(ax^i, x^ja^{-1})_1 > \frac{3}{2}\delta + \frac{1}{2}$ we know that $i \le (ax^i, x^ja^{-1})_1$, so $\vertex{x'}$ corresponds to $\vertex{y'}$. In particular, $d(\vertex{x}, \vertex{y}) \le 3\delta$ so \begin{eqnarray*}
        |w^{i+j}|
&  =  & d(\vertex{e}, \vertex{b}) \\
& \le & d(\vertex{e}, \vertex{x}) + d(\vertex{x}, \vertex{y}) + d(\vertex{y}, \vertex{b}) \\
& \le & |w^i| - i + 3\delta + |w^j| - i \\
& \le & |w^{i+j}| - 1
\end{eqnarray*} which is a clear contradiction. Therefore $(ax^i, x^ja^{-1})_1 \le \frac{3}{2}\delta + \frac{1}{2}$ whenever both $i$ and $j$ are at least $4\delta + 2$.

Suppose $w$ is a $\Gamma'$-geodesic connecting $H$ to $Hax^i$ for some $i \ge 4\delta + 2$, and that $|w| > 6\delta + \epsilon + 1$. Then Proposition \ref{prop:extend_long_coset} applies with $w_1 = ax^i$ and $w_2 = x^ja^{-1}$ for any $j \ge 4\delta + 2$, and implies that $d(H, Hg^{i+j}) = d(H, Hax^{m(i+j)}a^{-1}) \ge |w| + |x^ja^{-1}|_G - 6\delta - \epsilon - 2$ for large $j$. Since this implies $Hg^t$ is nowhere near $t$ for any large values of $t$, if $d(H, Hax^i) > 6\delta + \epsilon + 1$ for some $i \ge 4\delta + 2$ then no power of $g$ can be in $H$.

We therefore find that $d(H, Hax^i) \le 6\delta + \epsilon + 1$ for all $i \ge 4\delta + 2$. If $Hax^i = Hax^j$ for some integers $0 \le i < j$ then $x^{j-i}$ labels a loop at $Hax^i$ and so $Hax^p = Hax^{p+(j-i)}$ for any integer $p$. Setting $p = 0$ we find that $Hax^{j-i} = Ha$ so that $g^{m(j-i)} =_G ax^{j-i}a^{-1}$ is an element of $H$.

As there are at most $R$ elements in $B_{6\delta+\epsilon+1}(H)$, we can assume that $j - i \le R$ and we are done.
\end{proof}

We close this section by making the observation that $g^n \in H$ if and only if $(a^{-1}ga)^n =_F a^{-1}g^na \in a^{-1}Ha$. This implies that the bound in Theorem \ref{theorem:max_power} depends not on $\epsilon$ but on the \textit{minimum} quasiconvexity constant over all subgroups of $G$ which are conjugate to $H$ and that there is a bound on the minimum power for which a group element may be \textit{conjugated} into $H$.

\section{Testing conjugacy with elements of a quasiconvex subgroup}

In this chapter, we will outline an algorithm which will test if a given $X$-word is a conjugate of an element of $H$. We begin by showing that either the length of the minimal length conjugator or the length of the word in question is bounded in terms of $\delta$ and $\epsilon$.

\begin{proposition}
\label{prop:short_conj_for_inf_in_H}
Suppose that $g$ is an $X$-word which is of minimal length under conjugation in $G$, and that $g^a \in H$ where $a$ is an $\Gamma'$-geodesic at $H$. Then either \begin{enumerate}
\item $|a| \le 3\delta + 2\epsilon + 1$, or
\item $|g^a|_G \le 3\delta + 2\epsilon + 1$ and $|g| \le 5\delta + 1$.
\end{enumerate}
\end{proposition}

\begin{proof}
Note that $g$ is a $\Gamma$-geodesic and $a^{-1}$ is a $\Gamma'$-geodesic at $H$, so Lemma \ref{lemma:conj_quadrilateral} applies with $f$ being the map sending group elements $x$ to cosets $Hx$ and the words $w = a^{-1}$, $u = g$ and $v = \slex(g^a)$.

The first case of Lemma \ref{lemma:conj_quadrilateral} implies that $2|a| \le |g| - |g^a|_G + 6\delta + 4\epsilon + 2$, and as $g$ has minimal length under conjugation, $|g| \le |g^a|_G$ so that $|a| \le 3\delta + 2\epsilon + 1$ as required for the first case here.

The second case of Lemma \ref{lemma:conj_quadrilateral} implies that $|g^a|_G \le 3\delta + 2\epsilon + 1$ so we have the first inequality. The final part of that lemma says that either $|g| \le 2\delta$ or that $a^{-1}ga =_G a^{-1}(|a|-i)g'a^{-1}(|a|-i)^{-1}$ for some $X$-word $g'$ of length at most $5\delta + 1$, ie.\ $g$ has a conjugate of length at most $5\delta + 1$. Since $g$ has minimal length under conjugation, $|g| \le 5\delta + 1$ and the proof is complete.
\end{proof}

\begin{theorem}
Given a word $g$ in the generators of $G$, we can test if there exists, and return, some $a \in G$ such that $g^a \in H$ in time $O(|g|)$. Further, if $g$ is of infinite order then for \textit{any} such element $a$ there is an $X$-word $w$ with $|w| \in O(|g|)$ and $Hw = Ha$.
\end{theorem}

\begin{proof}
Let us first suppose that $g$ is infinite order, so that $g^m$ has a short-lex straight conjugate by Corollary \ref{cor:find_sls_and_conj_form} for some $0 < m \le MQ^2$. Let $x =_G w^{-1}g^mw$ be such a short-lex straight word with $|w| \le (M+1)|u|$. Notice that Proposition \ref{prop:short_conj_for_inf_in_H} applies to $x$. We will treat each case of Proposition \ref{prop:short_conj_for_inf_in_H} seperately.

The first case can be dealt with rather quickly: For each $X$-word $b$ of length at most $3\delta + 2\epsilon + 1$, test if $x^b \in H$. If this check succeeds for some $b$ then $w^{-1}b$ is a suitable conjugating element and can be returned. If all checks here fail then any conjugating element must satisfy the criteria in the second case. Each check can be performed in time $O(|g|)$ and the number of checks depends only on $\epsilon$ and $\delta$ so this case can be tested for in time $O(|g|)$.

For the second case, we may exit immediately if $|x| > 5\delta + 1$. Otherwise, for all $X$-words $h$ with $|h| \le 3\delta + 2\epsilon + 1$ and $h \in H$, test if $x^b =_G h$ for some element $b \in G$. If such a $b$ is found then $w^{-1}b$ is a suitable conjugating element and can be returned. If not then no conjugating element satisfies this case. Again, each check can be performed in time $O(|g|)$ and the number of checks depends only on $\epsilon$ and $\delta$ so this case can also be tested for in time $O(|g|)$.

For any conjugating element $w^{-1}b$ found above, let $h = g^{w^{-1}b} \in H$. Apply Proposition \ref{prop:find_sls_and_conj_form} with $u = h$ and $v = g$ to find that $b$ has the form $h^iw$ for some $X$-word $w$ of length at most $3MQ^2(|h|+|g|)+12\delta \in O(|g|)$. Notice that $Hb = Hh^iw = Hw$, so this proves the statement about infinite order elements.

Now let us instead suppose that $g$ is of finite order. Then Proposition \ref{prop:short_conj} implies that $\slex(g_C)$ has length at most $2L+1$. Suppose that such a conjugating element $a$ exists and that $a^{-1}$ is a $\Gamma$-geodesic at $H$, so Lemma \ref{lemma:conj_quadrilateral} applies with $f$ being the map sending group elements $x$ to cosets $Hx$ and the words $w = a^{-1}$, $u = \slex(g_C)$ and $v = \slex((g_C)^a)$.

The first case of Lemma \ref{lemma:conj_quadrilateral} implies that $2|a| \le |g_C|_G + 3\delta + 2\epsilon + 1$, so $|a| \le L + 3\delta + 2\epsilon + 1$. Thus we need only test for all $X$-words $b$ of length at most $L + 3\delta + 2\epsilon + 1$ whether $(g_C)^b \in H$ to exhaust all possibilities here, much like in the infinite order case. If any conjugating word $b$ is found then $g_L^{-1}b$ conjugates $g$ into $H$. The number of tests here is independent of $g$, as is the running time of each test, so this takes constant time.

The second case of Lemma \ref{lemma:conj_quadrilateral} implies that $|(g_C)^a|_G \le 3\delta + 2\epsilon + 1$ so we test, for all $X$-words $h$ of length at most $3\delta + 2\epsilon + 1$ whether there is an element $b \in G$ with $(g_C)^b =_G h$. If such a $b$ is found then $g_L^{-1}b$ conjugates $g$ into $H$.

If no $b$ is found in either of these two cases above then $g$ cannot be conjugated into $H$.
\end{proof}

\section{Checking equality of double cosets}

In this section, we demonstrate that it is possible to efficiently determine if two double cosets of quasiconvex subgroups are equal. We begin by showing that there is an efficient way to find ``short'' coset representatives.

\begin{proposition}
\label{prop:shorten_coset_rep}
Given a $\Gamma$-geodesic $w$ one can find an $\Gamma$-geodesic $u$ such that $Hw = Hu$ and $d(H, Hw) \ge |u| - 3\delta - \epsilon - 1$ in time $O(|w|)$.

Suppose additionally that $K$ is a given $\zeta$-quasiconvex subgroup. Then one can find a $\Gamma$-geodesic $v$ with $HwK = HvK$ such that $d(K, Kv^{-1}) \ge |v| - 3\delta - \zeta - 1$ and $d(H, Hv) \ge |v| - 9\delta - 3\epsilon - \zeta - 2$ in time $O(|w|)$.
\end{proposition}

\begin{proof}
For the first part, precompute the subgraph of $\Gamma'$ induced by $B^{\Gamma'}_{3\delta + \epsilon}(H)$. This will take time dependent only on $H$.

Suppose $d(H, Hw(i)) \ge 3\delta + \epsilon + 1$ for some $i \le |w|$. By Lemma \ref{prop:extend_long_coset} with $w_1 = w(i)$ and $w_2 = w(i:|w|)$ we have $d(H, Hw) \ge d(H, Hw(i)) + |w| - i - 3\delta - \epsilon - 1$. Thus, using the precomputed subgraph and starting at $H$, follow the path labelled by $w$ until $d(H, Hw(i)) > 3\delta + \epsilon$ or $i = |w|$.

If we get to $i = |w|$ then $d(H, Hw) \le 3\delta + \epsilon$ so let $w_0$ be any $\Gamma'$-geodesic connecting $H$ to $Hw$ and we are done.

Otherwise, let $w_0$ be a $\Gamma'$ geodesic connecting $H$ to $Hw(i)$ and let $u := \slex(w_0w(i:|w|))$. Then $d(H, Hw) \ge d(H, Hw(i)) + |w| - i - 3\delta - \epsilon - 1 \ge |w| - i \ge |u| - 3\delta - \epsilon - 1$, so $u$ satisfies the requirements of the hypothesis and is computed in time $O(|w|)$ as required for the first part.

For the second part, apply the first part a second time, this time using the subgroup $K$ instead of $H$ and the word $u^{-1}$ instead of $w$ as input, to get an $X$-word $v' = \slex(u_0u^{-1}(i:|u|))$ for some $X$-word $u_0$ and some integer $i$ which satisfy $|u_0| \le 3\delta + \zeta + 1$ and $d(K, Kv') \ge |v'| - 3\delta - \zeta - 1$. Let $v := v'^{-1}$ and we find that $d(K, Kv^{-1}) \ge |v| - 3\delta - \zeta - 1$ so it remains to show that we didn't in this process cause $v$ to be much less efficient with respect to $H$. Note that if $|v| \le 9\delta + 3\epsilon + \zeta + 2$ then we are done.

Suppose then that $d(H, Hv) > |v| - 6\delta - 3\epsilon - 2 > 3\delta + \zeta$. Let $j := 5\delta + 2\epsilon + 2$, let $\vertex{a}$ be the vertex representing the identity element in $\Gamma$ and let $\vertex{p} := \vertex{a} \cdot v(j)$.

There is a geodesic triangle in $\Gamma$ with corners $\vertex{a}$, $\vertex{b} := \vertex{a} \cdot v$ and $\vertex{c} := \vertex{b} \cdot \slex(u_0)$ and side labels $v$, $u' := u^{-1}(i:|u|) = (u(|u|-i))^{-1}$ and $\slex(u_0)$. In this triangle, since $|u_0| \le 3\delta + \zeta + 1$ we find that $(\vertex{b}, \vertex{c})_{\vertex{a}} \ge |v| - |u_0| \ge 5\delta + 2\epsilon + 2 = j$ so that $\vertex{p}$ corresponds to the vertex $\vertex{q} := \vertex{a} \cdot u(j)$ on $\path{\vertex{a}}{\vertex{c}}$.

Pick a $\Gamma'$-geodesic $t$ connecting $H$ to $Hv$ and consider the geodesic triangle in $\Gamma$ with corners $\vertex{a}$, $\vertex{b} := \vertex{a} \cdot v$ and $\vertex{d} := \vertex{a} \cdot vt^{-1}$ with sides labelled $t$, $v$ and $\slex(vt^{-1})$. Let $\vertex{r} = \vertex{d} \cdot v(k)$ where $k = \floor{(\vertex{a}, \vertex{b})_{\vertex{d}}}$. Then $\vertex{r}$ corresponds to a vertex $\vertex{r'}$ on $\path{\vertex{d}}{\vertex{b}}$ and since $vt^{-1} \in H$ and $H$ is $\epsilon$-quasiconvex, we have $d(H, Hv) \le d(\vertex{r'}, \vertex{r}) + d(\vertex{r}, \vertex{b}) = \delta + \epsilon + d(H, Hv) - d(\vertex{d}, \vertex{r})$. Now $d(\vertex{d}, \vertex{r}) \le \delta + \epsilon$ and in particular, $\floor{(\vertex{a}, \vertex{b})_{\vertex{d}}} \le \delta + \epsilon$.

As $|v| - |t| > 6\delta + 3\epsilon + 2$ we must have $d(\vertex{a}, \vertex{d}) \ge 6\delta + 3\epsilon + 2$ so that $(\vertex{b}, \vertex{d})_{\vertex{a}} = d(\vertex{a}, \vertex{d}) - (\vertex{a}, \vertex{b})_{\vertex{d}} \ge 5\delta + 2\epsilon + 1 = j$. Then $\vertex{p}$ corresponds to a vertex $\vertex{s}$ on $\path{\vertex{a}}{\vertex{d}}$ which is within $\epsilon$ of a vertex representing an element of $H$. This implies that $d(H, Hu) \le |u| - j + 2\delta + \epsilon < |u| - 3\delta - \epsilon - 1$ which is impossible. Thus $d(H, Hv) \le |v| - 6\delta - 3\epsilon - 2$ as required.
\end{proof}

The bounds given in the above proposition can be improved slightly by being a little more careful.

Armed with this tool we can now test equality of double coset representatives.

\begin{theorem}
Suppose $K$ is a given $\zeta$-quasiconvex subgroup. If $u$ and $v$ are $X$-words then it is possible to test whether $HuK = HvK$ in time $O(|u| + |v|)$.
\end{theorem}

\begin{proof}
Let $u_1$ and $v_1$ be the words obtained by applying the second part of Proposition \ref{prop:shorten_coset_rep} on $K$ with the words $u$ and $v$ respectively. Since these words are obtained in time $O(|u| + |v|)$ and satisfy $Hu_1K = HuK$ and $Hv_1K = HvK$, we replace $u$ with $u_1$ and $v$ with $v_1$.

If $HuK = HvK$ then there exist elements $h \in H$ and $k \in K$ with $uk =_G hv$. We may assume that $h$ and $k$ are picked to minimize $|h| + |k|$ and are therefore $\Gamma$-geodesics. Let $\vertex{a}$ be the vertex representing the identity element of $G$. Let $\vertex{b} := \vertex{a} \cdot h$, $\vertex{c} := \vertex{b} \cdot v$ and $\vertex{d} := \vertex{a} \cdot u$. Then we have a geodesic quadrilateral in $\Gamma$ with side labels $h$, $v$, $k$ and $u$. Pick some $\Gamma$-geodesic connecting $\vertex{a}$ to $\vertex{c}$ to split this quadrilateral into two geodesic triangles.

Suppose some vertex $\vertex{p}$ on $\path{\vertex{b}}{\vertex{c}}$ $2$-corresponds to a vertex on $\path{\vertex{c}}{\vertex{d}}$. Then since $K$ is $\zeta$-quasiconvex and $k$ is a $\Gamma$-geodesic element of $K$ we have some vertex $\vertex{q}$ in $\Gamma$ which represents and element of $K$ with $d(\vertex{p}, \vertex{q}) \le 2\delta + \zeta$. In particular, \begin{eqnarray*}
        d(K, Kv^{-1})
& \le & d(\vertex{q}, \vertex{p}) + d(\vertex{p}, \vertex{b}) \\
& \le & |v| - d(\vertex{p}, \vertex{c}) + 2\delta + \zeta \\
& \le & d(K, Kv^{-1}) + 3\delta + \zeta + 1 + 2\delta + \zeta - d(\vertex{p}, \vertex{c}),
\end{eqnarray*} so $d(\vertex{p}, \vertex{c}) \le 5\delta + 2\zeta + 1$. Thus either $\floor{(\vertex{a}, \vertex{d})_{\vertex{c}}} \le 5\delta + 2\zeta + 1$ or $\floor{(\vertex{a}, \vertex{b})_{\vertex{c}}} \le 5\delta + 2\zeta + 1$. A similar argument with vertices on $\path{\vertex{b}}{\vertex{c}}$ tells us that $\floor{(\vertex{a}, \vertex{c})_{\vertex{d}}} \le 4\delta + 2\zeta + 1$.

Repeating this argument on the remaining two corners gives $\floor{(\vertex{a}, \vertex{c})_{\vertex{b}}} \le 10\delta + 4\epsilon + \zeta + 2$ and either $\floor{(\vertex{b}, \vertex{c})_{\vertex{a}}} \le 11\delta + 4\epsilon + \zeta + 2$ or $\floor{(\vertex{c}, \vertex{d})_{\vertex{a}}} \le 11\delta + 4\epsilon + \zeta + 2$.

We will now prove that $|h| + |k| \le 30\delta + 2P(\epsilon+\zeta) + 8\epsilon + 4\zeta + 8$ where $P$ is the number of vertices in $B^\Gamma_{2\delta + \epsilon + \zeta}(\vertex{a})$.

Suppose that $(\vertex{b}, \vertex{c})_{\vertex{a}} \le (\vertex{c}, \vertex{d})_{\vertex{a}}$. Then $|h| = (\vertex{b}, \vertex{c})_{\vertex{a}} + (\vertex{a}, \vertex{c})_{\vertex{b}} \le 11\delta + 4\epsilon + \zeta + 2 + 10\delta + 4\epsilon + \zeta + 2 + 1 \le 21\delta + 8\epsilon + 2\zeta + 5$ and similarly $|k| \le 9\delta + 2\zeta + 3$. Thus $|h| + |k| \le 30\delta + 8\epsilon + 4\zeta + 8$ which is within the required bound.

It remains to consider the case where $(\vertex{b}, \vertex{c})_{\vertex{a}} \ge (\vertex{c}, \vertex{d})_{\vertex{a}}$.

Suppose for some integers $i$ and $j$, the vertex $\vertex{p_i} := \vertex{d} \cdot k(i)$ $2$-corresponds to the vertex $\vertex{q_i} := \vertex{a} \cdot h(j)$. Observe that $k := j - i = (\vertex{c}, \vertex{d})_{\vertex{a}} - (\vertex{a}, \vertex{c})_{\vertex{d}}$ is a constant so that $\vertex{q_i}$ is indeed well defined by $i$.

There is a vertex $\vertex{r_i} \in \Gamma$ representing an element of $K$ such that $d(\vertex{p_i}, \vertex{r_i}) \le \zeta$ and similarly there is a vertex $\vertex{s_i}$ representing an element of $H$ such that $d(\vertex{q_i}, \vertex{s_i}) \le \epsilon$. Let $w_i$ be a $\Gamma$-geodesic connecting $\vertex{r_i}$ to $\vertex{s_i}$ and observe that $|w_i| = d(\vertex{r_i}, \vertex{s_i}) \le 2\delta + \epsilon + \zeta$.

Suppose that more than $P(\epsilon + \zeta)$ vertices on $\path{\vertex{d}}{\vertex{c}}$ correspond to vertices on $\path{\vertex{a}}{\vertex{b}}$ so that there exist integers $x < y - \epsilon - \zeta$ with $w_x = w_y$. Let $k_1$, $k_2$ and $k_3$ be $\Gamma$-geodesics connecting $\vertex{d}$ to $\vertex{r_x}$, $\vertex{r_x}$ to $\vertex{r_y}$ and $\vertex{r_y}$ to $\vertex{c}$ respectively. Define $h_1$, $h_2$ and $h_3$ to connect $\vertex{a}$, $\vertex{s_x}$, $\vertex{s_y}$ and $\vertex{b}$ similarly.

Then $w_x =_G h_2w_y^{-1}k_2^{-1} = h_2w_x^{-1}k_2^{-1}$ and $w_x =_G h_3vk_3^{-1}$ so that \begin{eqnarray*}
        hvk^{-1}
& =_G & h_1h_2h_3vk_3^{-1}k_2^{-1}k_1^{-1} \\
& =_G & h_1h_2w_xk_2^{-1}k_1^{-1} \\
& =_G & h_1w_xk_1^{-1} \\
& =_G & h_1h_3vk_3^{-1}k_1^{-1},
\end{eqnarray*} but then $|h_1h_3| + |k_1k_2| \le |h| + 2\epsilon + |k| + 2\zeta - 2(y-x) < |h| + |k|$ but $h_1h_3v =_G uk_1k_3$ which contradicts minimality of $h$ and $k$. Thus at most $P(\epsilon + \zeta)$ vertices on $\path{\vertex{d}}{\vertex{c}}$ can correspond to vertices on $\path{\vertex{a}}{\vertex{b}}$ and we have $|h| \le 21\delta + 6\epsilon + 2\zeta + P(\epsilon + \zeta + 5$ and $|h| \le 9\delta + 2\zeta + P(\epsilon + \zeta + 3$. But then $|h| + |k| \le 30\delta + 6\epsilon + 4\zeta + 2P(\epsilon + \zeta + 8$ as required.

We thus test, for each pair of $X$-words $h$ and $k$ with $|h| + |k| \le 30\delta + 6\epsilon + 4\zeta + 2P(\epsilon + \zeta + 8$ whether $h \in H$, $k \in K$ and $uk =_G hv$. If for some pair of words all three of these checks succeed, the double cosets are equal. If this does not happen then $HuK \ne HvK$. These checks can be performed in time $O(|u| + |v|)$, and the number of them depends only on $\delta$, $\epsilon$ and $\zeta$ so this operation takes time $O(|u| + |v|)$. The theorem is proved.
\end{proof}

\chapter{$X$-graphs and hyperbolicity}

\label{chapter:qc_coset}

\section{Introduction}

This chapter is largely based on work by Foord in his PhD thesis \cite{foord2000thesis}. Foord studies some properties about various graphs relating to hyperbolic groups and their subgroups. The work here slightly generalises this as well as providing some improved constants relating to these results. We will work with $X$-graphs, as detailed in Section \ref{section:xgraph}. We invite the reader to recap that section before continuing as many of the definitions there have been neglected until now.

Much of this section concerns the similarity of CVSs, which we define in terms of graph morphisms.

\begin{definition}
\label{def:isomorphic}
Let $\Gamma_1$ and $\Gamma_2$ be $X$-CVSs. A map $f : \Gamma_1 \to \Gamma_2$ is an \textbf{$X$-map} if it can be extended to a graph morphism of the subgraphs induced by $\Gamma_1$ and $\Gamma_2$ which preserves edge labels and directions.
\end{definition}

The existence of an extension to the induced graph is enough to prove that an $X$-map $f$ is defined completely once $f(\vertex{p})$ is known for any single vertex $\vertex{p}$. We prove this now.

\begin{proposition}
\label{proposition:xmap_defined_by_point}
Suppose that both $\Gamma_1$ and $\Gamma_2$ are $X$-CVSs and let $f : \Gamma_1 \to \Gamma_2$ be any function. Then $f$ is an $X$-map if and only if for all $\Gamma_1$-words $w$ and vertices $\vertex{p}$ in $\Gamma_1$ we have $f(\vertex{p} \cdot w) = f(\vertex{p}) \cdot w$.

In particular, if $f : \Gamma_1 \to \Gamma_2$ and $g : \Gamma_1 \to \Gamma_2$ are $X$-maps and $\vertex{q}$ is a vertex in $\Gamma_1$, then $f = g$ if and only $f(\vertex{q}) = g(\vertex{q})$.
\end{proposition}

\begin{proof}
Suppose $f$ is an $X$-map and let $\tilde{f}$ be the extension of $f$ to the subgraphs induced by $\Gamma_1$ and $\Gamma_2$.

Since $\tilde{f}$ preserves edge labels and directions, given a vertex $\vertex{p}$ in $\Gamma_1$ and element $x \in X$, if there is an edge $e$ which is labelled $x$ and starts at $\vertex{p}$, then $\tilde{f}(e)$ is labelled $x$, starting at $f(\vertex{p})$ and ends at $f(\vertex{p}) \cdot x$. This implies that $f(\vertex{p} \cdot x) = f(\vertex{p}) \cdot x$. The same is true for edges labelled $x$ which end at $\vertex{p}$, so $f(\vertex{p} \cdot u) = f(\vertex{p}) \cdot u$ for any word $u$ of length $1$. Now for any $X$-word $w$, \begin{eqnarray*}
      f(\vertex{p} \cdot w)
& = & f((\ldots((\vertex{p} \cdot w[1]) \cdot w[2]) \ldots ) \cdot w[|w|] ) \\
& = & (\ldots((f(\vertex{p}) \cdot w[1]) \cdot w[2]) \ldots ) \cdot w[|w|] \\
& = & f(\vertex{p}) \cdot w,
\end{eqnarray*} as required.

Now we must prove the converse. Suppose that for all $\Gamma_1$-words $w$ and vertices $\vertex{p}$ in $\Gamma_1$ we have $f(\vertex{p} \cdot w) = f(\vertex{p}) \cdot w$. Notice that for any $x \in X$, since $x$ and $x^{-1}$ are $X$-words, the endpoints and directions of any edges pointing into and out of $\vertex{p}$ with label $x$ are preserved, thus $f$ can be extended to a graph morphism and is therefore an $X$-map.

For the last part, it is clear that $f \ne g$ if $f(\vertex{q}) \ne g(\vertex{q})$. Suppose that $f(\vertex{q}) = g(\vertex{q})$. For any vertex $\vertex{r} \in \Gamma_1$ there is a $\Gamma_1$ word, say $w$, with $\vertex{q} \cdot w = \vertex{r}$. But then \begin{eqnarray*}
      f(\vertex{r})
& = & f(\vertex{q} \cdot w) \\
& = & f(\vertex{q}) \cdot w \\
& = & g(\vertex{q}) \cdot w \\
& = & g(\vertex{r})
\end{eqnarray*} and $f = g$ as required.
\end{proof}

The first part of Proposition \ref{proposition:xmap_defined_by_point} will be used frequently without reference.

Another simple fact to note is that $X$-maps, being restrictions of graph morphisms, define contractions of metric spaces.

\begin{proposition}
\label{proposition:contraction}
Suppose that $\Gamma_1$ and $\Gamma_2$ are graphs in which all edges have length 1, that $f : \Gamma_1 \to \Gamma_2$ is a morphism of graphs and that $a$ and $b$ are vertices in $\Gamma$. Then $d(f(a), f(b)) \le d(a, b)$.
\end{proposition}

\begin{proof}
Note that any geodesic path connecting $a$ to $b$ must be mapped to a path connecting $f(a)$ to $f(b)$.  Since edges are sent to edges and vertices are sent to vertices, there is a path in $\Gamma_2$ connecting $f(a)$ to $f(b)$ of length $d(a, b)$, so $d(f(a), f(b)) \le d(a, b)$.
\end{proof}

When determining whether two balls are the same, it is convenient to ensure that not only is there a bijective $X$-map between them, but that this map preserves the centres.

\begin{definition}
If $\Gamma_1$ and $\Gamma_2$ are $X$-graphs then an $X$-map $f : B^{\Gamma_1}_k(\vertex{p_1}) \to B^{\Gamma_2}_k(\vertex{p_2})$ is a \textbf{morphism of balls} if $f(\vertex{p_1}) = \vertex{p_2}$. We say $f$ is an \textbf{isomorphism of balls} if $f$ is bijective, and in this case we say $B^{\Gamma_1}_k(\vertex{p_1})$ and $B^{\Gamma_2}_k(\vertex{p_2})$ are \textbf{ball isomorphic}.
\end{definition}

We can show that if an $X$-map either maps from an $X$-graph or is a morphism of balls then it is surjective. In particular, injective morphisms of balls are isomorphisms of balls.

\begin{proposition}
\label{proposition:xmap_surjective}
Suppose that both $\Gamma_1$ and $\Gamma_2$ are connected vertex sets of $X$-graphs and $f : \Gamma_1 \to \Gamma_2$ is an $X$-map.

If $\Gamma_1$ is an $X$-graph then $f$ is surjective.

If both $\Gamma_1$ and $\Gamma_2$ are balls of the same radius and $f$ is a ball morphism then $f$ is surjective.
\end{proposition}

\begin{proof}
Suppose that $\Gamma_1$ is an $X$-graph. Pick any vertex $\vertex{q}$ in $\Gamma_1$. Since $X$-graphs are connected, given any vertex $\vertex{r}$ in $\Gamma_2$, there is an $\Gamma_2$-word at $f(\vertex{q})$, say $w$, with $f(\vertex{q}) \cdot w = \vertex{r}$. Then $w$ is a $\Gamma_1$-word at $\vertex{q}$ (as any $X$-word is), so $f(\vertex{q}) \cdot w = f(\vertex{q} \cdot w)$ and $\vertex{q} \cdot w$ is a vertex in $\Gamma_1$ which maps to $\Gamma_2$ and $f$ is surjective.

Similarly, suppose that $\Gamma_1$ and $\Gamma_2$ are balls of the same radius, $r$ say, that $f$ is a ball morphism, that $\vertex{q}$ is the centre of $\Gamma_1$ and that $\vertex{r} \in \Gamma_2$. Then since $f$ is a ball morphism, $f(\vertex{q})$ is the centre of $\Gamma_2$ so there is a $\Gamma_2$-word at $f(\vertex{q})$, say $w$, of length at most $r$ which satisfies $f(\vertex{q}) \cdot w = \vertex{r}$. But then $w$ is a $\Gamma_1$-word (as any $X$-word of length at most $r$ is), so once again $f(\vertex{q}) \cdot w = f(\vertex{q} \cdot w)$ and $f$ is surjective.
\end{proof}

\begin{figure}
\begin{center}
\input ball_not_iso.pstex_t
\caption{The $1$-balls around $H$ and $Ha$ are equal but not isomorphic}
\label{figure:ball_not_iso}
\end{center}
\end{figure}

The restriction that the centre of the ball is preserved is justified since one can produce an example of an $X$-graph where two equal radius balls around different points are equal as sets but not isomorphic as balls, illustrated below.

\begin{example}
The following construction is illustrated in Figure \ref{figure:ball_not_iso}.

Let $G$ be the free group on the set $\{a, b\}$. Let $H$ be the subgroup of $G$ generated by $ba^{-1}$, $b^2a$, $b^{-2}a$ and $b^{-1}a^2$, and let $\Gamma$ be its coset Cayley graph with respect to $X$, which is illustrated in Figure \ref{figure:ball_not_iso}. The tree structures on the left and right of the illustration represent subgraphs of the Cayley graph of $G$ with respect to $\{a, b\}$.

Notice that if $\vertex{x}$ is a vertex in $\Gamma$ which is neither $H$ nor $Ha$ then $d(H, \vertex{x}) = d(Ha, \vertex{x})$, so if $k > 0$ then $B_k(H) = B_k(Ha)$ as sets. However, $ab^{-1}$ labels a loop at $H$ but not $Ha$, so there is no $X$-map from $B_k(H)$ which sends $H$ to $Ha$. In particular, these balls are not ball isomorphic.
\end{example}

We now define a concept of ``mostly homogeneous''.

\begin{definition}
Suppose that $\Gamma$ is an $X$-graph with base vertex $\vertex{b}$. Then for non-negative $k \in \mathbb{Z}$ we say:

$\Gamma$ has \textbf{IB($k$)} if there exists some $K$ such that if $\vertex{p}, \vertex{q} \in \Gamma$ are vertices with $d(\vertex{b}, \vertex{p}) \ge K$ and $d(\vertex{b}, \vertex{q}) \ge K$ then $B_k(\vertex{p})$ and $B_k(\vertex{q})$ are ball isomorphic. Thus there is a canonical $k$-ball of $\Gamma$ to which balls of radius $k$ are ball which are sufficiently far from $\vertex{b}$ are isomorphic to. We label this ball \textbf{$\canonicalball{k}{\Gamma}$}.

Suppose $S$ is a collection of $X$-graphs which all satisfy $IB(k)$. Then we say $S$ satisfies $IB(k)$ if $\canonicalball{k}{\Gamma_1}$ and $\canonicalball{k}{\Gamma_2}$ are ball isomorphic for any two elements $\Gamma_1$ and $\Gamma_2$ in $S$.

Suppose $G$ is some group generated by $X$ with Cayley graph $\Gamma_G$. Then $\Gamma$ has \textbf{GIB($k$)} if $\{\Gamma, \Gamma_G\}$ has $IB(k)$.

Where the presentation is understood, we will refer to a subgroup of a group as having IB($k$) or GIB($k$) if its associated coset Cayley graph does.
\end{definition}

In other words, these imply that provided you can't see more than a given finite distance and are sufficiently far from the base point it is impossible to tell where you are, or which graph you are in.

The concept of quasiconvexity of subgroups (Definition \ref{def:quasiconvex_sg}) carries over neatly into the case of an $X$-map.

\begin{definition}
Suppose $\Gamma_1$ and $\Gamma_2$ are $X$-graphs with base points $\vertex{b_1}$ and $\vertex{b_2}$ respectively, that $f:\Gamma_1 \to \Gamma_2$ is an $X$-map and that $\vertex{b_2} = f(\vertex{b_1})$. Then $f$ is $\epsilon$-quasiconvex if whenever $w$ is a $\Gamma_1$-geodesic at some vertex $\vertex{p}$ and $f(\vertex{p}) = f(\vertex{p} \cdot w) = f(\vertex{b})$ then $d(f(\vertex{p} \cdot w(i)), f(\vertex{b})) \le \epsilon$ for all $0 \le i \le |w|$.
\end{definition}

In \cite{foord2000thesis}, Foord proves that for a quasiconvex subgroup $H$ of a hyperbolic group $G$, the coset Cayley graph with respect to any finite generating set of $G$ is hyperbolic. He also shows that it has GIB($k$) for all non-negative $k \in \mathbb{Z}$ (Foord refers to this as $GIB(\infty)$) if and only if the index $|C_G(h) : C_G(h) \cap H|$ is finite for any $h \in H$. In particular, this is true of any torsion free quasiconvex subgroup. However, the hyperbolicity constant given there is rather inefficient, and no bounds on the constants involved in the GIB result are given. It is the aim of this chapter to generalise this work somewhat by dropping some of the restrictions that one graph be a Cayley graph and providing some rather lower constants.

\section{A Tighter Bound on the Thinness of Triangles}

The aim of this section is to demonstrate that hyperbolicity carries over through quasiconvex $X$-maps, and in particular that coset Cayley graphs of quasiconvex subgroups are themselves hyperbolic. This result is a generalisation of Theorem 4.1.33 %
in \cite{foord2000thesis}.

\begin{theorem}
\label{theorem:xg_h_qc_implies_h}
Suppose $\Gamma$ is a $\delta$-vertex-hyperbolic $X$-graph with base point $\vertex{e}$, that $\Gamma'$ is an $X$-graph and that $f : \Gamma \to \Gamma'$ is an $\epsilon$-quasiconvex $X$-map. Then $\Gamma'$ is $16\delta+2\epsilon+2$-vertex-hyperbolic.

If every vertex $\vertex{p}$ on the sides a geodesic triangle in $\Gamma'$ whose corners lie on vertices has $d(f(\vertex{e}), \vertex{p}) > 5\delta + \epsilon$ then that triangle is $12\delta+2$-vertex-thin.
\end{theorem}

\begin{proof}
Suppose we are given a geodesic triangle in $\Gamma'$ with corners $\vertex{A}$, $\vertex{B}$ and $\vertex{C}$. Suppose $f(\vertex{e}) \cdot w = \vertex{A}$, $\vertex{a} \cdot u = \vertex{B}$ and $\vertex{A} \cdot v = \vertex{B} \cdot x = \vertex{C}$, where $w$ is a $\Gamma'$-geodesic at $f(\vertex{e})$, and $u$, $v$ and $x$ are the $\Gamma'$-geodesic side labels of the triangle. The situation in $\Gamma'$ is illustrated in Figure \ref{figure:coset_thin_tri_in_ccay}.

We claim that for any such triangle, if $\vertex{P}$ is a vertex on $\path{\vertex{A}}{\vertex{B}}$ which corresponds to a vertex on $\path{\vertex{A}}{\vertex{C}}$, then either \begin{enumerate}
\item \label{item:corr} $\vertex{P}$ is within $6\delta$ of its corresponding vertex on $\path{\vertex{A}}{\vertex{C}}$,
\item \label{item:close} $\vertex{P}$ is within $5\delta+\epsilon$ of $f(\vertex{e})$, or
\item \label{item:feh} $\vertex{P}$ is within $3\delta+1$ of some other vertex on $\path{\vertex{A}}{\vertex{B}}$ with one of the first two properties.
\end{enumerate} Let us first show that this claim implies the theorem.

If $\vertex{P}$ satisfies the property \ref{item:feh} then let $\vertex{P'}$ be a vertex on $\path{\vertex{A}}{\vertex{B}}$ which is within $3\delta + 1$ of $\vertex{P}$ and satisfies property \ref{item:corr} or property \ref{item:close}; if not then simply let $\vertex{P'} := \vertex{P}$.

Suppose that $\vertex{P'}$ satisfies property \ref{item:close}. Since $d(\vertex{P'}, \vertex{e}) \le 5\delta + \epsilon$ we need only prove that $d(\vertex{P}, \vertex{Q}) \le 16\delta + 2\epsilon + 2$. Let $\vertex{Q}$ be the vertex on $\path{\vertex{A}}{\vertex{C}}$ which corresponds to $\vertex{P}$. By swapping $\vertex{B}$ and $\vertex{C}$, we see that $\vertex{Q}$ must also satisfy the claim. Pick the vertex $\vertex{Q'}$ in the same manner as $\vertex{P'}$ so that $d(\vertex{Q}, \vertex{Q'}) \le 3\delta + 1$.

If $\vertex{Q'}$ satisfies property \ref{item:close} then \begin{eqnarray*}
        d(\vertex{P}, \vertex{Q})
& \le & d(\vertex{P}, \vertex{P'}) + d(\vertex{P'}, f(\vertex{e})) + d(f(\vertex{e}), \vertex{Q'}) + d(\vertex{Q'}, \vertex{Q}) \\
& \le & 3\delta + 1 + 5\delta + \epsilon + 5\delta + \epsilon + 3\delta + 1 \\
&  =  & 16\delta + 2\epsilon + 2,
\end{eqnarray*} as required. If not, $\vertex{Q'}$ satisfies property \ref{item:corr}; in this case swap $\vertex{P}$ and $\vertex{Q}$ so that the only case left to deal with is the case where $\vertex{P'}$ satisfies property \ref{item:corr}.

To finish off, then, suppose that $\vertex{P'}$ satisfies property \ref{item:corr} so that $\vertex{P'}$ is within $6\delta$ of its corresponding point $\vertex{Q''}$ on $\path{\vertex{A}}{\vertex{C}}$. Notice that $d(\vertex{Q''}, \vertex{Q}) = d(\vertex{P'}, \vertex{P}) \le 3\delta$, so \begin{eqnarray*}
        d(\vertex{P}, \vertex{Q})
& \le & d(\vertex{P}, \vertex{P'}) + d(\vertex{P'}, \vertex{Q''}) + d(\vertex{Q''}, \vertex{Q}) \\
& \le & 3\delta + 1 + 6\delta + 3\delta + 1 \\
&  =  & 12\delta + 2,
\end{eqnarray*} which finishes the proof that the claim implies the theorem.

\begin{figure}
\begin{center}
\input coset_thin_tri_in_ccay.pstex_t
\caption{A general triangle in $\Gamma'$}
\label{figure:coset_thin_tri_in_ccay}
\end{center}
\end{figure}

\begin{figure}
\begin{center}
\input coset_thin_tri_in_cay.pstex_t
\caption{A hexagon in $\Gamma$ which maps to the triangle in $\Gamma'$}
\label{figure:coset_thin_tri_in_cay}
\end{center}
\end{figure}

It remains to prove the claim. We aim to translate the construction into $\Gamma$ in order to use hyperbolicity of $\Gamma$ to do do just this (see Figure \ref{figure:coset_thin_tri_in_cay} for an illustration of this construction). Let $\vertex{a} := \vertex{e} \cdot w$, $\vertex{b} := \vertex{a} \cdot u$, $\vertex{c} := \vertex{b} \cdot x$, $\vertex{a'} := \vertex{c} \cdot v^{-1}$ and $\vertex{e'} := \vertex{a'} \cdot w^{-1}$. Let $h$ be a $\Gamma$-geodesic word connecting $\vertex{e}$ to $\vertex{e'}$. We know that $\vertex{A} \cdot uxv^{-1} = \vertex{A}$, so $f(\vertex{a'}) = \vertex{A}$ and then $f(\vertex{e'}) = f(\vertex{e})$. Because $f$ is $\epsilon$-quasiconvex, each vertex $f(\vertex{e} \cdot h(j))$ must be within within $\epsilon$ of $f(\vertex{e})$.

Including $\vertex{e}$, these six points then form a geodesic hexagon in $\Gamma$ with sides labelled in turn $w$, $u$, $x$, $v^{-1}$, $w^{-1}$ and $h^{-1}$. Let $g$ be a $\Gamma$-geodesic word connecting $\vertex{a}$ to $\vertex{a'}$, and let $w'$ and $u'$ be $\Gamma$-geodesic words connecting $\vertex{e'}$ to $\vertex{a}$ and $\vertex{a'}$ to $\vertex{b}$ respectively.

Since $f(\vertex{e}) \cdot w = f(\vertex{e} \cdot hw') = f(\vertex{e}) \cdot w'$ and $w$ is a $\Gamma'$-geodesic at $f(\vertex{e})$, we must have \begin{equation} \label{eqn:w'_long}
|w'| \ge |w|.
\end{equation} Similarly $\vertex{A} \cdot u' = \vertex{A} \cdot u$ and $u$ is a $\Gamma'$-geodesic at $\vertex{A}$, so \begin{equation} \label{eqn:u'_long}
|u'| \ge |u|.
\end{equation}

\begin{figure}
\begin{center}
\input coset_thin_no_corr.pstex_t
\caption{No point on $\path{\vertex{a}}{\vertex{b}}$ can correspond only to a point on $\path{\vertex{a'}}{\vertex{e'}}$}
\label{figure:coset_thin_no_corr}
\end{center}
\end{figure}

Now (\ref{eqn:w'_long}) implies that $(\vertex{a}, \vertex{e'})_{\vertex{a'}} = \frac{|g|+ |w| - |w'|}{2} \le \frac{|g|}{2}$ and (\ref{eqn:u'_long}) implies that $(\vertex{a}, \vertex{b})_{\vertex{a'}} = \frac{|g| + |u'| - |u|}{2} \ge \frac{|g|}{2}$. Putting these together, we find that
\begin{equation} \label{eqn:no_corr}
(\vertex{a}, \vertex{b})_{\vertex{a'}} \ge (\vertex{a}, \vertex{e'})_{\vertex{a'}},
\end{equation} and no point on $\path{\vertex{a}}{\vertex{b}}$ can correspond only to a point on $\path{\vertex{a'}}{\vertex{e'}}$ (and vice versa), as illustrated in Figure \ref{figure:coset_thin_no_corr}.

Also, observe that (\ref{eqn:u'_long}) implies that $\frac{|u| + |v| - |x|}{2} \le \frac{|u'| + |v| - |x|}{2}$, or in other words
\begin{equation} \label{eqn:no_far_side}
(\vertex{B}, \vertex{C})_{\vertex{A}} \le (\vertex{b}, \vertex{c})_{\vertex{a'}}.
\end{equation}

Suppose now that $\vertex{P} = \vertex{A} \cdot u(i)$ is a vertex on $\path{\vertex{A}}{\vertex{B}}$ which corresponds to a vertex $\vertex{Q} = \vertex{A} \cdot v(i)$ on $\path{\vertex{A}}{\vertex{C}}$. Let $\vertex{p} := \vertex{a} \cdot u(i)$ and let $\vertex{q} := \vertex{a'} \cdot v(i)$ so that $\vertex{P} = f(\vertex{p})$ and $\vertex{Q} = f(\vertex{q})$.

We can now observe some cases which will be treated in order of increasing distance from $\vertex{p}$ to $\vertex{a}$.

\begin{figure}
\begin{center}
\input coset_thin_swap_sides.pstex_t
\caption{Vertices on $\path{\vertex{a}}{\vertex{e}}$ are equal to vertices on $\path{\vertex{a'}}{\vertex{e'}}$ after applying $f$}
\label{figure:coset_thin_swap_sides}
\end{center}
\end{figure}

\textbf{Case 1}: Suppose that $i \le \min\{(\vertex{a'}, \vertex{b})_{\vertex{a}}, (\vertex{e}, \vertex{e'})_{\vertex{a}}\}$. Notice that (\ref{eqn:no_corr}) implies that $(\vertex{a'}, \vertex{e'})_{\vertex{a}} \ge (\vertex{a'}, \vertex{b})_{\vertex{a}}$ so that $i \le (\vertex{a'}, \vertex{e'})_{\vertex{a}}$ as well. Then this case applies if and only if $\vertex{p}$ $3$-corresponds to a vertex $\vertex{r}$ on $\path{\vertex{e}}{\vertex{a}}$ as illustrated in Figure \ref{figure:coset_thin_swap_sides}.

Now $\vertex{r} = \vertex{e} \cdot w (|w|-i)$ and $f(\vertex{e}) \cdot w(|w|-i))= f(\vertex{e}) \cdot hw(|w|-i)$, so let $\vertex{s} := \vertex{e'} \cdot w(|w|-i)$; that is the point ``opposite'' $\vertex{r}$. Using Propostion \ref{proposition:contraction}, observe that $d(\vertex{P}, f(\vertex{s})) = d(\vertex{P}, f(\vertex{r})) \le d(\vertex{p}, \vertex{r}) \le 3\delta$. There are a number of sub-cases, depending on which side of the $\vertex{s}$ chain-corresponds to. Again, we will treat them with smallest $i$ first.

\textbf{Case 1a}: Suppose that $i \le (\vertex{e'}, \vertex{a})_{\vertex{a'}}$ so that $\vertex{s}$ corresponds to a vertex on $\path{\vertex{a'}}{\vertex{a}}$. By (\ref{eqn:no_corr}) we know that $(\vertex{e'}, \vertex{a})_{\vertex{a'}} \le (\vertex{a}, \vertex{b})_{\vertex{a'}}$ so that vertex in turn corresponds to a vertex on $\path{\vertex{a'}}{\vertex{b}}$. Finally, by (\ref{eqn:no_far_side}) we have $i \le (\vertex{b}, \vertex{c})_{\vertex{a'}}$, so $\vertex{s}$ $3$-corresponds to a vertex on $\path{\vertex{a'}}{\vertex{c}}$. Since $d(\vertex{a'}, \vertex{s}) = i = d(\vertex{a'}, \vertex{q})$, this vertex must be $\vertex{q}$, and $d(f(\vertex{s}), \vertex{Q}) \le d(\vertex{s}, \vertex{q}) \le 3\delta$ so we have $d(\vertex{P}, \vertex{Q}) \le 6\delta$ as required for the property \ref{item:corr} of the claim.

For Cases 1b and 1c, we may therefore assume that $i > (\vertex{e'}, \vertex{a})_{\vertex{a'}}$ so that $\vertex{s}$ corresponds to a vertex on $\path{\vertex{e'}}{\vertex{a'}}$.

\textbf{Case 1b}: Suppose that $\vertex{s}$ $2$-corresponds to a vertex $\vertex{t}$ on $\path{\vertex{e}}{\vertex{a}}$ as in Figure \ref{figure:coset_thin_self_corr}. Since $w$ is a $\Gamma'$-geodesic at $f(\vertex{e})$, we must have \begin{eqnarray*}
        d(\vertex{a}, \vertex{t})
&  =  & d(f(\vertex{a}), f(\vertex{t})) \\
&  =  & d(f(\vertex{a'}), f(\vertex{t})) \\
& \le & d(f(\vertex{a'}), f(\vertex{s})) + d(f(\vertex{s}), f(\vertex{t}))\\
& \le & d(\vertex{a'}, \vertex{s}) + d(\vertex{s}, \vertex{t}) \\
& \le & d(\vertex{a}, \vertex{r}) + 2\delta\\
& \le & (\vertex{a'},\vertex{e'})_{\vertex{a}}+2\delta.
\end{eqnarray*} Now $d(\vertex{a'},\vertex{s})=d(\vertex{a},\vertex{t})-(\vertex{a'},\vertex{e'})_{\vertex{a}}+(\vertex{e'},\vertex{a})_{\vertex{a'}}\le(\vertex{e'},\vertex{a})_{\vertex{a'}}=2\delta$. Now let $\vertex{p'} := \vertex{a} \cdot u(j)$ where $j = \max\{i-2\delta, 0\}$, and $j\le(\vertex{e'},\vertex{a})_{\vertex{a'}}$ just as in Case 1a. Thus we have shown that $\vertex{P}$ satisfies the property \ref{item:feh} of the claim, as does any vertex within $\delta + 1$ of $\vertex{p}$ (which is relevant to Case 4).

\begin{figure}
\begin{center}
\input coset_thin_self_corr.pstex_t
\caption{In this situation, the dashed path must be longer than $d(\vertex{e'}, \vertex{s})$}
\label{figure:coset_thin_self_corr}
\end{center}
\end{figure}

\textbf{Case 1c}: Finally, suppose that $\vertex{s}$ $2$-corresponds to a vertex $\vertex{t}$ on $\path{\vertex{e}}{\vertex{e'}}$. Since $f$ is quasiconvex, $d(f(\vertex{t}), f(\vertex{e})) \le \epsilon$, so $d(\vertex{P}, f(\vertex{e})) \le d(\vertex{p}, \vertex{r}) + d(\vertex{r}, \vertex{t}) + \epsilon \le 5 \delta + \epsilon$ and $\vertex{P}$ satisfies property \ref{item:close} of the claim.

All possibilities where $\vertex{p}$ $3$-corresponds to a vertex on $\path{\vertex{e}}{\vertex{a}}$ have now been covered.

\textbf{Case 2}: Suppose that $i \le (\vertex{a'}, \vertex{b})_{\vertex{a}}$ but $i > (\vertex{e}, \vertex{e'})_{\vertex{a}}$. Again by (\ref{eqn:no_corr}) we know that $i \le (\vertex{a'}, \vertex{e'})_{\vertex{a}}$, so $\vertex{p}$ must $3$-correspond to a vertex $\vertex{r}$ on $\path{\vertex{e}}{\vertex{e'}}$. Since $f$ is $\epsilon$-quasiconvex, $d(f(\vertex{r}), f(\vertex{e})) \le \epsilon$ and so $d(\vertex{P}, f(\vertex{e})) \le d(\vertex{p}, \vertex{r}) + \epsilon \le 3\delta + \epsilon$ and $\vertex{P}$ satisfies property \ref{item:close} of the claim.

We have now dealt with all possibilities where $i\le(\vertex{a'},\vertex{b})_{\vertex{a}}$ and may thus assume that $i > (\vertex{a'}, \vertex{b})_{\vertex{a}}$. The remainder all see $\vertex{p}$ chain-correspond to a vertex $\vertex{r}$ on $\path{\vertex{a'}}{\vertex{c}}$ or on $\path{\vertex{c}}{\vertex{b}}$ which maps through $f$ to a vertex on one of the original sides of the triangle. If we were proving the triangle were slim, we could stop now; here we still need to show that $\vertex{r}$ is close to $\vertex{q}$.

\textbf{Case 3}: Suppose that $d(\vertex{p}, \vertex{b}) = |u| - i \ge (\vertex{a'}, \vertex{c})_{\vertex{b}}$ so that $\vertex{p}$ $2$-corresponds to a vertex $\vertex{r} = \vertex{a'} \cdot v(j)$ on $\path{\vertex{a'}}{\vertex{c}}$, as illustrated in Figure \ref{figure:coset_thin_near_corr}. We have \begin{eqnarray*}
        j
&  =  & d(\vertex{a}, \vertex{r}) \\
&  =  & d(\vertex{A}, f(\vertex{r})) \\
& \le & d(\vertex{A}, \vertex{P}) + d(\vertex{P}, f(\vertex{r})) \\
& \le & i + d(\vertex{p}, \vertex{r}) \\
& \le & i + 2\delta,
\end{eqnarray*} and reversing the roles of $i$ and $j$ we find that $i \le j + 2\delta$ and so $|j - i| \le 2\delta$. Now \begin{eqnarray*}
        d(\vertex{P}, \vertex{Q})
& \le & d(\vertex{p}, \vertex{q}) \\
& \le & d(\vertex{p}, \vertex{r}) + d(\vertex{r}, \vertex{q}) \\
&  =  & d(\vertex{p}, \vertex{r}) + |i - j| \\
& \le & 4\delta,
\end{eqnarray*} and we have shown that $\vertex{P}$ satisfies property \ref{item:corr} of the claim.

\begin{figure}
\begin{center}
\input coset_thin_near_corr.pstex_t
\caption{Again, the dashed paths cannot be too short}
\label{figure:coset_thin_near_corr}
\end{center}
\end{figure}

\textbf{Case 4}: The remaining case has $i > |u| - (\vertex{a'}, \vertex{c})_{\vertex{b}}$ so that $\vertex{p}$ $2$-corresponds to some vertex $r$ on $\path{\vertex{b}}{\vertex{c}}$. Observe that \begin{eqnarray*}
        |v|
&  =  & d(\vertex{C}, \vertex{A}) \\
& \le & d(\vertex{c}, \vertex{a}) \\
& \le & d(\vertex{c}, \vertex{r}) + d(\vertex{r}, \vertex{p}) + d(\vertex{p}, \vertex{a}) \\
& \le & |x| - d(\vertex{b}, \vertex{r}) + d(\vertex{r}, \vertex{p}) + d(\vertex{p}, \vertex{a}) \\
& \le & |x| - (|u| - i) + 2\delta + i \\
&  =  & |x| - |u| + 2i + 2\delta,
\end{eqnarray*} but then by re-arranging, we see \begin{eqnarray*}
        i
& \le & (\vertex{B}, \vertex{C})_{\vertex{A}} \\
&  =  & \frac{|u| + |v| - |x|}{2} \\
& \le & i + \delta
\end{eqnarray*} Now let $\vertex{p'} = \vertex{a} \cdot u(j)$ where $j = \max\{i - \delta - 1, 0\}$. Then $d(\vertex{P},f(\vertex{p'}))=d(\vertex{p'},\vertex{p})\le\delta+1$ and either $j=0$ so that $f(\vertex{p'})$ is in Case 1a or $j > 0$ and the above inequality is not satisfied if one sets $i = j$, so in either case $f(\vertex{p'})$ can be assumed to be in a case other than this one. Combining this with Case 1b we see that $\vertex{P}$ is within $3\delta+1$ of a vertex $\vertex{P'}$ which satisfies one of the first two properties in the claim.

Since all possible vertices to which $\vertex{p}$ can chain-correspond to have been shown to imply the claim, the claim and therefore the theorem is now proved.
\end{proof}

This is a first hint that there is some ball about the base point, outside of which the contraction behaves much like the original graph. It seems likely that the proof above should adapt quite well to general hyperbolic graphs and probably hyperbolic spaces, though restricting to $X$-graphs simplifies the situation as given a connected structure in the target, one need only read off the path labels to find a connected structure in the domain which maps onto it.

\begin{corollary}
If $G = <\!X\!>$ is a $\delta$-hyperbolic group and $H$ is a $\epsilon$-quasiconvex subgroup then the coset Cayley graph of $H$ is $16\delta + 2\epsilon + 2$-vertex-hyperbolic, and geodesic triangles in the coset Cayley graph with corners on vertices in which all vertices on all sides are further than $5\delta + \epsilon$ from the vertex corresponding to $H$ are $12\delta+2$-vertex-thin.
\end{corollary}

\begin{proof}
If the Cayley and coset Cayley graphs are $\Gamma$ and $\Gamma'$ respectively, the map $f : \Gamma \to \Gamma' : 1 \cdot w \mapsto Hw$ is an $\epsilon$-quasiconvex $X$-map, so Theorem \ref{theorem:xg_h_qc_implies_h} finishes the proof.
\end{proof}

\section{A Linear Bound on the GIB($k$) Constant for Torsion Free Subgroups}

For torsion free subgroups, Foord demonstrates the GIB($k$) property for any $k$ for a specific class of subgroups (those subgroups $H$ where $|H : H \cup C_G(h)|$ is finite for all elements $h$ in $H$), however he gives no bound on the value of the constant associated to it. It is the aim of this section to demonstrate that for torsion-free subgroups, said bound is in $O(k + \epsilon)$. The argument is similar to that of Foord relating the finiteness of the index $|H : H \cup C_G(h)|$ coupled with some observations made elsewhere in this thesis to bound said index.

The following result is a generalisation of Lemma 4.1.1.3 %
in \cite{foord2000thesis}.

\begin{proposition}
\label{prop:loop_in_ball}
Suppose $\Gamma_1$ and $\Gamma_2$ are $X$-graphs.

If $\vertex{x_1} \in \Gamma_1$ and $\vertex{x_2} \in \Gamma_2$ are vertices and for some non-negative integer $k$ the balls $B_k(\vertex{x_1})$ and $B_k(\vertex{x_2})$ are not isomorphic, then there is some $X$-word $w$ of length at most $2k+1$ which labels a loop at $\vertex{x_2}$ but does not label a loop at $\vertex{x_1}$ or vice versa.

If there is an $X$-ball morphism from $B_k(\vertex{x_1})$ to $B_k(\vertex{x_2})$ then $w$ labels a loop at $\vertex{x_2}$.

Suppose additionally that $\Gamma$ is an $X$-graph with IB($2k+1$) and that the centre of $\canonicalball{2k+1}{\Gamma}$ is $\vertex{p}$. If for $i \in \{1, 2\}$ there is an $X$-ball morphism from $\canonicalball{2k+1}{\Gamma}$ to $B_{2k+1}^{\Gamma_i}(\vertex{x_i})$ then $w$ can be taken to be a $\Gamma$-geodesic at $\vertex{p}$.
\end{proposition}

\begin{proof}
We assume there is no word $w$ as in the hypothesis and demonstrate that there is an isomorphism of balls.

Proposition \ref{proposition:xmap_defined_by_point} implies that if an $X$-map $f:B_k(\vertex{x_1})\to B_k(\vertex{x_2})$ exists sending $\vertex{x_1}$ to $\vertex{x_2}$, it must map $\vertex{x_1} \cdot w$ to $\vertex{x_2} \cdot w$ for all $B_k(\vertex{x_1})$-words $w$, and if this describes a well-defined function then that function is an $X$-map. Let us aim for a contradiction and assume, then, that this map is not well defined, so there exist $X$-words $u$ and $v$ such that $u$ and $v$ are both $B_k(\vertex{x_1})$-words at $\vertex{x_1}$ and $B_k(\vertex{x_2})$-words at $\vertex{x_2}$, and that $\vertex{x_1} \cdot u = \vertex{x_1} \cdot v$ but $\vertex{x_2} \cdot u \ne \vertex{x_2} \cdot v$.

For each $0 \le j \le |u|$, let $z_j$ be a $\Gamma_1$-geodesic word which connects $\vertex{x_1}$ to $\vertex{x_1} \cdot \nolinebreak u(j)$. Notice that $|z_j| \le k$ for all $j$. Suppose that for some $0 \le l < |u|$ we have $\vertex{x_2} \cdot z_l = \vertex{x_2} \cdot u(l)$, but $\vertex{x_2} \cdot z_{l+1} \ne \vertex{x_2} \cdot u(l+1)$. Let $w := z_lu[l+1]z_{l+1}^{-1}$. Then $|w| \le |z_l| + 1 + |z_{l+1}| \le 2k+1$, and $w$ labels a loop at $\vertex{x_1}$ but not $\vertex{x_2}$, a contradiction. If there is no such $l$, we may replace $u$ with $z_{|u|}$ which is a $\Gamma_1$-geodesic at $\vertex{x_1}$, and in particular satisfies $|u| \le k$.

These arguments can also be applied to $v$, so we can assume $|v| \le k$. Now if $\vertex{x_1} \cdot u = \vertex{x_1} \cdot v$ but $\vertex{x_2} \cdot u \ne \vertex{x_2} \cdot v$ then let $w := uv^{-1}$. Since $|w| \le |u| + |v| \le 2k$ and $w$ labels a loop at $\vertex{x_1}$ but not $\vertex{x_2}$, we again have a contradiction.

Thus $\vertex{x_1} \cdot u = \vertex{x_1} \cdot v$ implies that $\vertex{x_2} \cdot u = \vertex{x_2} \cdot v$ and there is an $X$-map from $B_k(\vertex{x_1})$ to $B_k(\vertex{x_2})$ which sends $\vertex{x_1}$ to $\vertex{x_2}$, ie.\ a ball morphism. Swapping $\Gamma_1$ and $\Gamma_2$ shows a ball morphism exists in the other direction. Since ball morphisms are surjective, this implies these balls contain the same number of vertices and so the morphism must also be injective, ie. an isomorphism.

To derive the second statement, let $f$ be the $X$-ball morphism. Note that if $w$ labels a loop at $\vertex{x_1}$ then \begin{eqnarray*}
      \vertex{x_2} \cdot w
& = & f(\vertex{x_1}) \cdot w \\
& = & f(\vertex{x_1} \cdot w) \\
& = & f(\vertex{x_1}) = \vertex{x_2},
\end{eqnarray*} so $w$ must also label a loop at $\vertex{x_2}$. Thus any loop present at the centre of only one ball must be a loop at $\vertex{x_2}$ and not at $\vertex{x_1}$.

For the final statement, let $f_i$ be the $X$-ball morphisms. Notice that if $w'$ is a $\canonicalball{2k+1}{\Gamma}$-geodesic connecting $\vertex{p}$ to $\vertex{x} \cdot w$, then for each $i$ we have \begin{eqnarray*}
      \vertex{x_i} \cdot w'
& = & f_i(\vertex{p}) \cdot w' \\
& = & f_i(\vertex{p} \cdot w') \\
& = & f_i(\vertex{p} \cdot w) \\
& = & f_i(\vertex{p}) \cdot w \\
& = & \vertex{x_i} \cdot w,
\end{eqnarray*} so $w'$ labels a loop at $\vertex{x_i}$ if and only if $w$ does. We may therefore replace $w$ with $w'$ and the result is proved.
\end{proof}

The simple identifying property given above allows us to much more easily determine whether balls are isomorphic or not. We now give a simple characterisation of loops in certain $X$-graphs.

\begin{lemma}
\label{lemma:conj_quadrilateral}
Suppose that $\Gamma$ and $\Gamma'$ are $X$-graphs, that $\Gamma$ is $\delta$-vertex-hyperbolic and has base point $\vertex{a}$ and that $f : \Gamma \to \Gamma'$ is an $\epsilon$-quasiconvex $X$-map. Suppose further that $w$ is a $\Gamma'$-geodesic word at $f(\vertex{a})$ and that $u$ is a $\Gamma$-geodesic word at $\vertex{a} \cdot w$ with $f(\vertex{a} \cdot w) = f(\vertex{a} \cdot wu)$. Then there exists a $\Gamma$-geodesic word $v$ at $\vertex{a}$ such that $\vertex{a} \cdot v = \vertex{a} \cdot wuw^{-1}$ and either

\begin{enumerate}
\item $|v| \le |u| - 2|w| + 6\delta + 4\epsilon + 2$ and $|v| \le |u| + 3\delta + 2\epsilon + 2$, and $2|w| \le |u| + 3\delta + 2\epsilon + 1$, or
\item $|v| \le 3\delta + 2\epsilon + 1$ and $\frac{|u|}{2} \ge (w^{-1}, u)_{\vertex{a} \cdot w} \ge \frac{|u|}{2} - \delta$.
\end{enumerate}

In the second case, if $|u| > 2\delta$, let $i := \floor{\frac{|u|}{2}} - \delta$ and there is a word $u'$ with $|u'| \le 5\delta + 1$ such that $\vertex{a} \cdot wu = \vertex{a} \cdot w(|w|-i)u'w(|w|-i:|w|)$.
\end{lemma}


\begin{figure}
\begin{center}
\input quad_case_1.pstex_t
\caption{A loop $u$ close to $H$}
\label{figure:conj_quad_close}
\end{center}
\end{figure}

\begin{figure}
\begin{center}
\input quad_case_2.pstex_t
\caption{A loop $u$ distant from $H$}
\label{figure:conj_quad_distant}
\end{center}
\end{figure}

\begin{proof}
Let $v$ be any $\Gamma$-geodesic connecting $\vertex{a}$ to $\vertex{a} \cdot wuw^{-1}$. Then $f(\vertex{a} \cdot v) = f(\vertex{a})$, so $f(\vertex{a} \cdot v(i))$ is within $\epsilon$ of $f(\vertex{e})$ for all integers $i$. Form a geodesic quadrilateral in $\Gamma$ with corners $\vertex{a}$, $\vertex{b} := \vertex{a} \cdot v$, $\vertex{c} := \vertex{b} \cdot w$ and $\vertex{d} := \vertex{c} \cdot u^{-1} = \vertex{a} \cdot w$, picking $\path{\vertex{b}}{\vertex{c}}$ and $\path{\vertex{a}}{\vertex{d}}$ such that they are both labelled $w$. Split the quadrilateral into two triangles using some $\Gamma$-geodesic $\path{\vertex{a}}{\vertex{c}}$.

Let $m$ be the number of vertices on $\path{\vertex{b}}{\vertex{c}}$, excluding $\vertex{b}$ itself, which correspond to vertices on $\path{\vertex{a}}{\vertex{b}}$, in other words $\floor{(\vertex{a}, \vertex{c})_{\vertex{b}}}$. Let $\vertex{x}$ be the vertex on $\path{\vertex{b}}{\vertex{c}}$ with $d(\vertex{x}, \vertex{b}) = m$, so that $\vertex{x}$ corresponds to a vertex $\vertex{y}$ on $\path{\vertex{a}}{\vertex{b}}$. Since $\path{\vertex{a}}{\vertex{b}}$ is a $\Gamma$-geodesic at $\vertex{a}$ and $f$ is $\epsilon$-quasiconvex, there exists some $\vertex{g} \in \Gamma$ such that $f(\vertex{g}) = f(\vertex{a})$ and $d(\vertex{g}, \vertex{y}) \le \epsilon$. Then $d(f(\vertex{x}), f(\vertex{b})) = d(f(\vertex{x}), f(\vertex{g})) \le d(\vertex{x}, \vertex{g}) \le \delta + \epsilon$. Since $w$ is a $\Gamma'$-geodesic at $f(\vertex{a}) = f(\vertex{b})$, we therefore have $m = d(\vertex{x}, \vertex{b}) = d(f(\vertex{x}), f(\vertex{b})) \le \delta + \epsilon$.

Let $n$ be the number of vertices on $\path{\vertex{a}}{\vertex{d}}$, excluding $\vertex{a}$ itself, which $2$-correspond to a vertex on $\path{\vertex{a}}{\vertex{b}}$. Then a similar construction to that in the previous paragraph shows that $n \le 2\delta + \epsilon$.

We will now show that $(\vertex{d}, \vertex{c})_{\vertex{a}} < (\vertex{c}, \vertex{b})_{\vertex{a}}$ implies the first case in the hypothesis. If this inequality is satisfied, no vertices on $\path{\vertex{b}}{\vertex{c}}$ can $2$-correspond to vertices on $\path{\vertex{a}}{\vertex{d}}$ as the situation is as illustrated in Figure \ref{figure:conj_quad_close}. Let $l$ be the number of vertices on $\path{\vertex{a}}{\vertex{b}}$ which $2$-correspond only to vertices on $\path{\vertex{d}}{\vertex{c}}$, so that by counting vertices we find that \begin{equation} \label{eqn:v_length}
|v| + 1 = l + (m+1) + (n+1).
\end{equation}

Note that the remaining $|w|-m$ vertices on $\path{\vertex{b}}{\vertex{c}}$ and the remaining $|w|-n$ vertices on $\path{\vertex{a}}{\vertex{d}}$ which don't chain-correspond to vertices on $\path{\vertex{a}}{\vertex{b}}$ must instead correspond to vertices on $\path{\vertex{d}}{\vertex{c}}$ and vice versa, so again counting vertices we see that $|u|$ is within $1$ of $l + (|w|-m) + (|w|-n)$. Notice that it is possible for some of these correspondances to overlap,which is why this statement is not an equality. Combining this with (\ref{eqn:v_length}), we find that $|v| - m - n - 1 =^1 |u| - 2|w| + m + n$, so $|v| =^1 |u| + 2(m + n - |w|) + 1$.

We know that $2|w| \ge m + n$ and $m + n \le 3\delta + 2\epsilon$, so we can derive $|v| \le |u| - 2|w| + 6\delta + 4\epsilon + 2$ and $|v| \le |u| + m + n + 2 \le |u| + 3\delta + 2\epsilon + 2$. Similarly, $|v| \ge n + m + 1$ so we obtain \begin{eqnarray*}
        2|w|
& \le & |u| - |v| + 2n + 2m + 2 + 2 \\
& \le & |u| + 3\delta + 2\epsilon + 1.
\end{eqnarray*}

All inequalities for the first case of the hypothesis have now been shown to be satistied. Assume, then, that $(\vertex{d}, \vertex{c})_{\vertex{a}} \ge (\vertex{c}, \vertex{b})_{\vertex{a}}$, and it remains to show that the second case applies. Figure \ref{figure:conj_quad_distant} illustrates this situation.

All points on $\path{\vertex{a}}{\vertex{b}}$ must now chain-correspond to points on $\path{\vertex{b}}{\vertex{c}}$ or $\path{\vertex{a}}{\vertex{d}}$ so we have $|v| + 1 \le m + 1 + n + 1$ and in particular $|v| \le 2\epsilon + 3\delta + 1$ as required by the second case.

Note that there is at least one $i$ such that the vertex $\vertex{p} = \vertex{b} \cdot w(i)$ on $\path{\vertex{b}}{\vertex{c}}$ corresponds to a vertex $\vertex{p'}$ on $\path{\vertex{a}}{\vertex{c}}$ which in turn corresponds to a vertex $\vertex{q} = \vertex{a} \cdot w(j)$ on $\path{\vertex{a}}{\vertex{d}}$ for some $j$. For any such points, note that $\vertex{r} := \vertex{a} \cdot w(i)$ is on $\path{\vertex{b}}{\vertex{c}}$ and $f(\vertex{r}) = f(\vertex{a} \cdot w(i)) = f(\vertex{b} \cdot w(i))$, so \begin{eqnarray*}
        |i -j|
&  =  & d(\vertex{r}, \vertex{q}) \\
&  =  & d(f(\vertex{r}), f(\vertex{q})) \\
&  =  & d(f(\vertex{p}), f(\vertex{q})) \\
& \le & d(\vertex{p}, \vertex{q}) \\
& \le & 2\delta.
\end{eqnarray*}

This implies that \begin{eqnarray*}
        d(\vertex{a}, \vertex{c})
&  =  & d(\vertex{a}, \vertex{q}) + d(\vertex{a}, \vertex{c}) - d(\vertex{a}, \vertex{q}) \\
&  =  & d(\vertex{a}, \vertex{q}) + d(\vertex{c}, \vertex{p'}) \\
&  =  & d(\vertex{a}, \vertex{q}) + d(\vertex{c}, \vertex{p}) \\
&  =  & d(\vertex{a}, \vertex{q}) + d(\vertex{c}, \vertex{b}) - d(\vertex{b}, \vertex{p}) \\
&  =  & j + |w| - i \\
& \le & |w| + 2\delta.
\end{eqnarray*} Also, since $w$ is a $\Gamma'$-geodesic at $f(\vertex{b})$ we have \begin{eqnarray*}
        |w|
&  =  & d(f(\vertex{b}), f(\vertex{c})) \\
&  =  & d(f(\vertex{a}), f(\vertex{c})) \\
& \le & d(\vertex{a}, \vertex{c}),
\end{eqnarray*} so \begin{eqnarray*}
        \frac{|u|}{2}
&  =  & \frac{|u| + |w| - d(\vertex{a}, \vertex{c})}{2}
   =    (\vertex{c}, \vertex{a})_{\vertex{d}} \\
& \ge & \frac{|u|}{2} - \delta
\end{eqnarray*} and similarly $(\vertex{c},\vertex{a})_{\vertex{d}} \le \frac{|u|}{2}$. Since $(w^{-1}, u)_{\vertex{a} \cdot w} = (\vertex{c},\vertex{a})_{\vertex{d}}$, we have now shown that the second case applies.

For the last part, let $\vertex{s}$ on $\path{\vertex{b}}{\vertex{c}}$ and $\vertex{t}$ on $\path{\vertex{a}}{\vertex{d}}$ be the vertices at distance $i = \floor{\frac{|u|}{2}} - \delta$ from $\vertex{c}$ and $\vertex{d}$ respectively, so that they chain-correspond to points $\vertex{s'}$ and $\vertex{t'}$ on $\path{\vertex{d}}{\vertex{c}}$ at most $2\delta + 1$ apart. We can see now that $d(\vertex{s}, \vertex{t}) \le d(\vertex{s}, \vertex{s'}) + d(\vertex{s'}, \vertex{t'}) + d(\vertex{t'}, \vertex{t}) \le 5\delta + 1$ and letting $u'$ be a word labelling a path between $\vertex{s}$ and $\vertex{t}$, we have $\vertex{a} \cdot wu = \vertex{a} \cdot w(|w|-i)u'w(|w|-i:|w|)$ as required.
\end{proof}

In particular, we can show that long loops which are far from the base point in the target graph of a quasiconvex $X$-map can be ``pulled'' to shorter loops which are closer to the base point, which in particular means that we can show that if for we have IB($k$) in $\Gamma'$ for large enough $k$ then we have IB($k$) in $\Gamma'$ for any $k$. The following proposition is similar to part of the proof of 4.3.1.1 % TODO what sort of result
in \cite{foord2000thesis}.

\begin{proposition}
\label{prop:small_ib_implies_ib}
Suppose that $\Gamma$ and $\Gamma'$ are $X$-graphs, that $\Gamma$ has IB($2k+3\delta+2$) with constant $M$ for some $k \ge \frac{5}{2}\delta$, is $\delta$-vertex-hyperbolic and has base point $\vertex{a}$ and that $f : \Gamma \to \Gamma'$ is an $\epsilon$-quasiconvex $X$-map.

If $\Gamma'$ has IB($\frac{5}{2}\delta$) with constant $K$ then it has IB($k$) with constant $\max\{M + k - \delta, K + k - \delta, \epsilon + \frac{3\delta + 2k + 1}{2}\}$.

If additionally $\{\Gamma, \Gamma'\}$ has IB($\frac{5}{2}\delta$), then it has IB($k$).
\end{proposition}

\begin{proof}
Let $K' = \max\{M + k - \delta, K + k - \delta, \epsilon + \frac{3\delta + 2k + 1}{2}\}$ and suppose that $\Gamma'$ has IB($\frac{5}{2}\delta$) with constant $K$, has base point $\vertex{a}$, and that $f(\vertex{a}) = \vertex{z}$. Now suppose that $\vertex{x}, \vertex{y} \in \Gamma'$ have $d(\vertex{z}, \vertex{x}) > K'$ and $d(\vertex{z}, \vertex{y}) > K'$. Then we must prove that $B_k(\vertex{x})$ and $B_k(\vertex{y})$ are $X$-ball isomorphic to show the first part, and we must prove that if $\{\Gamma, \Gamma'\}$ has IB($\frac{5}{2}\delta$) then $B_k(\vertex{x})$ is $X$-ball isomorphic to $\canonicalball{k}{\Gamma}$ to prove the second part.

Let us suppose that this is not the case. Since $f$ is an $X$-map, it is surjective, so pick vertices $\vertex{b}$ and $\vertex{c}$ such that $f(\vertex{b}) = \vertex{x}$ and $f(\vertex{c}) = \vertex{y}$. Then $d(\vertex{a}, \vertex{b}) \ge d(\vertex{z}, \vertex{x}) > M$ and similarly $d(\vertex{a}, \vertex{c}) > M$, so $B_{2k+1}(\vertex{b})$ and $B_{2k+1}(\vertex{c})$ are $X$-ball isomorphic to $\canonicalball{2k+1}{\Gamma}$. Notice that $f$ restricts to ball morphisms from $B_{2k+1}(\vertex{b})$ and $B_{2k+1}(\vertex{c})$ to $B_{2k+1}(\vertex{x})$ and $B_{2k+1}(\vertex{y})$ respectively.

We may now apply the last part of Proposition \ref{prop:loop_in_ball} to see that there is a $\canonicalball{2k+1}{\Gamma}$-geodesic at the centre of $\canonicalball{2k+1}{\Gamma}$, say $u$, which labels a loop at the centre one ball and not the other. For the first statement, we may suppose that this loop is present at $\vertex{x}$ and not $\vertex{y}$. For the second statement we may assume the loop is present at $\vertex{x}$ and not at $\vertex{b}$.

In either case, let $w$ be a $\Gamma'$-geodesic connecting $\vertex{z}$ to $\vertex{x}$. Observe that Lemma \ref{lemma:conj_quadrilateral} applies. Since $d(\vertex{z}, \vertex{x})$ and $d(\vertex{z}, \vertex{y})$ are both strictly greater than $K' \ge \epsilon + \frac{3\delta + 2k + 1}{2}$ we must have $2|w| > 2\epsilon + 3\delta + 2k + 1 \ge |u| + 3\delta + 2\epsilon + 1$ so that only the second case of Lemma \ref{lemma:conj_quadrilateral} can apply.

Since $\Gamma'$ has IB($\frac{5}{2}\delta$) with constant $K$ and $K' \ge K + k - \delta + 1 > K$, the balls $B_{\frac{5}{2}\delta}(\vertex{x})$ and $B_{\frac{5}{2}\delta}(\vertex{y})$ (or $\canonicalball{\frac{5}{2}\delta}{\Gamma}$ for the second statement) must be $X$-ball isomorphic. Since $u$ labels a loop at the centre of one ball and not the other, it must stray further than $\frac{5}{2}\delta$ from $\vertex{x}$ and then return, so in particular $|u| > 2\frac{5}{2}\delta + 1 > 2\delta$.

We can now use the final part of Lemma \ref{lemma:conj_quadrilateral}. Let $i := \floor{\frac{|u|}{2}} - \delta$, and let $u'$ be a word with $|u'| \le 5\delta + 1$ and $\vertex{a} \cdot wu = \vertex{a} \cdot w(|w|-i)u'w(|w|-i:|w|)$. Let $\vertex{x'} = f(\vertex{a} \cdot w(|w|-i))$ so that \begin{eqnarray*}
& = & \vertex{x'} \cdot u' \\
& = & f(\vertex{a} \cdot w(|w|-i)u') \\
& = & f(\vertex{a} \cdot w(|w|-i)u'w(|w|-i:|w|)w(|w|-i:|w|)^{-1}) \\
& = & f(\vertex{a} \cdot wuw(|w|-i:|w|)^{-1}) \\
& = & f(\vertex{a} \cdot ww(|w|-i:|w|)^{-1}) \\
& = & f(\vertex{a} \cdot w(|w|-i)) \\
& = & \vertex{x'},
\end{eqnarray*} so $u'$ labels a loop at $\vertex{x'}$. Since $|u'| \le 5\delta+1$ and $d(\vertex{z}, \vertex{x'}) = |w| - i \ge K' - k + \delta > K$, we therefore find that $u'$ labels a loop at the centre of $\canonicalball{\frac{5}{2}\delta}{\Gamma'}$.

If $\{\Gamma, \Gamma'\}$ has IB($\frac{5}{2}\delta$) as in the second statement, we find that since there is a ball isomorphism from $\canonicalball{\frac{5}{2}\delta}{\Gamma}$ to $\canonicalball{\frac{5}{2}\delta}{\Gamma'}$, the $X$-word $u'$ also labels a loop at the centre of $\canonicalball{\frac{5}{2}\delta}{\Gamma}$. Let $\vertex{b'} = \vertex{a} \cdot w(|w| - i)$. Then $d(\vertex{a}, \vertex{b'}) = |w| - i \ge K' - k + \delta > M$ so $B_{2k+3\delta+2}(\vertex{b'})$ is ball isomorphic to $\canonicalball{2k+3\delta+2}{\Gamma}$, and in particular $B_{\frac{5}{2}\delta}(\vertex{b'})$ is isomorphic to $\canonicalball{\frac{5}{2}\delta}{\Gamma}$. This implies that $u'$ labels a loop at $\vertex{b'}$ and, being a $B_{\frac{5}{2}\delta}(\vertex{b})$-geodesic, we have \begin{eqnarray*}
      \vertex{b} \cdot u
& = & \vertex{a} \cdot wu \\
& = & \vertex{a} \cdot w(|w| - i)u'w(|w|-i:|w|) \\
& = & \vertex{b'} \cdot u'w(|w|-i:|w|) \\
& = & \vertex{b'} \cdot w(|w|-i:|w|) \\
& = & \vertex{b},
\end{eqnarray*} so $u$ labels a loop at $\vertex{b}$, a contradiction. Thus no such loop $u$ can exist and $B_k(\vertex{x})$ is $X$-ball isomorphic to $\canonicalball{k}{\Gamma}$ as required to prove the second statement.

Returning to the first statement, we have $d(\vertex{z}, \vertex{y'}) \ge d(\vertex{z}, \vertex{y}) - i \ge K' - k + \delta > K$ where $\vertex{y'} = \vertex{y} \cdot w(|w|-i:|w|))$, so $B_{\frac{5}{2}\delta}(\vertex{y'})$ is $X$-ball isomorphic to $\canonicalball{\frac{5}{2}\delta}{\Gamma'}$ and $u'$ also labels a loop at $\vertex{y'}$. Now \begin{eqnarray*}
      \vertex{y} \cdot w(|w|-i:|w|)u'w(|w|-i:|w|)^{-1}
& = & \vertex{y'} \cdot u'w(|w|-i:|w|)^{-1} \\
& = & \vertex{y'} \cdot w(|w|-i:|w|)^{-1} \\
& = & \vertex{y},
\end{eqnarray*} so $v = w(|w|-i:|w|)u'w(|w|-i:|w|)^{-1}$ labels a loop at $\vertex{y}$.

Notice that $|v| \le 2i + 5\delta + 1 \le |u| + 3\delta + 1 \le 2k + 3\delta + 2$ so $\wordpath{\vertex{b}}{v}$ is contained inside the $2k+3\delta+2$-ball around $\vertex{b}$ and $\wordpath{\vertex{c}}{v}$ is contained inside the $2k+3\delta+2$-ball around $\vertex{c}$. As $\Gamma$ has IB($2k+3\delta+2$) and $\vertex{b}$ and $\vertex{c}$ were chosen to be sufficiently far from $\vertex{a}$, these balls are ball isomorphic. Since $\vertex{b} \cdot u = \vertex{b} \cdot v$, this implies that $\vertex{c} \cdot u = \vertex{c} \cdot v$ and so \begin{eqnarray*}
      \vertex{y} \cdot u
& = & f(\vertex{c} \cdot u) \\
& = & f(\vertex{c} \cdot v) \\
& = & \vertex{y} \cdot v \\
& = & \vertex{y},
\end{eqnarray*} which contradicts our assumption that $u$ did not label a loop at $\vertex{y}$. In other words, $B_k(\vertex{x})$ is isomorphic to $B_k(\vertex{y})$ and $\Gamma'$ has IB($k$) with constant $K'$, as required.
\end{proof}

In order to find a bound on GIB($k$), we now only need to exhibit a constant for GIB($\frac{5}{2}\delta$). We do this below, after stating some results which help us get to that goal; some notation and constants are introduced in the statements which will be used from this point on. First, the following is a reasonably well known general result; a similar result appears, for instance, in Proposition 2.3 of \cite{bridson2005conjugacy}. Note that the usual statement of this result gives a length of $|u| + |v|$ plus a constant, rather than $\frac{|u| + |v|}{2}$ plus a constant.

\begin{proposition}
\label{prop:bound_on_conjugator}
Let $G = <\!X\!>$ be a group with $\delta$-vertex-hyperbolic Cayley graph $\Gamma$. Suppose $u$ and $v$ are words which are conjugate in $G$. Let $Q$ be the number of vertices in $B_{4\delta}(\Gamma)$. Then there exists a word $x$ such that $x^{-1}ux =_G v$, and \[ |x| \le \frac{|u| + |v|}{2} + Q + 1 \]
\end{proposition}

\begin{proof}
Suppose not. Let $w$ be a shortest $X$-word satisfying $w^{-1}uw =_G v$. Let $\vertex{a}$ be a vertex in $\Gamma$, and let $\vertex{b} = \vertex{a} \cdot w$, $\vertex{c} = \vertex{b} \cdot v$ and $\vertex{d} = \vertex{a} \cdot u$ to form a geodesic quadrilateral. Pick some $\Gamma$-geodesic $t$ between $\vertex{a}$ and $\vertex{c}$ to split this quadrilateral into two geodesic triangles. Let $k := |w| - d(a, c)$. Notice that if some vertex $\vertex{x}$ on $\path{\vertex{d}}{\vertex{c}}$ chain-corresponds to a vertex $\vertex{y}$ on $\path{\vertex{a}}{\vertex{b}}$ then \begin{eqnarray*}
      d(\vertex{d}, \vertex{x})
& = & d(\vertex{d}, \vertex{c}) - d(\vertex{c}, \vertex{x}) \\
& = & d(\vertex{d}, \vertex{c}) - d(\vertex{c}, \vertex{x'}) \\
& = & d(\vertex{d}, \vertex{c}) - d(\vertex{a}, \vertex{c}) + d(\vertex{a}, \vertex{x'}) \\
& = & d(\vertex{d}, \vertex{c}) - d(\vertex{a}, \vertex{c}) + d(\vertex{a}, \vertex{y}) \\
& = & d(\vertex{d}, \vertex{c}) - d(\vertex{a}, \vertex{c}) + d(\vertex{a}, \vertex{y}) \\
& = & k + d(\vertex{a}, \vertex{y}).
\end{eqnarray*}

If $k > 0$ then $d(\vertex{a}, \vertex{c}) < |w|$. But then $t^{-1}ut =_G (uw)^{-1}u(uw) =_G w^{-1}uw =_G$ and $|t| < |w|$ which contradicts minimality of $|w|$.

Similarly, suppose that $k < -2\delta - 1$. Notice that $(\vertex{c}, \vertex{d})_{\vertex{a}} = \frac{|u| - k}{2}$, so letting $i = \floor{\frac{|u| - k}{2}}$ and $\vertex{e} = \vertex{a} \cdot u(i)$, we find $\vertex{e}$ $2$-corresponds to some vertex $\vertex{e'}$ on $\path{\vertex{a}}{\vertex{b}}$ and \begin{eqnarray*}
        |a^{-1}w|_G
&  =  & d(\vertex{d}, \vertex{b}) \\
& \le & d(\vertex{d}. \vertex{e}) + d(\vertex{e}, \vertex{e'}) + d(\vertex{e'}, \vertex{b}) \\
& \le & |u| - i + 2\delta + |w| - i \\
&  =  & |w| + |u| - 2i + 2\delta \\
& \le & |w| + k + 1 + 2\delta \\
&  <  & |w|,
\end{eqnarray*} and since $(u^{-1}w)^{-1}u(u^{-1}w) = w^{-1}uw = v$, any $\Gamma$-geodesic word equal in $G$ to $u^{-1}w$ contradicts $w$ being a shortest conjugating word. Thus $k \ge -2\delta - 1$.

Let $j := d(\vertex{d}, \vertex{x})$. Then $d(\vertex{x}, \vertex{a} \cdot w(j)) = d(\vertex{x}, \vertex{y}) + d(\vertex{y}, \vertex{a} \cdot w(j)) \le 2\delta + |k| \le 4\delta$. Thus if there are more than $Q$ such vertices $\vertex{x}$ then there is an $X$-word $s$ and integers $k < l$ such that $\vertex{d} \cdot w(k)s = \vertex{a} \cdot w(k)$ and $\vertex{d} \cdot w(l)s = \vertex{a} \cdot w(l)$ so that $uw(k)s =_G w(k)$ and $uw(l)s =_G w(l)$. But then let $w' := w(k)w(l:|w|)$ and we find that $|w'| < |w|$ and \begin{eqnarray*}
      w'^{-1}uw
& =_G & (w(k)w(l:|w|))^{-1}uw(k)w(l:|w|) \\
& =_G & w^{-1}w(l)w(k)^{-1}w(k)s^{-1}w(l)^{-1}w \\
& =_G & w^{-1}w(l)s^{-1}w(l)^{-1}w \\
& =_G & w^{-1}uw(l)w(l)^{-1}w \\
& =_G & w^{-1}uw \\
& =_G & v,
\end{eqnarray*} again contradicting minimality of $|w|$.

Now, vertices on $\path{\vertex{a}}{\vertex{b}}$ must chain-correspond to vertices on one of the other 3 sides. Since $(\vertex{c}, \vertex{d})_{\vertex{a}} = \frac{|u| - k}{2}$, at most $\frac{|u| - k}{2} + 1$ vertices on $\path{\vertex{a}}{\vertex{b}}$ chain-correspond to vertices on $\path{\vertex{a}}{\vertex{d}}$, and similarly $(\vertex{a}, \vertex{c})_{\vertex{b}} = \frac{|v| + k}{2}$ so at most $\frac{|v| + k}{2} + 1$ vertices on $\path{\vertex{a}}{\vertex{b}}$ chain-corespond to vertices on $\path{\vertex{b}}{\vertex{c}}$. By the previous paragraph, at most $Q$ vertices remain. Adding this all together, we find that $|w| + 1 \le \frac{|u| + |v|}{2} + Q + 2$, so $|w| \le \frac{|u| + |v|}{2} + Q + 1$ as required.
\end{proof}

Now we can move onto our result.

\begin{proposition}
\label{prop:torsion_free_gib}
Suppose that $G = <\!X\!>$ is has $\delta$-vertex-hyperbolic Cayley graph and that $H$ is any $\epsilon$-quasiconvex torsion-free subgroup of $G$. Then $H$ has GIB($\frac{5}{2}\delta$) with constant $K = Q + 15P\delta + 3P + 12\delta + 2\epsilon + 1$.
\end{proposition}

\begin{proof}
Let $\Gamma$ be the Cayley graph of $G$ with respect to $X$ and let $\Gamma'$ be the coset Cayley graph of $H$ with respect to $G$. Let $\vertex{a}$ be the vertex representing $H$ in $\Gamma'$ and suppose that some word $w$ is a $\Gamma'$-geodesic connecting $\vertex{a}$ to some vertex $\vertex{x}$ and that $B_{\frac{5}{2}\delta}(\vertex{x})$ is not isomorphic to $\canonicalball{\frac{5}{2}\delta}{\Gamma}$.

Proposition \ref{prop:loop_in_ball} gives us a $\Gamma$-geodesic word $u$ of length at most $5\delta + 1$ which labels a loop at $\vertex{x}$ but not at the centre of $\canonicalball{\frac{5}{2}\delta}{\Gamma}$, so $u \ne_G 1$. Applying Lemma \ref{lemma:conj_quadrilateral} we see that either $d(\vertex{a}, \vertex{x}) \le \frac{|u| + 3\delta + 2\epsilon}{2} \le K$, in which case we are done, or $|wuw^{-1}|_G \le 3\delta + 2\epsilon$.

By Proposition \ref{prop:bound_on_conjugator}, there is a word $w'$ such that $w'uw'^{-1} =_G wuw^{-1}$ and \begin{eqnarray*}
|w'| & \le & \frac{|u| + |wuw^{-1}|_G}{2} + Q + 1 \\
     & \le & Q + 4\delta + \epsilon + \frac{3}{2},
\end{eqnarray*} so noting that $|w'|$ is an integer, $|w'| \le Q + 4\delta + \epsilon + 1$. Let $z =_G w'^{-1}w$ be some $\Gamma$-geodesic word, and note that $z \in C_G(u)$.

% TODO

By Proposition \ref{prop:find_centraliser_sls} we have some set $S$ of at most $V$ elements each of length at most $P|u|$, a short-lex straight element $c$ of length at most $P|u|$ and an word $p$ of length at most $P|u|$ such that $z = pc^js$ for $s \in S$, and $n \in \mathbb{Z}$. Note that using the specific values and $n$ from Proposition \ref{prop:find_centraliser_sls} we have $z =_G u^kp^{-1}c^ls$ where $k = \floor{\frac{Mij}{n}}$ and $0 \le l \le n = \frac{|(u^p)^{Mi}|_G}{|c|}$. That is, $z =_G u^ka$ for some word $a$ of length at most $P|u| + MQ|u| + P|u| \le 3P|u|$.

Since the leading word of this form is $u$ and we know $Hw'u = Hw'$, we have \begin{eqnarray*}
        d(Hw', Hw'z)
&  =  & d(Hw', Hw'u^ka) \\
&  =  & d(Hw', Hw'a) \\
& \le & |a| \\
& \le & 3P|u| \\
& \le & 3P(5\delta + 1).
\end{eqnarray*}

Now since $w =_G w'z$, it is just a case of applying the triangle equality to show that \begin{eqnarray*}
d(H, Hw) &  =  & d(H, Hw'z) \\
         & \le & d(H, Hw') + d(Hw', Hw'z) \\
         & \le & Q + 12\delta + 2\epsilon + 1 + 3P(5\delta + 1) \\
         & \le & Q + 15P\delta + 3P + 12\delta + 2\epsilon + 1 \\
         &  =  & K_{GIB}.
\end{eqnarray*}\end{proof}

It is interesting to note that the factor of $\epsilon$ above does not depend on $\delta$ (although the leading constant does rather heavily).

\section{A Stronger Sense of Local Homogeneity}

In this section, we will give some results which show that not just balls but geodesics in $\Gamma'$ behave in a homogeneous way when they are relatively distant from $H$, assuming IB($\frac{5}{2}\delta$).

\begin{proposition}
Suppose $\Gamma$ is an $X$-graph with base point $b$ such that all geodesic triangles in $\Gamma$ are $\Delta$-thin. Suppose that $\Gamma$ has IB($\Delta+1$) with constant $K$, that $w$ labels a geodesic that lies entirely outside of $B_K(b)$, and that $\gamma$ is any other path labelled by $w$ and lying entirely outside of $B_K(b)$. Then $\gamma$ is a geodesic.
\end{proposition}

\begin{proof}
Suppose the conclusion is false, and suppose the geodesic that $w$ labels starts from $p$ and $\gamma$ starts from $q$. Let $w = w_1aw_2$, where $w_1$ is the longest subword which does label a geodesic starting at $q$, and $a$ is a word of length 1. Let $w_1'$ be a the label of a geodesic such that $qw_1' = qw_1a$, so that we must have $|w_1'| \le |w_1|$.

Then we have a geodesic triangle with corners $q$, $qw_1$ and $qw_1'$ and the obvious sides connecting them. Let $n := |w_1|$, and for $0 \le i < n$, let $p_i := qw(i)$ and $q_i := qw_1'(i)$. Let $p_n := qw_1$ and $q_n := qw_1'$. This is illustrated in Figure \ref{figure:geodesic_outside_GIB}.

\begin{figure}
\begin{center}
\input geodesic_outside_GIB.pstex_t
\caption{Geodesic triangle constructed outside of $B_{K-1}(b)$}
\label{figure:geodesic_outside_GIB}
\end{center}
\end{figure}

Now, since the triangle above is $\Delta$-thin, we can pick, for each $i$, a word $h_i$ joining $p_i$ and $q_i$ so that $|h_i| \le \Delta$. Now we find that for $0 \le i < n$, each quadrilateral with corners $p_i$, $p_{i+1}$, $q_i$, $q_{i+1}$ lies within $\Delta+1$ of $p_i$, hence it is contained inside the $\Delta+1$-ball around $qw(i)$, which is isomorphic to the $\Delta+1$-ball around $pw(i)$ (since this point is at a distance of at least $K$ from $H$).

Using a simple induction, we have $pw_1a = pw_1'$. But this is a clear contradiction, since $|w_1a| > |w_1'|$, and $w_1a$ labels a geodesic path starting at $p$. Hence no such $w_1'$ existed, and $w$ labels a geodesic starting at $q$.
\end{proof}

By substituting the point $1$ in the group Cayley graph for $q$ in the above argument, we derive the following similar result:

\begin{proposition}
\label{prop:geodesic_outside}
Suppose all triangles in $\Gamma'$ are $\Delta$-thin, and $H$ has GIB($\Delta+1$) with constant $K$ and that $w$ is a shortest word representing some group element. Then any path in $\Gamma'$ labelled by $w$ which lies outside of $B_{K-1}(H)$ is a geodesic.
\end{proposition}

We see the emergence of one ``bad'' ball, centred at $H$ in the coset Cayley graph. By the previous two sections, note that for torsion-free subgroups, $K \le K'\epsilon$, where $K'$ depends only on the group.

It's an established result that in hyperbolic spaces, quasigeodesic paths lie close to geodesic paths, so that if $\Gamma$-geodesic words label $\Gamma'$-geodesics whenever they lie outside a certain radius, the same must be true of quasigeodesics. We show this explicitly for $L$-local $(1, k)$-quasigeodesics, using Proposition 2.3 in \cite{epstein2006linearity}:

\begin{proposition}
\label{prop:happy_local_qgeo}
Let $w$ be an $L$-local $(1, 2\delta)$-quasigeodesic in $\Gamma$. Let $u$ be a geodesic connecting the endpoints of $w$. Then each point on $w$ is within $4\delta$ of some vertex on $u$ and each point on $u$ is within $4\delta$ of some vertex on $w$. Furthermore, if $|w| > L$, then $|u| \ge \frac{7}{17}|w|$.
\end{proposition}

\begin{lemma}
\label{lemma:qgeodesic_outside}
Suppose $H$ has GIB($\Delta+1$) with constant $K$. If $u$ is a word which labels a $(1, k)$-quasigeodesic path in $\Gamma$ and labels a path $\gamma$ in $\Gamma'$ which lies outside of $B_{K+\frac{k}{2}+\delta-1}(H)$, then $\gamma$ is a $(1, k)$-quasigeodesic.
\end{lemma}

\begin{proof}
Let $\alpha$ be a $(1, k)$-quasigeodesic in $\Gamma$ labelled by $w$. By Lemma \ref{lemma:qgeo} we know $\alpha$ lies within $\frac{k}{2} + \delta$ of a geodesic $\alpha'$ with label $u'$ say.

Suppose $\gamma$ starts at $Hw$, and let $\gamma'$ be the path in $\Gamma'$ starting from $Hw$ and labelled by $u'$. Since any loop in $\Gamma$ is present at all points in $\Gamma'$, we find that $\gamma$ lies within $\frac{k}{2} + \delta$ of $\gamma'$. But then since $\gamma$ lies outside of $B_{K+\frac{k}{2}+\delta-1}(H)$, the path $\gamma'$ must lie outside of $B_{K-1}(H)$, so is a geodesic by Propositon \ref{prop:geodesic_outside}. But then $d_\gamma(Hg, Hgw) = |w| \le |w'| + k = d(Hg, Hgw') + k$, so $\gamma$ is a $(1, k)$-quasigeodesic as required.
\end{proof}

\begin{lemma}
\label{lemma:local_qgeodesic_outside}
If $u$ is a word with $|u| \ge L$ which labels an $L$-local $(1, 2\delta)$-quasigeodesic path in $\Gamma$ and labels a path $\gamma$ in $\Gamma'$ which lies outside of $B_{K+4\delta-1}(H)$, then $\gamma$ is an $L$-local $(1, 2\delta)$-quasigeodesic and a $(\frac{17}{7}, 0)$-quasigeodesic.
\end{lemma}

\begin{proof}
Firstly, each subpath of $\gamma$ of length at most $L$ is clearly a $(1, 2\delta)$-quasigeodesic, by Lemma \ref{lemma:qgeodesic_outside}, so it's clear that $\gamma$ is an $L$-local $(1, 2\delta)$-quasigeodesic.

Let $\alpha$ be an $L$-local $(1, 2\delta)$-quasigeodesic in $\Gamma$ labelled by $u$. By Proposition \ref{prop:happy_local_qgeo}, $\alpha$ is a $(\frac{17}{7}, 0)$-quasigeodesic, and if we pick $\alpha'$ (with label $u'$) to be any geodesic connecting its endpoints, all points on $\alpha$ lie within $4\delta$ of $\alpha$ and vice versa.

Suppose $\gamma$ starts at $Hw$, and let $\gamma'$ be the path with label $u'$ starting from $Hw$. Just as in Lemma \ref{lemma:qgeodesic_outside}, the above distance properties remain true between $\gamma$ and $\gamma'$.

This implies that $\gamma'$ lies entirely outside of $B_{K-1}(H)$, so is a geodesic, and thus $\gamma$ must be a $(\frac{17}{7}, 0)$-quasigeodesic.
\end{proof}

\chapter{Hyperbolic Groups are $13$-hyperbolic}

\label{chapter:minimal}

The constant of hyperbolicity of a hyperbolic group is dependent on its generating set. For example, a free group, say $F = <a>$ on a free generating set has a vertex hyperbolicity constant of $0$. However introducing a redundant generator will increase this constant, for example $F=<a,b|a^2=b>$ has vertex hyperbolicity constant of $1$. The purpose of this chapter is to investigate the lower bound $\min_\delta(G)$ of this constant for a given group $G$. 

In fact, it turns out that there is a single small such bound that applies to all hyperbolic groups. Thus, the value of $\min_\delta(G)$ partitions hyperbolic groups into a small number of sets. The bounds given here are likely not to be the smallest due to the naive way in which they are derived, however it is the existence of such a bound that is interesting.

\section{Thinness of Quasigeodesic Triangles}

We first show that if we are working in a geodesic metric space in which all geodesic triangles are $\delta$-vertex-thin and we are given a triangle whose sides are all $(1, k)$-quasigeodesics, then the triangle is $\Delta$-vertex-thin for some $\Delta$ depending only on $k$ and $\delta$.

It is well known that in hyperbolic spaces, quasigeodesics lie close to geodesics; let us briefly investigate the case of $(1, k)$-quasigeodesics in particular.

\begin{lemma}
\label{lemma:qgeo}
Suppose $\Gamma$ is a $\delta$-vertex-hyperbolic graph, that $\gamma$ is a $(1,k)$-quasigeodesic in $\Gamma$ joining the vertices $x$ and $y$, and that $\alpha$ is a geodesic joining $x$ and $y$.

Then for every vertex $p$ on $\gamma$, there exists a vertex $q$ on $\alpha$ such that $d(p, q) \le \frac{k+1}{2} + \delta$ and $d(x, q) \le d_\gamma(x, p) \le d(x, q) + \frac{3k+1}{2}$.
\end{lemma}

\begin{figure}
\begin{center}
\input 1k_close_geo.pstex_t
\caption{$(1,k)$-quasigeodesics lie close to geodesics}
\label{figure:1,k_close}
\end{center}
\end{figure}

\begin{proof}
Pick geodesics $\path{p}{x}$ and $\path{p}{y}$, and define a geodesic triangle using these and $\alpha$, as in Figure \ref{figure:1,k_close}. Let $m$ be the meeting point on $\path{p}{x}$. Then $m$ must be of distance at most $\frac{k}{2}$ from $p$, since \begin{eqnarray*}
d(p, m) &  =  & \frac{d(p, x) + d(p, y) - d(x, y)}{2} \\
        & \le & \frac{d_\gamma(p, x) + d_\gamma(p, y) - d(x, y)}{2} \\
        &  =  & \frac{d_\gamma(x, y) - d(x,y)}{2} \\
        & \le & \frac{k}{2}.
\end{eqnarray*}

If $m$ lies on a vertex, let $q' = m$, and if not, let $e$ be the edge containing $m$ and let $q'$ be the vertex on $e$ that is closest to $x$. Either way, $d(q', m) \le \frac{1}{2}$.

Let $q$ be the vertex on $\alpha$ which corresponds to $q'$. Then \begin{eqnarray*}
        d(p, q)
& \le & d(p, m) + d(m, q') + d(q', q) \\
& \le & \frac{k}{2} + \frac{1}{2} + \delta,
\end{eqnarray*} and \begin{eqnarray*}
        d(x, q)
& \le & d(x, p) \\
& \le & d_\gamma(x,p) \\
& \le & d(x, p) + k \\
& \le & d(x, q') + d(q', p) + k \\
& \le & d(x, q) + \frac{3k+1}{2}
\end{eqnarray*} as required.
\end{proof}

When the paths $\gamma$ and $\alpha$ are understood, we will refer to $q$ in Lemma \ref{lemma:qgeo} as the \textbf{partner} of $p$.

\begin{lemma}
\label{lemma:qtri}
Suppose $\Gamma$ is a $\delta$-vertex-hyperbolic graph. Let $k$ be a positive integer, let $x$, $y$ and $z$ be vertices in $\Gamma$ and let $\alpha_{xy}$, $\alpha_{yz}$ and $\alpha_{xz}$ be $(1, k)$-quasigeodesics joining $x$ to $y$, $y$ to $z$ and $x$ to $z$ respectively to form a triangle $\alpha$.

Then $\alpha$ is  $3k+3\delta + 1$-vertex-thin.
\end{lemma}

\begin{figure}
\begin{center}
\input 1k_tri2.pstex_t
\caption{$(1,k)$-quasigeodesic triangles are thin}
\label{figure:1k_tri}
\end{center}
\end{figure}

\begin{proof}
Pick geodesics $\path{x}{y}$, $\path{y}{z}$ and $\path{x}{z}$ connecting $x$, $y$ and $z$, to form a geodesic triangle $\beta$. Let $a_{xy}$, $a_{yz}$ and $a_{xz}$ be the meeting points on $\alpha$ and let $b_{xz}$, $b_{yz}$ and $b_{xz}$ be the meeting points on $\beta$. See Figure \ref{figure:1k_tri}.

Let $p \in \alpha_{xy}$ be a vertex corresponding to $q \in \alpha_{xz}$, so $d_{\alpha_{xz}}(x, q) = d_{\alpha_{xy}}(x, p)$. Let $p' \in \path{x}{y}$ and $q' \in \path{x}{z}$ be their respective partners, as in Lemma \ref{lemma:qgeo}. By Lemma \ref{lemma:qgeo}, the distances $d(p, p')$ and $d(q, q')$ are less than or equal to $\delta + \frac{k+1}{2}$.

By relabelling the corners of the triangle, any pair of corresponding vertices $p$ and $q$ can be made to fit the above construction. If $d(x, p') > d(x, q')$ then swapping $y$ and $z$, and $p$ and $q$ reverses the inquality, so it may be assumed that $d(x, p') \le x(x, q')$.

Suppose $d(x, p') \le d(x, b_{xy})$, and let $p''$ be the point on $\path{x}{z}$ corresponding to $p'$, so $d(p', p'') \le \delta$. Using the second part of Lemma \ref{lemma:qgeo}, we have \begin{eqnarray*}
d(q', p'') &  =  & |d(x, q') - d(x, p'')| \\
           &  =  & |d(x, q') - d(x, p')| \\
		   & \le & \frac{3k+1}{2},
\end{eqnarray*} as $d_{\alpha_{xz}}(x, q) = d_{\alpha_{xy}}(x, p)$. Application of the triangle inequality gives \begin{eqnarray*}
d(p, q) & \le & d(p, p') + d(p', p'') + d(p'', q') + d(q', q) \\
        & \le & \left(\frac{k+1}{2} + \delta\right) + \delta + \frac{3k+1}{2} + \left(\frac{k+1}{2} + \delta\right) \\
        &  =  & \frac{5k+3}{2} + 3\delta \le 3k + 3\delta + 1.
\end{eqnarray*}

It remains to consider the case where both $d(x, p')$ and $d(x, q')$ are strictly larger than $d(x, b_{xy})$. Note that $d_{\alpha_{xy}}(x, p) = d_{\alpha_{xz}}(x, q) \le d_{\alpha_{xy}}(x, a_{xz})$. Then \begin{eqnarray*}
d(x, b_{xy}) &  <  & d(x, p') \\
             & \le & d_{\alpha_{xy}}(x, p) \\
             & \le & d_{\alpha_{xy}}(x, a_{xy}) \\
             &  =  & \frac{d_{\alpha_{xy}}(x, y) + d_{\alpha_{xz}}(x, z) - d_{\alpha_{yz}}(y, z)}{2} \\
             & \le & \frac{d(x, y) + d(x, z) + 2k - d(y, z)}{2} \\
             &  =  & d(x, b_{xy}) + k,
\end{eqnarray*} so $d(p', b_{xy}) = d(x, p') - d(x, b_{xy}) \le k$ and $d(p, b_{xy}) \le d(p, p') + d(p', b_{xy}) \le \frac{k+1}{2} + \delta + k = \frac{3k+1}{2} + \delta$. By symmetry, $d(q, b_{xz}) \le \frac{3k+1}{2} + \delta$ also, so we have \begin{eqnarray*}
d(p, q) & \le & d(p, b_{xy}) + d(b_{xy}, b_{xz}) + d(b_{xz}, q) \\
        & \le & \left(\frac{3k+1}{2} + \delta\right) + \delta + \left(\frac{3k+1}{2} + \delta\right) \\
        &  =  & 3k + 3\delta + 1.
\end{eqnarray*}
\end{proof}

\section{The Effect of Corners not on Vertices}

\label{section:graph_hyp_implies_space_hyp}

We will now investigate the result of allowing corners of a geodesic triangle to reside on an edge rather than a vertex. If the reader has no trouble believing that a result like the following holds, they are advised to simply skip this section; it is provided only for completeness.

That vertex-hyperbolicity implies hyperbolicity is not a new result; Section 4.2 of \cite{epstein2001computation} gives a similar result relating the thinness of short-lex geodesic triangles and the bigon constant (simply stated, the thinness of geodesic triangles with corners on vertices for which one side has length at most $1$) to the hyperbolicity of the space. Applying that result directly here would give us the value $5\delta+3$. The value $2\delta + 6$ given here is not claimed to be minimal, but the use of two correspondances (which results in the $2\delta$) does appear to be necessary.

\begin{proposition}
\label{prop:corner_straight}
Suppose that $x$, $y$ and $z$ are points in a Cayley graph and that $\path{x}{y}$, $\path{y}{z}$ and $\path{x}{z}$ are geodesics forming a geodesic triangle $\alpha$. If the vertex thinness constant of the space is $\delta$ then $\alpha$ is $2\delta+6$-thin.
\end{proposition}

\begin{figure}
\begin{center}
\input resolve_nonvertex_1.pstex_t
\caption{Removing loops from corners (left), and the first case of Proposition \ref{prop:corner_straight} (right)}
\label{figure:resolve_nonvertex_1}
\end{center}
\end{figure}

\begin{figure}
\begin{center}
\input resolve_nonvertex_2.pstex_t
\caption{The second case of Proposition \ref{prop:corner_straight}}
\label{figure:resolve_nonvertex_2}
\end{center}
\end{figure}

\begin{proof}
It is sufficient to prove any two corresponding points lie at most $2\delta + 6$ apart. Assume the labels are picked so that a point $p$ on $\path{x}{y}$ corresponds to a point $q$ on $\path{x}{z}$. Let $a_{xy}$, $a_{xz}$ and $a_{yz}$ be the meeting points on $\path{x}{y}$, $\path{x}{z}$ and $\path{y}{z}$ respectively.

If $x$ is a vertex, let $x_y = x_z = x$; if it lies on an edge $e$ then let $x_y$ be the vertex on $e$ which lies on $\path{x}{y}$ and $x_z$ be the vertex on $e$ which lies on $\path{x}{z}$ (these are uniquely defined since $x$ does not lie on a vertex). Define $y_x$ etc. in a similar way. By swapping $z$ and $y$ as necessary, it can be assumed that $d(x_y, x) \le \frac{1}{2}$.

Suppose that $x_y = x_z \ne x$, so $x$ lies on an edge, as in the left hand side of Figure \ref{figure:resolve_nonvertex_1}. If $p$ lies between $x$ and $x_y$ then $d(p, x) = d(q, x) \le 1$ so $d(p, q) \le 2$ as required. If not, define a new triangle with corners $x_y$, $y$, and $z$ and edges $\path{x_y}{y}$, $\path{x_y}{z}$, and $\path{y}{z}$. Since $d(x, p) - d(x, q) = d(x_y, p) - d(x_y, q)$, the points $p$ and  $q$  also correspond in the new triangle, so $\alpha$ can be replaced by this new triangle without affecting the arguments below. Thus, it may be assumed that if $x \ne x_y$ then $x_z \ne x_y$.

Note that if $d(p, x) \le 1$ then $d(p, q) \le 2$, so we can assume $d(p, x) > 1$. Our aim is to produce a second geodesic triangle $\beta$ which lies close to $\alpha$ and whose corners lie on vertices, and then use correspondances in $\beta$ to bound the distance between $p$ and $q$.

First, suppose that $d(x_y, z_x) = d(x_y, x_z) + d(x_z, z_x)$, so that $\beta_{xz} = \path{x_y}{x_z}\path{x_z}{z_x}$ is a geodesic, as in the right hand side of Figure \ref{figure:resolve_nonvertex_1}. Let $x' = x_y$. Let $y' = y_x$, and let $z' = z_x$. Form a geodesic triangle $\beta$ with corners $x'$, $y'$ and $z'$ using geodesic paths $\beta_{xy} = \path{x_y}{y_x}$, $\beta_{xz}$ and $\beta_{yz} = \path{y_x}{z_x}$ (pick any geodesic for the latter). Let $b_{xy}$ and $b_{xz}$ be the meeting points on $\beta_{xy}$ and $\beta_{xz}$ respectively.

Note that \begin{eqnarray*}
        d(x_y, b_{xy})
&  =  & \frac{d(x_y, z_x) + d(x_y, y_x) - d(x_z, y_x)}{2} \\
&  =  & \frac{(d(x, z_x) + d(x, x_y)) + (d(x, y_x) - d(x, x_y)) - d(x_z, y_x)}{2} \\
&  =  & \frac{d(x, z_x) + d(x, y_x) - d(x_z, y_x)}{2} \\
& \ge & \frac{(d(x, z) - d(z, z_x)) + (d(x, y) - d(y, y_x))}{2} \\
&     & - \frac{d(y, z) - d(z, z_x) - d(y, y_x)}{2} \\
&  =  & d(x, a_{xy}) - d(z, z_x) - d(y, y_x) \\
& \ge & d(x, a_{xy}) - 2.
\end{eqnarray*}

Let $\hat{p}$ be a closest vertex to $p$ on $\path{x_y}{y_x}$ such that $d(x_y, b_{xy}) \ge d(x_y, \hat{p})$ and let $\hat{q}$ be a closest vertex to $q$ on $\path{x_z}{y_z}$ such that $d(x_y, b_{xz}) \ge d(x_y, \hat{q})$.

Suppose that $d(x_y, p) > d(x_y, b_{xy})$, so that $p$ does not correspond to any point on $\beta_{xz}$ in $\beta$. The same must be true of $q$ as $d(x_y, q) = d(x_y, p) + 2d(x, x_y) \ge d(x_y, p)$. If the meeting points $b_{xy}$ and $b_{xz}$ lie on vertices, $\hat{p}$ and $\hat{q}$ must now be equal to $b_{xy}$ and $b_{xz}$ respectively. If not, $d(x_y, \hat{p}) = d(x_y, b_{xy}) - \frac{1}{2}$ and $d(x_y, \hat{q}) = d(x_y, b_{xz}) - \frac{1}{2}$.

Now $d(x_y, \hat{p})=d(x_y, \hat{q})$, so  $\hat{p}$ corresponds to $\hat{q}$ in $\beta$. But then \begin{eqnarray*}
        d(p, q)
& \le & d(p, \hat{p}) + d(\hat{p}, \hat{q}) + d(\hat{q}, q) \\
& \le & d(x_y, p) - d(x_y, \hat{p}) + \delta + d(x_y, q) - d(x_y, \hat{q}) \\
& \le & d(x, a_{xy}) - d(x_y, b_{xy}) + \frac{1}{2} + \delta + d(x, a_{xy}) - d(x_y, b_{xy}) + \frac{1}{2} \\
& \le & 2 + \frac{1}{2} + \delta + 2 + \frac{1}{2} \\ 
& \le & \delta + 5.
\end{eqnarray*}

The remaining case in this construction is that $d(x_y, p) \le d(x_y, b_{xy})$. If so, let $q'$ be the point on $\beta_{xz}$ corresponding to $\hat{p}$. If $q' = \hat{q}$ then \begin{eqnarray*}
        d(p, q)
& \le & d(p, \hat{p}) + d(\hat{p}, \hat{q}) + d(\hat{q}, q) \\
& \le & \delta + 1.
\end{eqnarray*}

If not, $d(x_y, p) - 1 \le d(x_y, p) - 2d(x, x_y) = d(x_y, q)$ implies that $d(x_y, \hat{q}) + 1 = d(x_y, q')$, so \begin{eqnarray*}
        d(p, q)
& \le & d(p, \hat{p}) + d(\hat{p}, q') + d(q', \hat{q}) + d(\hat{q}, q) \\
& \le & \delta + 2.
\end{eqnarray*}

Therefore if $\path{x_y}{x_z}\path{x_z}{z_x}$ is a geodesic then $d(p, q) \le \delta + 5 \le 2\delta + 6$ as required.

If $d(x, x_y) < \frac{1}{2}$ then $d(x_y, z_x) = d(x_z, z_x) + 1$, so  $\path{x_y}{x_z}\path{x_z}{z_x}$ must be a geodesic, as if not we can find a path $\path{z_x}{x_y}\path{x_y}{x}$ which is shorter than the path following the geodesic $\path{x}{z}$. If $\path{x_z}{x_y}\path{x_y}{y_x}$ is a geodesic, swap $y$ and $z$ and we can once again use the above reasoning. Thus it remains to consider the case where neither $\path{x_y}{x_z}\path{x_z}{z_x}$ nor $\path{x_z}{x_y}\path{x_y}{y_x}$ are geodesics. In particular, $d(y_x, x_y) = d(y_x, x_z)$ and $d(x, x_y) = \frac{1}{2}$.

First construct a geodesic triangle $\gamma$ with sides $\gamma_{wx} := \path{x_y}{x_z}$ and $\gamma_{wy} := \path{x_y}{y_x}$ and $\gamma_{xy} := \path{x_z}{y_x}$, where for the latter path we take any geodesic. Construct a second geodesic triangle $\beta$ with sides $\beta_{xy} := \gamma_{xy}$, $\beta_{xz} := \path{x_z}{z_x}$ and $\beta_{yz} := \path{y_x}{z_x}$, again picking any geodesic for the latter path.

Now \begin{eqnarray*}
        d(x_z, b_{xz})
&  =  & \frac{d(x_z, y_x) + d(x_z, z_x) - d(y_x, z_x)}{2} \\
&  =  & \frac{(d(x, y_x) - \frac{1}{2}) + (d(x, z_x) - \frac{1}{2}) - d(y_x, z_x)}{2} \\
& \ge & \frac{(d(x, y) - d(y, y_x)) + (d(x, z) - d(z, z_x))}{2} \\
&     & - \frac{d(y, z) + d(y, y_x) + d(z, z_x)}{2} - 1 \\
& \ge & d(x, a_{xy}) - 3 \\
&  =  & d(x_y, a_{xy}) - \frac{5}{2}.
\end{eqnarray*}

Let $\hat{p}$ be the closest vertex to $p$ on $\path{x_y}{y_x}$ such that $d(x_y, b_{xy}) \ge d(x_y, \hat{p})$ and let $\hat{q}$ be the closest vertex to $q$ on $\path{x_z}{z_x}$ such that $d(x_y, b_{xz}) \ge d(x_y, \hat{q})$ (picking the closest to $x$ if there are two).

If $d(p, x) \le 1$ then $d(p, q) \le d(p, x) + d(x, q) \le 2$ so assume that $d(p, x) > 1$. Then $\hat{p}$ corresponds to a point $p'$ on $\path{x_z}{y_x}$ with $d(x_y, \hat{p}) = d(x_z, p') = d(x_z, \hat{q})$, so $\hat{p}$ must 2-correspond to $\hat{q}$ in the triangles $\gamma$ and $\beta$, so our aim is to bound $d(p, \hat{p}) = d(q, \hat{q})$.

If $d(x_y, p) > d(x_z, b_{xy})$ then \begin{eqnarray*}
        d(p, \hat{p})
& \le & d(p, b_{xy}) + \frac{1}{2} \\
& \le & d(x_y, a_{xy}) - d(x_z, b_{xz}) + \frac{1}{2}\\
& \le & 3,
\end{eqnarray*} and otherwise $d(q, \hat{q}) \le \frac{1}{2}$. Thus $d(p, q) \le d(p, \hat{p}) + d(\hat{p}, \hat{q}) + d(\hat{q}, q) \le 2\delta + 6$.
\end{proof}

\section{A Change of Generating Set}

In this section, we will suppose we are given some presentation $G = <\!\!X'|R\!\!>$, and that the Cayley graph $\Gamma'$ of this presentation has vertex thinness constant $\delta$.

Let $X = X' \cup\{\$\}$ where $\$ =_G 1$, and  let $\Gamma = \Cay(G, X)$. Any shortest path label in $\Gamma$ between two elements of $G$ cannot involve $\$$, so is also a shortest path label in $\Gamma'$ between the same two elements of $G$, and vice versa. Thus, $<\!\!X|R,\$\!\!>$ is another presentation for $G$ with vertex thinness constant $\delta$. 

Pick some $k \in \mathbb{N}$, and let $Y = \{ g\in G : 1 \le |g|_X \le k \}$. Our aim will be to find a bound on the thinness of triangles in the Cayley graph $\Gamma'$ under the new generating set $Y$.

Let $A = X \cup X^{-1}$. For each element $a \in Y$, pick any word $w \in A^*$  of length $k$ such that $w$ and $a$ represent the same element of $G$. The existence of such a word is guaranteed by the presence of the generator $\$$: if the shortest word does not have a length of $k$, pad it by adding $\$$ anywhere in the word until it does. Extend this to a map of words $f : Y^* \to A^*$ (ignoring any cancellation).

If $w$ is a word in either generating set, let $|w|$ be its length, and for a group element $g$ (perhaps represented by a word in $Y^*$ or $X^*$), let $|g|_X = d_\Gamma(1, g)$ and $|g|_Y = d_{\Gamma'}(1, g)$.

\begin{lemma}
\label{lemma:qiso}
If $w \in Y^*$ is a $\Gamma'$-geodesic word, then $|f(w)| \le |f(w)|_X + k - 1$. In particular, $f(w)$ is a $(1, k - 1)$-$\Gamma$-quasigeodesic word.
\end{lemma}

\begin{proof}
If $|f(w)|_X \le k(|w| - 1)$ then $f(w)$ can be represented by $n = |w| - 1$ words $w_i'$ of length at most $k$, each of which correspond to some $y_i \in Y$, hence $w =_G y_1 \ldots y_n$ and since $n < |w|$, $w$ was not a geodesic.

Thus $|f(w)|_X > k(|w| - 1)$, or since this is an integer equation, we can rearrange it to $|f(w)| = k|w| \le |f(w)|_X + k - 1$. But now, by definition, $f(w)$ is a $(1, k-1)$-$\Gamma$-quasigeodesic, so we are done.
\end{proof}

\begin{proposition}
\label{prop:newgen}
With the hypothesis given at the start of this section, $\Gamma'$ has a vertex thinness constant of $\ceil{\frac{3k + 1 + 3\delta}{k}}$.
\end{proposition}

\begin{figure}
\begin{center}
\input triangle_beta_const.pstex_t
\caption{A triangle in $\Gamma'$ mapped into $\Gamma$}
\label{figure:triangle_beta_const}
\end{center}
\end{figure}

\begin{proof}
Let $x'$, $y'$ and $z'$ be vertices in $\Gamma'$, and let $x$, $y$ and $z$ be the vertices in $\Gamma$ which represent to the same group elements. Pick geodesics connecting $x'$, $y'$ and $z'$ in $\Gamma'$ to form a geodesic triangle $\alpha$, and note that any vertex along these geodesics corresponds to a vertex in $\Gamma$. If $w'$ was the label on a side of $\alpha$, then $f(w')$ labels a path which passes through each of these points, and is a $(1, k-1)$-quasigeodesic by Lemma \ref{lemma:qiso}. Let $\beta$ be the triangle in $\Gamma$ labelled by these paths.

By Lemma \ref{lemma:qtri}, $\beta$ is $3k + 1 + 3\delta$-thin. Since corresponding vertices on $\alpha$ are guaranteed to map to corresponding vertices on $\beta$ (this is ensured by the introduction of $\$$: if $d_\alpha(x, p) = n$ then $d_\beta(x, p) = kn$), corresponding vertices on $\alpha$ are within $\ceil{\frac{3k + 1 + 3\delta}{k}}$  of each other and we are done.
\end{proof}

\begin{theorem} 
All hyperbolic groups have a presentation with vertex thinness constant $4$, and a Cayley graph which is $14$-hyperbolic.
\end{theorem}

\begin{proof}
Using the construction in Proposition \ref{prop:newgen} with $k = 3\delta + 2$, we get a presentation whose vertex thinness is constant is $4$, and by Proposition \ref{prop:corner_straight}, all geodesic triangles in the Cayley graph for this presentation must be $14$-thin.
\end{proof}

\bibliography{bibitems}
\bibliographystyle{plain}

\end{document}
